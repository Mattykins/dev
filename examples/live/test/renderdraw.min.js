(()=>{function mt(t){let e;return t&&(typeof t=="string"?e=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(e=t)),e||(e=document.body),e}function ct(t,e){return mt(e).appendChild(t),t}function dt(t){let e=document.readyState;if(e==="complete"||e==="interactive"){t();return}let r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}function ht(t,e,r,n,o,s,a,u,f,m,h,l,d,g,T){return t.set([n,o,0,0,r,l,d,g,T,s,a,0,1,r,l,d,g,T,u,f,1,1,r,l,d,g,T,n,o,0,0,r,l,d,g,T,u,f,1,1,r,l,d,g,T,m,h,1,0,r,l,d,g,T],e),e+54}var i,lt={get:()=>i,set:t=>{i=t}};function pt(t){let e=t.count;if(e===0)return;let r=t.vertexbuffer.current,n=t.shader.current,o=n.shader.renderToFramebuffer;if(o&&t.framebuffer.set(n.shader.framebuffer,!0),e===r.batchSize){let s=r.isDynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW;i.bufferData(i.ARRAY_BUFFER,r.data,s)}else{let s=e*r.entryElementSize,a=r.vertexViewF32.subarray(0,s);i.bufferSubData(i.ARRAY_BUFFER,0,a)}r.indexed?i.drawElements(i.TRIANGLES,e*r.entryIndexSize,i.UNSIGNED_SHORT,0):i.drawArrays(i.TRIANGLES,0,e*r.elementsPerEntry),o&&t.framebuffer.pop()}function D(t,e){return e&&(t.count=e),t.count===0?!1:(pt(t),t.flush(),!0)}var oe={buffer:null,F32:null,offset:0};function bt(t,e=0){let r=t.vertexbuffer.current;return t.count+e>=r.batchSize&&D(t),oe.buffer=r,oe.F32=r.vertexViewF32,oe.offset=t.count*r.entryElementSize,t.count+=e,oe}function xt(t,e,r,n,o,s,a,u,f){let{F32:m,offset:h}=bt(t,2),l=t.textures.setWhite();e=Math.round(e),r=Math.round(r),ht(m,h,l,e,r,e,r+o,e+n,r+o,e+n,r,s,a,u,f)}var p={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL",WORLD_SIZE:"WorldSize"};var b=new Map;function gt(t){b.set(p.BACKGROUND_COLOR,t)}function St(t="",e="",r="",n="#fff",o="linear-gradient(#3e0081 40%, #00bcc3)"){b.set(p.BANNER,{title:t,version:e,url:r,color:n,background:o})}function Tt(t){b.set(p.BATCH_SIZE,t)}function Et(t=.5,e=t){b.set(p.DEFAULT_ORIGIN,{x:t,y:e})}function se(t){b.set(p.MAX_TEXTURES,t)}function Ct(t=800,e=600,r=1){r===0&&(r=window.devicePixelRatio),b.set(p.SIZE,{width:t,height:e,resolution:r})}function yt(t){b.set(p.WEBGL_CONTEXT,t)}function It(t){b.set(p.WORLD_SIZE,t)}function Rt(){gt(0),Tt(4096),St("Phaser","4.0.0","https://phaser4.io"),se(0),Et(.5,.5),Ct(800,600,1),yt({antialias:!0,desynchronized:!0,preserveDrawingBuffer:!0}),It(512)}function ae(t,e){let r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}var Le=[],W={add:(t,e)=>{Le.push({texture:t,glConfig:e})},get:()=>Le,clear:()=>{Le.length=0}};var Mr={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64"},Ge={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",f32:"Float32",f64:"Float64"},L={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array},ue={uint8:2**8,uint16:2**16,uint32:2**32},_r=Symbol("storeRef"),Y=Symbol("storeSize"),Dr=Symbol("storeMaps"),v=Symbol("storeFlattened"),fe=Symbol("storeBase"),vt=Symbol("storeType"),Fe=Symbol("storeArrayCount"),E=Symbol("storeSubarrays"),Pr=Symbol("storeCursor"),q=Symbol("subarrayCursors"),At=Symbol("subarray"),Be=Symbol("subarrayFrom"),Me=Symbol("subarrayTo"),_e=Symbol("subStore"),De=Symbol("tagStore"),G=Symbol("queryShadow"),F=Symbol("serializeShadow"),Z=Symbol("indexType"),K=Symbol("indexBytes"),B={},me=(t,e)=>{let r=new ArrayBuffer(e*t.BYTES_PER_ELEMENT),n=new t.constructor(r);return n.set(t,0),n},U=(t,e)=>{if(ArrayBuffer.isView(t))t[e]=t.slice(0).fill(0);else{let r=t[_e].slice(0).fill(0);for(let n in t[e]){let o=t[e][n][Be],s=t[e][n][Me];t[e][n]=r.subarray(o,s)}}},Ur=(t,e,r)=>{let n=t[q],o=e[vt],s=e[0].length,a=s<=ue.uint8?"ui8":s<=ue.uint16?"ui16":"ui32",u=t[Fe][o],f=Array(u).fill(0).reduce((d,g)=>d+s,0),m=new L[o](f*r);m.set(t[E][o]),t[E][o]=m,U(t[E][o],G),U(t[E][o],F),m[Z]=Ge[a],m[K]=L[a].BYTES_PER_ELEMENT;let h=n[o],l=0;for(let d=0;d<r;d++){let g=n[o]+d*s,T=g+s;e[d]=t[E][o].subarray(g,T),e[d][Be]=g,e[d][Me]=T,e[d][G]=t[E][o][G].subarray(g,T),e[d][F]=t[E][o][F].subarray(g,T),e[d][At]=!0,e[d][Z]=m[Z],e[d][K]=m[K],l=T}n[o]=l,e[_e]=t[E][o].subarray(h,l)},Lt=(t,e,r)=>{Object.keys(e).forEach(n=>{let o=e[n];Array.isArray(o)?(Ur(t,o,r),e[v].push(o)):ArrayBuffer.isView(o)?(e[n]=me(o,r),e[v].push(e[n]),e[n][G]=me(o[G],r),e[n][F]=me(o[F],r)):typeof o=="object"&&Lt(t,e[n],r)})},Gt=(t,e)=>{t[De]||(t[Y]=e,t[v].length=0,Object.keys(t[q]).forEach(r=>{t[q][r]=0}),Lt(t,t,e))},Ft=(t,e)=>{t[v]&&t[v].forEach(r=>{ArrayBuffer.isView(r)?r[e]=0:r[e].fill(0)})},Or=(t,e)=>{let r=e*L[t].BYTES_PER_ELEMENT,n=new ArrayBuffer(r);return new L[t](n)};var zr=(t,e,r)=>{let n=t[Y],o=Array(n).fill(0);o[vt]=e;let s=t[q],a=r<ue.uint8?"ui8":r<ue.uint16?"ui16":"ui32";if(!r)throw new Error("bitECS - Must define component array length");if(!L[e])throw new Error(`bitECS - Invalid component array property type ${e}`);if(!t[E][e]){let m=t[Fe][e],h=Array(m).fill(0).reduce((d,g)=>d+r,0),l=new L[e](h*n);t[E][e]=l,U(t[E][e],G),U(t[E][e],F),l[Z]=Ge[a],l[K]=L[a].BYTES_PER_ELEMENT}let u=s[e],f=0;for(let m=0;m<n;m++){let h=s[e]+m*r,l=h+r;o[m]=t[E][e].subarray(h,l),o[m][Be]=h,o[m][Me]=l,o[m][G]=t[E][e][G].subarray(h,l),o[m][F]=t[E][e][F].subarray(h,l),o[m][At]=!0,o[m][Z]=Ge[a],o[m][K]=L[a].BYTES_PER_ELEMENT,f=l}return s[e]=f,o[_e]=t[E][e].subarray(u,f),o},Bt=t=>Array.isArray(t)&&typeof t[0]=="string"&&typeof t[1]=="number",Nr=(t,e)=>{let r=Symbol("store");if(!t||!Object.keys(t).length)return B[r]={[Y]:e,[De]:!0,[fe]:()=>B[r]},B[r];t=JSON.parse(JSON.stringify(t));let n={},o=a=>{let u=Object.keys(a);for(let f of u)Bt(a[f])?(n[a[f][0]]||(n[a[f][0]]=0),n[a[f][0]]++):a[f]instanceof Object&&o(a[f])};o(t);let s={[Y]:e,[Dr]:{},[E]:{},[_r]:r,[Pr]:0,[q]:Object.keys(L).reduce((a,u)=>({...a,[u]:0}),{}),[v]:[],[Fe]:n};if(t instanceof Object&&Object.keys(t).length){let a=(u,f)=>{if(typeof u[f]=="string")u[f]=Or(u[f],e),U(u[f],G),U(u[f],F),u[f][fe]=()=>B[r],s[v].push(u[f]);else if(Bt(u[f])){let[m,h]=u[f];u[f]=zr(s,m,h),u[f][fe]=()=>B[r],s[v].push(u[f])}else u[f]instanceof Object&&(u[f]=Object.keys(u[f]).reduce(a,u[f]));return u};return B[r]=Object.assign(Object.keys(t).reduce(a,t),s),B[r][fe]=()=>B[r],B[r]}},Pe=()=>{let t=[],e=[],r=s=>t[e[s]]===s;return{add:s=>{r(s)||(e[s]=t.push(s)-1)},remove:s=>{if(!r(s))return;let a=e[s],u=t.pop();u!==s&&(t[a]=u,e[u]=a)},has:r,sparse:e,dense:t}};var Wr=!1,wr=t=>{Wr=t};var fi=new Map;var C=Symbol("entityMasks"),J=Symbol("entityMasks"),w=Symbol("entitySparseSet"),ee=Symbol("entityArray"),Mt=1e5,Ue=0,te=Mt,kr=()=>te-te/5,Vr=()=>te,Oe=[];var Qr=()=>Mt;var Xr=()=>Ue,ze=new Map,_t=t=>{let e=Oe.length>0?Oe.shift():Ue++;if(t[w].add(e),ze.set(e,t),Ue>=kr()){let r=te,n=Math.ceil(r/2/4)*4,o=r+n;te=o,en(o),Hr(o),wr(!0),console.info(`\u{1F47E} bitECS - resizing all worlds from ${r} to ${r+n}`)}return t[We].forEach(r=>{k(t,r,e)&&le(r,e)}),t[J].set(e,new Set),e},Ne=(t,e)=>{if(!!t[w].has(e)){t[ce].forEach(r=>{we(t,r,e)}),Oe.push(e),t[w].remove(e),t[J].delete(e);for(let r=0;r<t[C].length;r++)t[C][r][e]=0}};var ce=Symbol("queries"),We=Symbol("notQueries"),de=Symbol("queryMap"),he=Symbol("$dirtyQueries"),Dt=Symbol("queryComponents");var $r=(t,e)=>{let r=[],n=[],o=[];e[Dt].forEach(c=>{if(typeof c=="function"){let S=c();t[A].has(S)||ke(t,S),c.name==="QueryNot"&&n.push(S),c.name==="QueryChanged"&&(o.push(S),r.push(S))}else t[A].has(c)||ke(t,c),r.push(c)});let s=c=>t[A].get(c),a=r.concat(n).map(s),u=Pe(),f=[],m=Pe(),h=[],l=[],d=[],g=a.map(c=>c.generationId).reduce((c,S)=>(c.includes(S)||c.push(S),c),[]),T=(c,S)=>(c[S.generationId]||(c[S.generationId]=0),c[S.generationId]|=S.bitflag,c),N=r.map(s).reduce(T,{}),P=n.map(s).reduce((c,S)=>(c[S.generationId]||(c[S.generationId]=0),c[S.generationId]|=S.bitflag,c),{}),R=a.reduce(T,{}),ft=r.filter(c=>!c[De]).map(c=>Object.getOwnPropertySymbols(c).includes(v)?c[v]:[c]).reduce((c,S)=>c.concat(S),[]),Br=ft.map(c=>{let S=Symbol();return U(c,S),c[S]},[]),_=Object.assign(u,{archetypes:f,changed:m,components:r,notComponents:n,changedComponents:o,masks:N,notMasks:P,hasMasks:R,generations:g,flatProps:ft,toRemove:h,entered:l,exited:d,shadows:Br});t[de].set(e,_),t[ce].add(_),r.map(s).forEach(c=>{c.queries.add(_)}),n.map(s).forEach(c=>{c.notQueries.add(_)}),o.map(s).forEach(c=>{c.changedQueries.add(_)}),n.length&&t[We].add(_);for(let c=0;c<Xr();c++)!t[w].has(c)||k(t,_,c)&&le(_,c)};var Pt=t=>{if(t===void 0||t[A]!==void 0)return r=>r?r[ee]:t[ee];let e=function(r,n=!0){r[de].has(e)||$r(r,e);let o=r[de].get(e);return Ut(o),o.changedComponents.length?o.changed.dense:o.dense};return e[Dt]=t,e},k=(t,e,r)=>{let{masks:n,notMasks:o,generations:s}=e;for(let a=0;a<s.length;a++){let u=s[a],f=n[u],m=o[u],h=t[C][u][r];if(m&&(h&m)!=0||f&&(h&f)!==f)return!1}return!0},le=(t,e)=>{t.has(e)||(t.add(e),t.entered.push(e))},Ut=t=>{for(;t.toRemove.length;)t.remove(t.toRemove.pop())},jr=t=>{t[he].forEach(Ut),t[he].clear()},we=(t,e,r)=>{!e.has(r)||(e.toRemove.push(r),t[he].add(e),e.exited.push(r))};var A=Symbol("componentMap"),Ot=[],Hr=t=>{Ot.forEach(e=>Gt(e,t))},y=t=>{let e=Nr(t,Qr());return t&&Object.keys(t).length&&Ot.push(e),e},Yr=t=>{t[re]*=2,t[re]>=2**32&&(t[re]=1,t[C].push(new Uint32Array(t[O])))},ke=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");let r=new Set,n=new Set,o=new Set;t[ce].forEach(s=>{s.notComponents.includes(e)?r.add(s):s.changedComponents.includes(e)?o.add(s):s.components.includes(e)&&n.add(s)}),t[A].set(e,{generationId:t[C].length-1,bitflag:t[re],store:e,queries:r,notQueries:n,changedQueries:o}),e[Y]<t[O]&&Gt(e,t[O]),Yr(t)};var qr=(t,e,r)=>{let n=t[A].get(e);if(!n)return;let{generationId:o,bitflag:s}=n;return(t[C][o][r]&s)===s},pe=(t,e,r,n=!1)=>{if(Number.isInteger(r)||(e=t,t=ze.get(r),n=r||n),t[A].has(e)||ke(t,e),qr(t,e,r))return;let o=t[A].get(e),{generationId:s,bitflag:a,queries:u,notQueries:f}=o;f.forEach(m=>{k(t,m,r)&&we(t,m,r)}),t[C][s][r]|=a,u.forEach(m=>{k(t,m,r)&&le(m,r)}),t[J].get(r).add(e),n&&Ft(e,r)},Ve=(t,e,r,n=!0)=>{Number.isInteger(r)||(e=t,t=ze.get(r),n=r||n);let o=t[A].get(e),{generationId:s,bitflag:a,queries:u,notQueries:f}=o;!(t[C][s][r]&a)||(u.forEach(m=>{k(t,m,r)&&we(t,m,r)}),t[C][s][r]&=~a,f.forEach(m=>{k(t,m,r)&&le(m,r)}),t[J].get(r).delete(e),n&&Ft(e,r))},O=Symbol("size"),Zr=Symbol("resizeThreshold"),re=Symbol("bitflag"),Kr=Symbol("archetypes"),Jr=Symbol("localEntities"),zt=[],en=t=>{zt.forEach(e=>{e[O]=t;for(let r=0;r<e[C].length;r++){let n=e[C][r];e[C][r]=me(n,t)}e[Zr]=e[O]-e[O]/5})},Nt=()=>{let t={};return tn(t),zt.push(t),t},tn=t=>{let e=Vr();return t[O]=e,t[ee]&&t[ee].forEach(r=>Ne(t,r)),t[C]=[new Uint32Array(e)],t[J]=new Map,t[Kr]=[],t[w]=Pe(),t[ee]=t[w].dense,t[re]=1,t[A]=new Map,t[de]=new Map,t[ce]=new Set,t[We]=new Set,t[he]=new Set,t[Jr]=new Map,t};var Wt=(t,e)=>{let r=e!==void 0?e:t,n=e!==void 0?t:void 0,o=new Set,s=(a,...u)=>(n&&!o.has(a)&&(n(a,...u),o.add(a)),r(a,...u),jr(a),a);return Object.defineProperty(s,"name",{value:(r.name||"AnonymousSystem")+"_internal",configurable:!0}),s};var x=Mr;var rn=y({x:x.f32,y:x.f32,width:x.f32,height:x.f32,right:x.f32,bottom:x.f32}),z=rn;var nn=y({child:x.ui8,childCache:x.ui8,displayList:x.ui8,transform:x.ui8}),wt=nn;function kt(t){wt.transform[t]=1}function Vt(t,e,r,n,o){z.x[t]=e,z.y[t]=r,z.width[t]=n,z.height[t]=o,z.right[t]=e+n,z.bottom[t]=r+o,kt(t)}var on=y({values:[x.f32,54]}),V=on;function Qt(t,e,r,n,o){let s=V.values[t];s[2]=e,s[3]=r,s[11]=e,s[12]=o,s[20]=n,s[21]=o,s[29]=e,s[30]=r,s[38]=n,s[39]=o,s[47]=n,s[48]=r}var be=class{texture;key;x;y;width;height;trimmed=!1;sourceSizeWidth;sourceSizeHeight;spriteSourceSizeX;spriteSourceSizeY;spriteSourceSizeWidth;spriteSourceSizeHeight;pivot;u0;v0;u1;v1;constructor(e,r,n,o,s,a){this.texture=e,this.key=r,this.x=n,this.y=o,this.width=s,this.height=a,this.sourceSizeWidth=s,this.sourceSizeHeight=a,this.updateUVs()}setPivot(e,r){this.pivot={x:e,y:r}}setSize(e,r){this.width=e,this.height=r,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.updateUVs()}setSourceSize(e,r){this.sourceSizeWidth=e,this.sourceSizeHeight=r}setTrim(e,r,n,o,s,a){this.trimmed=!0,this.sourceSizeWidth=e,this.sourceSizeHeight=r,this.spriteSourceSizeX=n,this.spriteSourceSizeY=o,this.spriteSourceSizeWidth=s,this.spriteSourceSizeHeight=a}getExtent(e,r){let n=this.sourceSizeWidth,o=this.sourceSizeHeight,s,a,u,f;return this.trimmed?(s=this.spriteSourceSizeX-e*n,a=s+this.spriteSourceSizeWidth,u=this.spriteSourceSizeY-r*o,f=u+this.spriteSourceSizeHeight):(s=-e*n,a=s+n,u=-r*o,f=u+o),{left:s,right:a,top:u,bottom:f}}copyToExtent(e){let r=e.origin.x,n=e.origin.y,o=this.sourceSizeWidth,s=this.sourceSizeHeight,a,u,f,m;return this.trimmed?(a=this.spriteSourceSizeX-r*o,u=this.spriteSourceSizeY-n*s,f=this.spriteSourceSizeWidth,m=this.spriteSourceSizeHeight):(a=-r*o,u=-n*s,f=o,m=s),Vt(e.id,a,u,f,m),this}copyToVertices(e){return Qt(e,this.u0,this.v0,this.u1,this.v1),this}updateUVs(){let{x:e,y:r,width:n,height:o}=this,s=this.texture.width,a=this.texture.height;this.u0=e/s,this.v0=r/a,this.u1=(e+n)/s,this.v1=(r+o)/a}destroy(){this.texture=null}};var M=class{key="";locked=!0;width;height;image;binding;firstFrame;frames;data;constructor(e,r,n,o){e&&(r=e.width,n=e.height),this.image=e,this.width=r,this.height=n,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,r,n),W.add(this,o)}addFrame(e,r,n,o,s){if(this.frames.has(e))return null;let a=new be(this,e,r,n,o,s);return this.frames.set(e,a),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=a),a}getFrame(e){if(!e)return this.firstFrame;e instanceof be&&(e=e.key);let r=this.frames.get(e);return r||(console.warn(`Frame missing: ${e}`),r=this.firstFrame),r}setSize(e,r){this.width=e,this.height=r,this.frames.get("__BASE").setSize(e,r)}update(e,r){this.image=e,this.setSize(e.width,e.height),W.add(this,r)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.binding=null,this.data=null,this.image=null,this.firstFrame=null}};var Qe,Xt={get:()=>Qe,set:t=>{if(Qe)throw new Error("Cannot instantiate TextureManager more than once");Qe=t}};var $t,xe={get:()=>$t,set:t=>{$t=t}};var ge=class{textures;constructor(){Xt.set(this),this.textures=new Map,this.createDefaultTextures()}createDefaultTextures(){this.add("__BLANK",new M(ae(2,2).canvas));let e=ae(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new M(e.canvas));let r=ae(2,2);r.fillStyle="#fff",r.fillRect(0,0,2,2);let n=this.add("__WHITE",new M(r.canvas));xe.set(n)}get(e){let r=this.textures;return r.has(e)?r.get(e):r.get("__MISSING")}has(e){return this.textures.has(e)}add(e,r,n){let o;return this.textures.has(e)||(r instanceof M?o=r:o=new M(r,0,0,n),o.key=e,this.textures.set(e,o)),o}update(e,r,n){let o=this.textures.get(e);return o&&o.update(r,n),o}};var sn=Nt(),I=sn;var an=y({r:x.ui8c,g:x.ui8c,b:x.ui8c,a:x.f32,colorMatrix:[x.f32,16],colorOffset:[x.f32,4]}),Q=an;var jt=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ht=new Float32Array(4);function Yt(t,e,r,n){for(let o=0;o<e.length;o++)if(e[o]!==n[o])return!1;for(let o=0;o<t.length;o++)if(t[o]!==r[o])return!1;return!0}function qt(t,e,r,n,o){let s=V.values[t];s[5]=e,s[6]=r,s[7]=n,s[8]=o,s[14]=e,s[15]=r,s[16]=n,s[17]=o,s[23]=e,s[24]=r,s[25]=n,s[26]=o,s[32]=e,s[33]=r,s[34]=n,s[35]=o,s[41]=e,s[42]=r,s[43]=n,s[44]=o,s[50]=e,s[51]=r,s[52]=n,s[53]=o}var un=Pt([Q,V]),fn=Wt(t=>{let e=un(t);for(let r=0;r<e.length;r++){let n=e[r],o=Q.r[n]/255,s=Q.g[n]/255,a=Q.b[n]/255,u=Q.a[n];qt(n,o,s,a,u)}return t}),Xe=fn;function Zt(t){Xe(I),D(t)}function Kt(){return b.get(p.BACKGROUND_COLOR)}function Jt(t){let e="WEBGL_compressed_texture_",r="WEBKIT_"+e,n=o=>{let s=t.getExtension(e+o)||t.getExtension(r+o);if(s){let a={};for(let u in s)a[s[u]]=u;return a}};return{ETC:n("etc"),ETC1:n("etc1"),ATC:n("atc"),ASTC:n("astc"),BPTC:n("bptc"),RGTC:n("rgtc"),PVRTC:n("pvrtc"),S3TC:n("s3tc"),S3TCSRGB:n("s3tc_srgb"),IMG:!0}}function Se(){return b.get(p.SIZE).height}function er(t,e=[]){let r=t>>16&255,n=t>>8&255,o=t&255,s=t>16777215?t>>>24:255;return e[0]=r/255,e[1]=n/255,e[2]=o/255,e[3]=s/255,e}function Te(){return b.get(p.SIZE).resolution}function tr(){return b.get(p.WEBGL_CONTEXT)}function Ee(){return b.get(p.SIZE).width}function Ce(t,e){e||(e=i.COLOR_ATTACHMENT0);let r=i.createFramebuffer();return i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,e,i.TEXTURE_2D,t,0),i.bindFramebuffer(i.FRAMEBUFFER,null),r}function ye(t,e){let{generateMipmap:r,minFilter:n,parent:o,compressed:s,internalFormat:a,flipY:u,unpackPremultiplyAlpha:f,magFilter:m,wrapS:h,wrapT:l,isPOT:d}=t,g=o.image,T=o.width,N=o.height,P=i.createTexture();if(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,P),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,u),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),g)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,g),T=g.width,N=g.height;else if(s&&e)for(let R=0;R<e.length;R++)i.compressedTexImage2D(i.TEXTURE_2D,R,a,e[R].width,e[R].height,0,e[R].data);else i.texImage2D(i.TEXTURE_2D,0,i.RGBA,T,N,0,i.RGBA,i.UNSIGNED_BYTE,null);return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,l),r&&d&&i.generateMipmap(i.TEXTURE_2D),t.texture=P,P}function Ie(t){i&&i.isFramebuffer(t)&&i.deleteFramebuffer(t)}function ne(t){i.isTexture(t)&&i.deleteTexture(t)}function rr(t,e){return t<1||e<1?!1:(t&t-1)==0&&(e&e-1)==0}function nr(t,e=!0){i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t);let r=e?i.LINEAR:i.NEAREST;i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r)}function ir(t){let e=t.parent.image,r=e.width,n=e.height;return r>0&&n>0&&(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)),t.texture}var ie=class{parent;texture;framebuffer;depthbuffer;format;internalFormat;compressed;mipmaps;isBound=!1;textureUnit=0;unpackPremultiplyAlpha=!0;minFilter;magFilter;wrapS;wrapT;flipY=!1;isPOT=!1;generateMipmap=!1;constructor(e,r={}){this.parent=e,this.isPOT=rr(e.width,e.height);let{mipmaps:n=null,compressed:o=!1,format:s="IMG",internalFormat:a=0,texture:u=null,framebuffer:f=null,createFramebuffer:m=!1,depthbuffer:h=null,unpackPremultiplyAlpha:l=!0,minFilter:d=this.isPOT?i.LINEAR_MIPMAP_LINEAR:i.LINEAR,magFilter:g=i.LINEAR,wrapS:T=i.CLAMP_TO_EDGE,wrapT:N=i.CLAMP_TO_EDGE,generateMipmap:P=this.isPOT,flipY:R=!1}=r;this.compressed=o,this.format=s,this.internalFormat=a,this.mipmaps=n,o?this.minFilter=i.LINEAR:this.minFilter=d,this.magFilter=g,this.wrapS=T,this.wrapT=N,this.generateMipmap=P,this.flipY=R,this.unpackPremultiplyAlpha=l,u?this.texture=u:ye(this,n),f?this.framebuffer=f:m&&(this.framebuffer=Ce(this.texture)),h&&(this.depthbuffer=h),e.binding=this}setFilter(e){this.texture&&nr(this.texture,e)}create(){let e=this.texture;return e&&ne(e),ye(this)}update(){return this.texture?ir(this):ye(this)}bind(e){this.isBound=!0,this.textureUnit=e}unbind(){this.isBound=!1,this.textureUnit=0}destroy(){this.unbind(),ne(this.texture),Ie(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function $e(){W.get().forEach(e=>{let{texture:r,glConfig:n}=e;r.binding||(r.binding=new ie(r,n))}),W.clear()}var je=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r,n){let o={enable:e,sfactor:r,dfactor:n};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.enable?(!i.isEnabled(i.BLEND)||this.current.sfactor!==e.sfactor||this.current.dfactor!==e.dfactor)&&(i.enable(i.BLEND),i.blendFunc(e.sfactor,e.dfactor)):i.disable(i.BLEND)}pop(){this.index--,this.bind()}set(e,r,n){let o=this.add(e,r,n);this.bind(o)}setDefault(e,r,n){let o={enable:e,sfactor:r,dfactor:n};this.stack[0]=o,this.index=0,this.default=o}};var He=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let n={colorMatrix:e,colorOffset:r};return this.index++,this.index===this.stack.length?this.stack.push(n):this.stack[this.index]=n,n}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current);let r=this.renderPass.getCurrentShader();D(this.renderPass),r.setUniform("uColorMatrix",e.colorMatrix),r.setUniform("uColorOffset",e.colorOffset)}pop(){this.index--,this.bind()}set(e){let r=this.current,n=this.add(e.colorMatrix,e.colorOffset);Yt(n.colorMatrix,n.colorOffset,r.colorMatrix,r.colorOffset)||this.bind(n)}setDefault(e,r){let n={colorMatrix:e,colorOffset:r};this.stack[0]=n,this.index=0,this.default=n}};var Ye=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let n={framebuffer:e,viewport:r};return this.index++,this.index===this.stack.length?this.stack.push(n):this.stack[this.index]=n,n}bindDefault(){this.index=0,this.bind(!1,this.default)}bind(e=!0,r){r||(r=this.current);let{framebuffer:n,viewport:o}=r;this.active!==n&&i.bindFramebuffer(i.FRAMEBUFFER,n),e&&(i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)),o&&this.renderPass.viewport.set(o.x,o.y,o.width,o.height),this.active=n}pop(){this.current.viewport&&this.renderPass.viewport.pop(),this.index--,this.bind(!1)}set(e,r=!0,n){let o=this.add(e,n);this.bind(r,o)}setDefault(e=null,r){let n={framebuffer:e,viewport:r};this.stack[0]=n,this.index=0,this.default=n}};function or(){return b.get(p.BATCH_SIZE)}function X(){return b.get(p.MAX_TEXTURES)}function sr(t,e,r,n,o,s,a){let u=1/(e-r),f=1/(n-o),m=1/(s-a);t.set([-2*u,0,0,0,0,-2*f,0,0,0,0,2*m,0,(e+r)*u,(o+n)*f,(a+s)*m,1])}var ar=`#define SHADER_NAME MULTI_QUAD_FRAG
#define numTextures %count%

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

vec4 getSampler (int index, vec2 uv)
{
    for (int i = 0; i < numTextures; ++i)
    {
        vec4 color = texture2D(uTexture[i], uv);

        if (i == index)
        {
            return color * vec4(vTintColor.rgb * vTintColor.a, vTintColor.a);
        }
    }

    //  Return black
    return vec4(0);
}

void main (void)
{
    vec4 color = getSampler(int(vTextureId), vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var Re={aVertexPosition:{size:2},aTextureCoord:{size:2},aTextureId:{size:1},aTintColor:{size:4}};var ur=5120,fr=5121,mr=5122,cr=5123;var dr=5126;function hr(t,e){let r=new Map,n={size:1,type:dr,normalized:!1,stride:0},o=0;for(let[s,a]of Object.entries(e)){let u=i.getAttribLocation(t,s);if(u!==-1){i.enableVertexAttribArray(u);let{size:f=n.size,type:m=n.type,normalized:h=n.normalized,stride:l=n.stride}=a;r.set(s,{index:u,size:f,type:m,normalized:h,stride:l,offset:o});let d=4;m===cr||m===mr?d=2:(m===fr||m===ur)&&(d=1),o+=f*d}}return r}function lr(t,e,r){i.bindFramebuffer(i.FRAMEBUFFER,t);let n=i.createRenderbuffer();return i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,r),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n),i.bindFramebuffer(i.FRAMEBUFFER,null),n}function ve(...t){t.forEach(e=>{i.deleteShader(e)})}function pr(...t){let e=i.createProgram();if(t.forEach(n=>{i.attachShader(e,n)}),i.linkProgram(e),!i.getProgramParameter(e,i.LINK_STATUS)){let n=i.getProgramInfoLog(e);return console.error(`Error linking program: ${n}`),i.deleteProgram(e),ve(...t),null}return e}function qe(t,e){let r=i.createShader(e);if(i.shaderSource(r,t),i.compileShader(r),!i.getShaderParameter(r,i.COMPILE_STATUS)){let o=i.getShaderInfoLog(r),s=t.split(`
`).map((a,u)=>`${u}: ${a}`);return console.error(`Error compiling shader: ${o}`,s.join(`
`)),i.deleteShader(r),null}return r}function br(t,e,r=!1){switch(t.type){case i.INT:case i.BOOL:return r?n=>{i.uniform1iv(e,n)}:n=>{i.uniform1i(e,n)};case i.INT_VEC2:case i.BOOL_VEC2:return n=>{i.uniform2iv(e,n)};case i.INT_VEC3:case i.BOOL_VEC3:return n=>{i.uniform3iv(e,n)};case i.INT_VEC4:case i.BOOL_VEC4:return n=>{i.uniform4iv(e,n)};case i.FLOAT:return r?n=>{i.uniform1fv(e,n)}:n=>{i.uniform1f(e,n)};case i.FLOAT_VEC2:return n=>{i.uniform2fv(e,n)};case i.FLOAT_VEC3:return n=>{i.uniform3fv(e,n)};case i.FLOAT_VEC4:return n=>{i.uniform4fv(e,n)};case i.FLOAT_MAT2:return n=>{i.uniformMatrix2fv(e,!1,n)};case i.FLOAT_MAT3:return n=>{i.uniformMatrix3fv(e,!1,n)};case i.FLOAT_MAT4:return n=>{i.uniformMatrix4fv(e,!1,n)};case i.SAMPLER_2D:case i.SAMPLER_CUBE:return t.size>1?n=>{i.uniform1iv(e,n)}:n=>{i.uniform1i(e,n)}}}function xr(t){let e=new Map,r=i.getProgramParameter(t,i.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){let o=i.getActiveUniform(t,n),s=o.name;if(s.startsWith("gl_")||s.startsWith("webgl_"))continue;let a=i.getUniformLocation(t,s);if(a){let u=!1;s.endsWith("[0]")&&(s=s.slice(0,-3),u=o.size>1),e.set(s,br(o,a,u))}}return e}var gr={uProjectionMatrix:new Float32Array(16),uCameraMatrix:new Float32Array(16),uTexture:0,uColorMatrix:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uColorOffset:new Float32Array(4)};var Sr=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var Tr=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;var Ze=class{program;attributes;uniforms;uniformSetters;texture;framebuffer;renderToFramebuffer=!1;renderToDepthbuffer=!1;isActive=!1;constructor(e){e&&this.fromConfig(e)}fromConfig(e){let{attributes:r=Re,fragmentShader:n=Sr,height:o=Se(),renderToFramebuffer:s=!1,renderToDepthbuffer:a=!1,resolution:u=Te(),vertexShader:f=Tr,width:m=Ee(),uniforms:h=gr}=e;if(this.create(n,f,h,r),s){this.renderToFramebuffer=!0;let l=new M(null,m*u,o*u),d=new ie(l);d.framebuffer=Ce(d.texture),a&&(this.renderToDepthbuffer=!0,d.depthbuffer=lr(d.framebuffer,l.width,l.height)),this.texture=l,this.framebuffer=d.framebuffer}}create(e,r,n,o){let s=qe(e,i.FRAGMENT_SHADER),a=qe(r,i.VERTEX_SHADER);if(!s||!a)return;let u=pr(s,a);if(!u)return;let f=i.getParameter(i.CURRENT_PROGRAM);i.useProgram(u),this.program=u,this.uniformSetters=xr(u),this.uniforms=new Map;for(let[m,h]of Object.entries(n))this.uniformSetters.has(m)&&this.uniforms.set(m,h);this.attributes=hr(u,o),i.useProgram(f),this.isActive=!1}updateUniforms(e){}bind(e){let r=this.uniforms;return r.set("uProjectionMatrix",e.projectionMatrix),r.set("uCameraMatrix",e.cameraMatrix),this.updateUniforms(e),this.setUniforms(e)}setUniform(e,r){let n=this.uniforms;n.has(e)&&(n.set(e,r),this.uniformSetters.get(e)(r))}setUniforms(e){if(!this.program)return!1;i.useProgram(this.program),this.isActive=!0;let r=this.uniforms;for(let[n,o]of this.uniformSetters.entries())o(r.get(n));return!0}setAttributes(e){if(this.program){let r=e.vertexbuffer.current.vertexByteSize;this.attributes.forEach(n=>{i.vertexAttribPointer(n.index,n.size,n.type,n.normalized,r,n.offset)})}}destroy(){ve(this.program),ne(this.texture),Ie(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var $=class extends Ze{constructor(e={}){e.attributes=e?.attributes||Re,super(e)}};var Ke=class extends ${constructor(e={}){e.fragmentShader=e?.fragmentShader||ar,super(e)}create(e,r,n,o){let s=X();e=e.replace(/%count%/gi,`${s}`),super.create(e,r,n,o)}bind(e){return this.uniforms.set("uTexture",e.textures.textureIndex),super.bind(e)}};var Je=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let n={shader:e,textureID:r};return this.index++,this.index===this.stack.length?this.stack.push(n):this.stack[this.index]=n,n}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.shader.isActive||e.shader.bind(this.renderPass,e.textureID)&&(e.shader.setAttributes(this.renderPass),this.active&&this.active!==e.shader&&(this.active.isActive=!1),this.active=e.shader)}pop(){this.index--,this.bind()}set(e,r){let n=this.add(e,r);this.bind(n)}setDefault(e,r){let n={shader:e,textureID:r};this.stack[0]=n,this.index=0,this.default=n}};var mn=y({local:[x.f32,4],global:[x.f32,4],world:[x.f32,4]}),j=mn;function Er(t){pe(I,j,t)}var H=y({data:[x.f32,16]});function Cr(t){pe(I,H,t);let e=H.data[t];e[0]=1,e[5]=1,e[10]=1,e[15]=1}var et=class{id=_t(I);type="StaticCamera";name="";constructor(e,r){let n=this.id;Cr(n),Er(n),this.reset(e,r)}getBounds(){return j.global[this.id]}getMatrix(){return H.data[this.id]}update(){return!1}reset(e,r){j.global[this.id].set([0,0,e,r])}destroy(){let e=this.id;Ve(I,H,e),Ve(I,j,e),Ne(I,e)}};function yr(){let t=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),e=X();e===0||e>t?se(t):t=e;let r=[];for(let n=0;n<t;n++){let o=i.createTexture();i.activeTexture(i.TEXTURE0+n),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),r.push([n,o])}return r}var tt=class{renderPass;textures;tempTextures;textureIndex;maxTextures;constructor(e){this.renderPass=e}bind(e,r=0){let n=e.binding;n.bind(r),i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,n.texture)}unbind(e=0){i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,this.tempTextures[e])}setWhite(){return this.set(xe.get())}set(e){if(!e.binding)return-1;let r=e.binding,n=this.textures;if(!r.isBound){n.size===this.maxTextures&&(D(this.renderPass),this.clear());let o=n.size;i.activeTexture(i.TEXTURE0+o),i.bindTexture(i.TEXTURE_2D,r.texture),n.set(o,e),r.bind(o)}return r.textureUnit}setDefault(){this.textures&&this.reset();let e=yr();this.maxTextures=e.length,this.tempTextures=new Map(e),this.textures=new Map,this.textureIndex=[],this.tempTextures.forEach((r,n)=>{this.textureIndex.push(n)})}clear(){this.textures.forEach(e=>e.binding.unbind()),this.textures.clear()}reset(){this.tempTextures.forEach((e,r)=>{i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,e)}),this.clear()}};function rt(t){i.isBuffer(t)&&i.deleteBuffer(t)}var nt=class{name;batchSize;dataSize;vertexElementSize;vertexByteSize;entryByteSize;bufferByteSize;data;vertexViewF32;vertexBuffer;entryElementSize;indexed=!1;isDynamic=!1;count=0;offset=0;elementsPerEntry;isBound=!1;constructor(e={}){let{name:r="VBO",batchSize:n=1,dataSize:o=4,isDynamic:s=!0,elementsPerEntry:a=3,vertexElementSize:u=9}=e;this.name=r,this.batchSize=n,this.dataSize=o,this.vertexElementSize=u,this.isDynamic=s,this.elementsPerEntry=a,this.vertexByteSize=u*o,this.entryByteSize=this.vertexByteSize*a,this.bufferByteSize=n*this.entryByteSize,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry,this.create()}resize(e){this.batchSize=e,this.bufferByteSize=e*this.entryByteSize,this.vertexBuffer&&rt(this.vertexBuffer),this.create()}create(){let e=new ArrayBuffer(this.bufferByteSize);this.data=e,this.vertexViewF32=new Float32Array(e),this.vertexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer);let r=this.isDynamic?i.DYNAMIC_DRAW:i.STATIC_DRAW;i.bufferData(i.ARRAY_BUFFER,e,r),i.bindBuffer(i.ARRAY_BUFFER,null),this.isBound=!1}add(e){this.count+=e,this.offset+=this.vertexElementSize*e}reset(){this.count=0,this.offset=0}canContain(e){return this.count+e<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer)}destroy(){rt(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexBuffer=null}};var it=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e){return this.index++,this.index===this.stack.length?this.stack.push(e):this.stack[this.index]=e,e}bindDefault(){this.index=0,this.bind(this.default)}bind(e){if(e||(e=this.current),!e.isBound){let r=e.indexed?e.indexBuffer:null;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r),i.bindBuffer(i.ARRAY_BUFFER,e.vertexBuffer),e.isBound=!0,this.active&&this.active!==e&&(this.active.isBound=!1),this.active=e}}pop(){this.index--,this.bind()}set(e){let r=this.add(e);this.bind(r)}setDefault(e){this.stack[0]=e,this.index=0,this.default=e}};function Ir(t,e,r){return t.width<=0||t.height<=0?!1:t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r}var Ae=class{x;y;width;height;constructor(e=0,r=0,n=0,o=0){this.set(e,r,n,o)}set(e=0,r=0,n=0,o=0){return this.x=e,this.y=r,this.width=n,this.height=o,this}contains(e,r){return Ir(this,e,r)}set right(e){e<=this.x?this.width=0:this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){e<=this.y?this.height=0:this.height=e-this.y}get bottom(){return this.y+this.height}};function Rr(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}var ot=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e=0,r=0,n=0,o=0){let s=new Ae(e,r,n,o);return this.index++,this.index===this.stack.length?this.stack.push(s):this.stack[this.index]=s,s}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),(!this.active||!Rr(this.active,e))&&(i.viewport(e.x,e.y,e.width,e.height),this.active=e)}pop(){this.index--,this.bind()}set(e=0,r=0,n=0,o=0){let s=this.add(e,r,n,o);this.bind(s)}setDefault(e=0,r=0,n=0,o=0){let s=new Ae(e,r,n,o);this.stack[0]=s,this.index=0,this.default=s}};var st=class{renderer;projectionMatrix;cameraMatrix;count=0;prevCount=0;flushTotal=0;framebuffer;vertexbuffer;blendMode;shader;viewport;textures;colorMatrix;quadShader;quadCamera;current2DCamera;constructor(e){this.renderer=e,this.projectionMatrix=new Float32Array(16),this.framebuffer=new Ye(this),this.vertexbuffer=new it(this),this.blendMode=new je(this),this.shader=new Je(this),this.viewport=new ot(this),this.textures=new tt(this),this.colorMatrix=new He(this),this.reset()}getCurrentShader(){return this.shader.current.shader}flush(){this.prevCount=this.count,this.count=0,this.flushTotal++}reset(){let e=this.renderer.gl;this.quadShader=new $,this.quadCamera=new et(this.renderer.width,this.renderer.height),this.textures.setDefault(),this.framebuffer.setDefault(),this.blendMode.setDefault(!0,e.ONE,e.ONE_MINUS_SRC_ALPHA),this.colorMatrix.setDefault(jt,Ht),this.vertexbuffer.setDefault(new nt({batchSize:or()})),this.shader.setDefault(X()===1?new $:new Ke)}resize(e,r){sr(this.projectionMatrix,0,e,r,0,-1e3,1e3),this.quadCamera.reset(e,r),this.viewport.setDefault(0,0,e,r)}};function vr(t){return t.current2DCamera||(t.current2DCamera=t.quadCamera,t.cameraMatrix=t.quadCamera.getMatrix()),t.count=0,t.flushTotal=0,t.framebuffer.bindDefault(),t.blendMode.bindDefault(),t.viewport.bindDefault(),t.vertexbuffer.bindDefault(),t.shader.bindDefault(),t.colorMatrix.bindDefault(),t}var Ar,Lr={get:()=>Ar,set:t=>{Ar=t}};var Gr,at={get:()=>Gr,set:t=>{Gr=t,Lr.set(t)}};var ut=class{canvas;gl;renderPass;clearColor=[0,0,0,1];width;height;resolution;clearBeforeRender=!0;optimizeRedraw=!0;autoResize=!0;contextLost=!1;compression;constructor(){this.width=Ee(),this.height=Se(),this.resolution=Te(),this.setBackgroundColor(Kt());let e=document.createElement("canvas");e.addEventListener("webglcontextlost",r=>this.onContextLost(r),!1),e.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=e,this.initContext(),at.set(this),this.renderPass=new st(this),this.resize(this.width,this.height,this.resolution),$e()}initContext(){let e=this.canvas.getContext("webgl",tr());lt.set(e),this.gl=e,this.compression=Jt(e),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}resize(e,r,n=1){let o=e*n,s=r*n;this.width=o,this.height=s,this.resolution=n;let a=this.canvas;a.width=o,a.height=s,this.autoResize&&(a.style.width=e.toString()+"px",a.style.height=r.toString()+"px"),this.renderPass.resize(o,s)}onContextLost(e){e.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(e){return er(e,this.clearColor),this}reset(){}begin(e){if(this.contextLost)return;let r=this.gl;if(r.getContextAttributes(),$e(),this.optimizeRedraw&&!e,this.clearBeforeRender){let n=this.clearColor;r.clearColor(n[0],n[1],n[2],n[3]),r.clear(r.COLOR_BUFFER_BIT)}return vr(this.renderPass)}end(){Zt(this.renderPass)}destroy(){at.set(void 0)}};var Fr=class{renderer;textureManager;constructor(){Rt(),dt(()=>{this.renderer=new ut,this.textureManager=new ge,ct(this.renderer.canvas,"gameParent"),requestAnimationFrame(e=>this.update(e))})}update(e){let r=this.renderer;r.begin(!0),xt(r.renderPass,100,100,400,300,255,255,0,1),r.end(),requestAnimationFrame(n=>this.update(n))}};new Fr;})();
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
