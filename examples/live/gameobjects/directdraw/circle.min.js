(()=>{var S={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL",WORLD_SIZE:"WorldSize",WORLD_WIDTH:"WorldWidth",WORLD_HEIGHT:"WorldHeight"};var D=new Map;function pr(r){D.set(S.BACKGROUND_COLOR,r)}function ht(r){return()=>{pr(r)}}function vo(r="",e="",t="",o="#fff",n="linear-gradient(#3e0081 40%, #00bcc3)"){D.set(S.BANNER,{title:r,version:e,url:t,color:o,background:n})}function Eo(r){D.set(S.BATCH_SIZE,r)}var bt=[],Oe={add:(r,e)=>{bt.push({texture:r,glConfig:e})},get:()=>bt,clear:()=>{bt.length=0}};function Go(){return D.get(S.BACKGROUND_COLOR)}function hr(){return D.get(S.SIZE).height}function br(){return D.get(S.SIZE).resolution}function Cr(){return D.get(S.SIZE).width}function Lo(r){D.set(S.RENDERER,r)}function Ao(r=.5,e=r){D.set(S.DEFAULT_ORIGIN,{x:r,y:e})}function Po(r){D.set(S.GLOBAL_VAR,r)}function Ct(r){return()=>{Po(r)}}function xr(r){D.set(S.MAX_TEXTURES,r)}function Ir(r){let e;return r&&(typeof r=="string"?e=document.getElementById(r):typeof r=="object"&&r.nodeType===1&&(e=r)),e||(e=document.body),e}function Oo(r){r&&D.set(S.PARENT,Ir(r))}function xt(r){return()=>{Oo(r)}}function _o(r){D.set(S.SCENES,[].concat(r))}function It(r){return()=>{_o(r)}}function Wo(r=800,e=600,t=1){t===0&&(t=window.devicePixelRatio),D.set(S.SIZE,{width:r,height:e,resolution:t})}var s,Bo={get:()=>s,set:r=>{s=r}};function Fo(r){let e=r.count;if(e===0)return;let t=r.vertexbuffer.current,o=r.shader.current,n=o.shader.renderToFramebuffer;if(n&&r.framebuffer.set(o.shader.framebuffer,!0),e===t.batchSize){let i=t.isDynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW;s.bufferData(s.ARRAY_BUFFER,t.data,i)}else{let i=e*t.entryElementSize,m=t.vertexViewF32.subarray(0,i);s.bufferSubData(s.ARRAY_BUFFER,0,m)}t.indexed?s.drawElements(s.TRIANGLES,e*t.entryIndexSize,s.UNSIGNED_SHORT,0):s.drawArrays(s.TRIANGLES,0,e*t.elementsPerEntry),n&&r.framebuffer.pop()}function ee(r,e){return e&&(r.count=e),r.count===0?!1:(Fo(r),r.flush(),!0)}function Mo(r){ee(r)}function No(r){let e="WEBGL_compressed_texture_",t="WEBKIT_"+e,o=n=>{let i=r.getExtension(e+n)||r.getExtension(t+n);if(i){let m={};for(let a in i)m[i[a]]=a;return m}};return{ETC:o("etc"),ETC1:o("etc1"),ATC:o("atc"),ASTC:o("astc"),BPTC:o("bptc"),RGTC:o("rgtc"),PVRTC:o("pvrtc"),S3TC:o("s3tc"),S3TCSRGB:o("s3tc_srgb"),IMG:!0}}function wo(r,e=[]){let t=r>>16&255,o=r>>8&255,n=r&255,i=r>16777215?r>>>24:255;return e[0]=t/255,e[1]=o/255,e[2]=n/255,e[3]=i/255,e}function Uo(){return D.get(S.WEBGL_CONTEXT)}function Sr(r,e){e||(e=s.COLOR_ATTACHMENT0);let t=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,t),s.framebufferTexture2D(s.FRAMEBUFFER,e,s.TEXTURE_2D,r,0),s.bindFramebuffer(s.FRAMEBUFFER,null),t}function Dr(r,e){let{generateMipmap:t,minFilter:o,parent:n,compressed:i,internalFormat:m,flipY:a,unpackPremultiplyAlpha:d,magFilter:f,wrapS:l,wrapT:c,isPOT:h}=r,b=n.image,p=n.width,T=n.height,x=s.createTexture();if(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,x),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,a),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d),b)s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,b),p=b.width,T=b.height;else if(i&&e)for(let E=0;E<e.length;E++)s.compressedTexImage2D(s.TEXTURE_2D,E,m,e[E].width,e[E].height,0,e[E].data);else s.texImage2D(s.TEXTURE_2D,0,s.RGBA,p,T,0,s.RGBA,s.UNSIGNED_BYTE,null);return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,f),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,l),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,c),t&&h&&s.generateMipmap(s.TEXTURE_2D),r.texture=x,x}function yr(r){s&&s.isFramebuffer(r)&&s.deleteFramebuffer(r)}function Ke(r){s.isTexture(r)&&s.deleteTexture(r)}function Ho(r,e){return r<1||e<1?!1:(r&r-1)==0&&(e&e-1)==0}function Vo(r,e=!0){s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r);let t=e?s.LINEAR:s.NEAREST;s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t)}function jo(r){let e=r.parent.image,t=e.width,o=e.height;return t>0&&o>0&&(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r.texture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r.flipY),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)),r.texture}var Ze=class{parent;texture;framebuffer;depthbuffer;format;internalFormat;compressed;mipmaps;isBound=!1;textureUnit=0;unpackPremultiplyAlpha=!0;minFilter;magFilter;wrapS;wrapT;flipY=!1;isPOT=!1;generateMipmap=!1;constructor(e,t={}){this.parent=e,this.isPOT=Ho(e.width,e.height);let{mipmaps:o=null,compressed:n=!1,format:i="IMG",internalFormat:m=0,texture:a=null,framebuffer:d=null,createFramebuffer:f=!1,depthbuffer:l=null,unpackPremultiplyAlpha:c=!0,minFilter:h=this.isPOT?s.LINEAR_MIPMAP_LINEAR:s.LINEAR,magFilter:b=s.LINEAR,wrapS:p=s.CLAMP_TO_EDGE,wrapT:T=s.CLAMP_TO_EDGE,generateMipmap:x=this.isPOT,flipY:E=!1}=t;this.compressed=n,this.format=i,this.internalFormat=m,this.mipmaps=o,n?this.minFilter=s.LINEAR:this.minFilter=h,this.magFilter=b,this.wrapS=p,this.wrapT=T,this.generateMipmap=x,this.flipY=E,this.unpackPremultiplyAlpha=c,a?this.texture=a:Dr(this,o),d?this.framebuffer=d:f&&(this.framebuffer=Sr(this.texture)),l&&(this.depthbuffer=l),e.binding=this}setFilter(e){this.texture&&Vo(this.texture,e)}create(){let e=this.texture;return e&&Ke(e),Dr(this)}update(){return this.texture?jo(this):Dr(this)}bind(e){this.isBound=!0,this.textureUnit=e}unbind(){this.isBound=!1,this.textureUnit=0}destroy(){this.unbind(),Ke(this.texture),yr(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function St(){Oe.get().forEach(e=>{let{texture:t,glConfig:o}=e;t.binding||(t.binding=new Ze(t,o))}),Oe.clear()}var Tr=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ko=new Float32Array(4);var Dt=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,t,o){let n={enable:e,sfactor:t,dfactor:o};return this.index++,this.index===this.stack.length?this.stack.push(n):this.stack[this.index]=n,n}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.enable?(!s.isEnabled(s.BLEND)||this.current.sfactor!==e.sfactor||this.current.dfactor!==e.dfactor)&&(s.enable(s.BLEND),s.blendFunc(e.sfactor,e.dfactor)):s.disable(s.BLEND)}pop(){this.index--,this.bind()}set(e,t,o){let n=this.add(e,t,o);this.bind(n)}setDefault(e,t,o){let n={enable:e,sfactor:t,dfactor:o};this.stack[0]=n,this.index=0,this.default=n}};function Yo(r,e,t,o){for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;for(let n=0;n<r.length;n++)if(r[n]!==t[n])return!1;return!0}var yt=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,t){let o={colorMatrix:e,colorOffset:t};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current);let t=this.renderPass.getCurrentShader();ee(this.renderPass),t.setUniform("uColorMatrix",e.colorMatrix),t.setUniform("uColorOffset",e.colorOffset)}pop(){this.index--,this.bind()}set(e){let t=this.current,o=this.add(e.colorMatrix,e.colorOffset);Yo(o.colorMatrix,o.colorOffset,t.colorMatrix,t.colorOffset)||this.bind(o)}setDefault(e,t){let o={colorMatrix:e,colorOffset:t};this.stack[0]=o,this.index=0,this.default=o}};var Tt=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,t){let o={framebuffer:e,viewport:t};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(!1,this.default)}bind(e=!0,t){t||(t=this.current);let{framebuffer:o,viewport:n}=t;this.active!==o&&s.bindFramebuffer(s.FRAMEBUFFER,o),e&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),n&&this.renderPass.viewport.set(n.x,n.y,n.width,n.height),this.active=o}pop(){this.current.viewport&&this.renderPass.viewport.pop(),this.index--,this.bind(!1)}set(e,t=!0,o){let n=this.add(e,o);this.bind(t,n)}setDefault(e=null,t){let o={framebuffer:e,viewport:t};this.stack[0]=o,this.index=0,this.default=o}};function zo(){return D.get(S.BATCH_SIZE)}function _e(){return D.get(S.MAX_TEXTURES)}function Xo(r,e,t,o,n,i,m){let a=1/(e-t),d=1/(o-n),f=1/(i-m);r.set([-2*a,0,0,0,0,-2*d,0,0,0,0,2*f,0,(e+t)*a,(n+o)*d,(m+i)*f,1])}var Qo=`#define SHADER_NAME MULTI_QUAD_FRAG
#define numTextures %count%

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

vec4 getSampler (int index, vec2 uv)
{
    for (int i = 0; i < numTextures; ++i)
    {
        vec4 color = texture2D(uTexture[i], uv);

        if (i == index)
        {
            return color * vec4(vTintColor.rgb * vTintColor.a, vTintColor.a);
        }
    }

    //  Return black
    return vec4(0);
}

void main (void)
{
    vec4 color = getSampler(int(vTextureId), vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var gr={aVertexPosition:{size:2},aTextureCoord:{size:2},aTextureId:{size:1},aTintColor:{size:4}};var $o=5120,qo=5121,Ko=5122,Zo=5123;var Jo=5126;function en(r,e){let t=new Map,o={size:1,type:Jo,normalized:!1,stride:0},n=0;for(let[i,m]of Object.entries(e)){let a=s.getAttribLocation(r,i);if(a!==-1){s.enableVertexAttribArray(a);let{size:d=o.size,type:f=o.type,normalized:l=o.normalized,stride:c=o.stride}=m;t.set(i,{index:a,size:d,type:f,normalized:l,stride:c,offset:n});let h=4;f===Zo||f===Ko?h=2:(f===qo||f===$o)&&(h=1),n+=d*h}}return t}function rn(r,e,t){s.bindFramebuffer(s.FRAMEBUFFER,r);let o=s.createRenderbuffer();return s.bindRenderbuffer(s.RENDERBUFFER,o),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,e,t),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o),s.bindFramebuffer(s.FRAMEBUFFER,null),o}function Rr(...r){r.forEach(e=>{s.deleteShader(e)})}function tn(...r){let e=s.createProgram();if(r.forEach(o=>{s.attachShader(e,o)}),s.linkProgram(e),!s.getProgramParameter(e,s.LINK_STATUS)){let o=s.getProgramInfoLog(e);return console.error(`Error linking program: ${o}`),s.deleteProgram(e),Rr(...r),null}return e}function gt(r,e){let t=s.createShader(e);if(s.shaderSource(t,r),s.compileShader(t),!s.getShaderParameter(t,s.COMPILE_STATUS)){let n=s.getShaderInfoLog(t),i=r.split(`
`).map((m,a)=>`${a}: ${m}`);return console.error(`Error compiling shader: ${n}`,i.join(`
`)),s.deleteShader(t),null}return t}function on(r,e,t=!1){switch(r.type){case s.INT:case s.BOOL:return t?o=>{s.uniform1iv(e,o)}:o=>{s.uniform1i(e,o)};case s.INT_VEC2:case s.BOOL_VEC2:return o=>{s.uniform2iv(e,o)};case s.INT_VEC3:case s.BOOL_VEC3:return o=>{s.uniform3iv(e,o)};case s.INT_VEC4:case s.BOOL_VEC4:return o=>{s.uniform4iv(e,o)};case s.FLOAT:return t?o=>{s.uniform1fv(e,o)}:o=>{s.uniform1f(e,o)};case s.FLOAT_VEC2:return o=>{s.uniform2fv(e,o)};case s.FLOAT_VEC3:return o=>{s.uniform3fv(e,o)};case s.FLOAT_VEC4:return o=>{s.uniform4fv(e,o)};case s.FLOAT_MAT2:return o=>{s.uniformMatrix2fv(e,!1,o)};case s.FLOAT_MAT3:return o=>{s.uniformMatrix3fv(e,!1,o)};case s.FLOAT_MAT4:return o=>{s.uniformMatrix4fv(e,!1,o)};case s.SAMPLER_2D:case s.SAMPLER_CUBE:return r.size>1?o=>{s.uniform1iv(e,o)}:o=>{s.uniform1i(e,o)}}}function nn(r){let e=new Map,t=s.getProgramParameter(r,s.ACTIVE_UNIFORMS);for(let o=0;o<t;o++){let n=s.getActiveUniform(r,o),i=n.name;if(i.startsWith("gl_")||i.startsWith("webgl_"))continue;let m=s.getUniformLocation(r,i);if(m){let a=!1;i.endsWith("[0]")&&(i=i.slice(0,-3),a=n.size>1),e.set(i,on(n,m,a))}}return e}var sn={uProjectionMatrix:new Float32Array(16),uCameraMatrix:new Float32Array(16),uTexture:0,uColorMatrix:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uColorOffset:new Float32Array(4)};var mn=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var an=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;function vr(r){let{x:e,y:t,width:o,height:n}=r,i=r.texture.width,m=r.texture.height;return r.u0=e/i,r.v0=t/m,r.u1=(e+o)/i,r.v1=(t+n)/m,r}var Er=class{texture;key;x;y;width;height;trimmed=!1;sourceSizeWidth;sourceSizeHeight;spriteSourceSizeX;spriteSourceSizeY;spriteSourceSizeWidth;spriteSourceSizeHeight;pivot;u0;v0;u1;v1;constructor(e,t,o,n,i,m){this.texture=e,this.key=t,this.x=o,this.y=n,this.width=i,this.height=m,this.sourceSizeWidth=i,this.sourceSizeHeight=m,vr(this)}destroy(){this.texture=null}};function un(r,e,t){return r.width=e,r.height=t,r.sourceSizeWidth=e,r.sourceSizeHeight=t,vr(r)}var ce=class{key="";locked=!0;width;height;image;binding;firstFrame;frames;data;constructor(e,t,o,n){e&&(t=e.width,o=e.height),this.image=e,this.width=t,this.height=o,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,t,o),Oe.add(this,n)}addFrame(e,t,o,n,i){if(this.frames.has(e))return null;let m=new Er(this,e,t,o,n,i);return this.frames.set(e,m),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=m),m}getFrame(e){if(!e)return this.firstFrame;e instanceof Er&&(e=e.key);let t=this.frames.get(e);return t||(console.warn(`Frame missing: ${e}`),t=this.firstFrame),t}setSize(e,t){this.width=e,this.height=t;let o=this.frames.get("__BASE");un(o,e,t)}update(e,t){this.image=e,this.setSize(e.width,e.height),Oe.add(this,t)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.binding=null,this.data=null,this.image=null,this.firstFrame=null}};var Rt=class{program;attributes;uniforms;uniformSetters;texture;framebuffer;renderToFramebuffer=!1;renderToDepthbuffer=!1;isActive=!1;constructor(e){e&&this.fromConfig(e)}fromConfig(e){let{attributes:t=gr,fragmentShader:o=mn,height:n=hr(),renderToFramebuffer:i=!1,renderToDepthbuffer:m=!1,resolution:a=br(),vertexShader:d=an,width:f=Cr(),uniforms:l=sn}=e;if(this.create(o,d,l,t),i){this.renderToFramebuffer=!0;let c=new ce(null,f*a,n*a),h=new Ze(c);h.framebuffer=Sr(h.texture),m&&(this.renderToDepthbuffer=!0,h.depthbuffer=rn(h.framebuffer,c.width,c.height)),this.texture=c,this.framebuffer=h.framebuffer}}create(e,t,o,n){let i=gt(e,s.FRAGMENT_SHADER),m=gt(t,s.VERTEX_SHADER);if(!i||!m)return;let a=tn(i,m);if(!a)return;let d=s.getParameter(s.CURRENT_PROGRAM);s.useProgram(a),this.program=a,this.uniformSetters=nn(a),this.uniforms=new Map;for(let[f,l]of Object.entries(o))this.uniformSetters.has(f)&&this.uniforms.set(f,l);this.attributes=en(a,n),s.useProgram(d),this.isActive=!1}updateUniforms(e){}bind(e){let t=this.uniforms;return t.set("uProjectionMatrix",e.projectionMatrix),t.set("uCameraMatrix",e.cameraMatrix),this.updateUniforms(e),this.setUniforms(e)}setUniform(e,t){let o=this.uniforms;o.has(e)&&(o.set(e,t),this.uniformSetters.get(e)(t))}setUniforms(e){if(!this.program)return!1;s.useProgram(this.program),this.isActive=!0;let t=this.uniforms;for(let[o,n]of this.uniformSetters.entries())n(t.get(o));return!0}setAttributes(e){if(this.program){let t=e.vertexbuffer.current.vertexByteSize;this.attributes.forEach(o=>{s.vertexAttribPointer(o.index,o.size,o.type,o.normalized,t,o.offset)})}}destroy(){Rr(this.program),Ke(this.texture),yr(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var We=class extends Rt{constructor(e={}){e.attributes=e?.attributes||gr,super(e)}};var vt=class extends We{constructor(e={}){e.fragmentShader=e?.fragmentShader||Qo,super(e)}create(e,t,o,n){let i=_e();e=e.replace(/%count%/gi,`${i}`),super.create(e,t,o,n)}bind(e){return this.uniforms.set("uTexture",e.textures.textureIndex),super.bind(e)}};var Et=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,t){let o={shader:e,textureID:t};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.shader.isActive||e.shader.bind(this.renderPass,e.textureID)&&(e.shader.setAttributes(this.renderPass),this.active&&this.active!==e.shader&&(this.active.isActive=!1),this.active=e.shader)}pop(){this.index--,this.bind()}set(e,t){let o=this.add(e,t);this.bind(o)}setDefault(e,t){let o={shader:e,textureID:t};this.stack[0]=o,this.index=0,this.default=o}};var Gt={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},Gr={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},re={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Lr={uint8:2**8,uint16:2**16,uint32:2**32},Ls=r=>e=>Math.ceil(e/r)*r,dn=Ls(4),As=Symbol("storeRef"),Je=Symbol("storeSize"),Ps=Symbol("storeMaps"),te=Symbol("storeFlattened"),Ar=Symbol("storeBase"),fn=Symbol("storeType"),Lt=Symbol("storeArrayCount"),pe=Symbol("storeSubarrays"),er=Symbol("subarrayCursors"),ln=Symbol("subarray"),At=Symbol("subarrayFrom"),Pt=Symbol("subarrayTo"),Ot=Symbol("subStore"),_t=Symbol("tagStore"),Sd=Symbol("queryShadow"),Dd=Symbol("serializeShadow"),Pr=Symbol("indexType"),Or=Symbol("indexBytes"),cn=Symbol("isEidType"),he={},Os=(r,e)=>{let t=new ArrayBuffer(e*r.BYTES_PER_ELEMENT),o=new r.constructor(t);return o.set(r,0),o},_s=(r,e)=>{if(ArrayBuffer.isView(r))r[e]=r.slice(0).fill(0);else{let t=r[Ot].slice(0).fill(0);r[e]=r.map((o,n)=>{let i=r[n][At],m=r[n][Pt];return t.subarray(i,m)})}},Ws=(r,e,t)=>{let o=r[er],n=e[fn],i=e[0].length,m=i<=Lr.uint8?"ui8":i<=Lr.uint16?"ui16":"ui32",a=r[Lt][n],d=Array(a).fill(0).reduce((h,b)=>h+i,0),f=new re[n](dn(d*t));f.set(r[pe][n]),r[pe][n]=f,f[Pr]=Gr[m],f[Or]=re[m].BYTES_PER_ELEMENT;let l=o[n],c=0;for(let h=0;h<t;h++){let b=o[n]+h*i,p=b+i;e[h]=r[pe][n].subarray(b,p),e[h][At]=b,e[h][Pt]=p,e[h][ln]=!0,e[h][Pr]=Gr[m],e[h][Or]=re[m].BYTES_PER_ELEMENT,c=p}o[n]=c,e[Ot]=r[pe][n].subarray(l,c)},pn=(r,e,t)=>{Object.keys(e).forEach(o=>{let n=e[o];Array.isArray(n)?(Ws(r,n,t),e[te].push(n)):ArrayBuffer.isView(n)?(e[o]=Os(n,t),e[te].push(e[o])):typeof n=="object"&&pn(r,e[o],t)})},Bs=(r,e)=>{r[_t]||(r[Je]=e,r[te].length=0,Object.keys(r[er]).forEach(t=>{r[er][t]=0}),pn(r,r,e))},hn=(r,e)=>{r[te]&&r[te].forEach(t=>{ArrayBuffer.isView(t)?t[e]=0:t[e].fill(0)})},Fs=(r,e)=>{let t=e*re[r].BYTES_PER_ELEMENT,o=new ArrayBuffer(t),n=new re[r](o);return n[cn]=r===Gt.eid,n};var Ms=(r,e,t)=>{let o=r[Je],n=Array(o).fill(0);n[fn]=e,n[cn]=e===Gt.eid;let i=r[er],m=t<Lr.uint8?"ui8":t<Lr.uint16?"ui16":"ui32";if(!t)throw new Error("bitECS - Must define component array length");if(!re[e])throw new Error(`bitECS - Invalid component array property type ${e}`);if(!r[pe][e]){let f=r[Lt][e],l=Array(f).fill(0).reduce((h,b)=>h+t,0),c=new re[e](dn(l*o));r[pe][e]=c,c[Pr]=Gr[m],c[Or]=re[m].BYTES_PER_ELEMENT}let a=i[e],d=0;for(let f=0;f<o;f++){let l=i[e]+f*t,c=l+t;n[f]=r[pe][e].subarray(l,c),n[f][At]=l,n[f][Pt]=c,n[f][ln]=!0,n[f][Pr]=Gr[m],n[f][Or]=re[m].BYTES_PER_ELEMENT,d=c}return i[e]=d,n[Ot]=r[pe][e].subarray(a,d),n},bn=r=>Array.isArray(r)&&typeof r[0]=="string"&&typeof r[1]=="number",Ns=(r,e)=>{let t=Symbol("store");if(!r||!Object.keys(r).length)return he[t]={[Je]:e,[_t]:!0,[Ar]:()=>he[t]},he[t];r=JSON.parse(JSON.stringify(r));let o={},n=m=>{let a=Object.keys(m);for(let d of a)bn(m[d])?(o[m[d][0]]||(o[m[d][0]]=0),o[m[d][0]]++):m[d]instanceof Object&&n(m[d])};n(r);let i={[Je]:e,[Ps]:{},[pe]:{},[As]:t,[er]:Object.keys(re).reduce((m,a)=>({...m,[a]:0}),{}),[te]:[],[Lt]:o};if(r instanceof Object&&Object.keys(r).length){let m=(a,d)=>{if(typeof a[d]=="string")a[d]=Fs(a[d],e),a[d][Ar]=()=>he[t],i[te].push(a[d]);else if(bn(a[d])){let[f,l]=a[d];a[d]=Ms(i,f,l),a[d][Ar]=()=>he[t],i[te].push(a[d])}else a[d]instanceof Object&&(a[d]=Object.keys(a[d]).reduce(m,a[d]));return a};return he[t]=Object.assign(Object.keys(r).reduce(m,r),i),he[t][Ar]=()=>he[t],he[t]}},Cn=()=>{let r=[],e=[];r.sort=function(i){let m=Array.prototype.sort.call(this,i);for(let a=0;a<r.length;a++)e[r[a]]=a;return m};let t=i=>r[e[i]]===i;return{add:i=>{t(i)||(e[i]=r.push(i)-1)},remove:i=>{if(!t(i))return;let m=e[i],a=r.pop();a!==i&&(r[m]=a,e[a]=m)},has:t,sparse:e,dense:r}};var yd=new Map;var oe=Symbol("entityMasks"),rr=Symbol("entityComponents"),Be=Symbol("entitySparseSet"),tr=Symbol("entityArray"),Td=Symbol("entityIndices"),gd=Symbol("removedEntities"),Fe=1e5,_r=0,xn=Fe,ws=()=>xn,Wr=[],Us=()=>{xn=Fe,_r=0,Wr.length=0},Hs=()=>Fe,Wt=r=>{Fe=r,Us()},Vs=()=>_r,js=new Map,ne=r=>{let e=Wr.length>0?Wr.shift():_r++;return r[Be].add(e),js.set(e,r),_r>=Fe&&console.error(`bitECS - max entities of ${Fe} reached, increase with setDefaultSize function.`),r[Bt].forEach(t=>{Nr(r,t,e)&&wr(t,e)}),r[rr].set(e,new Set),e},or=(r,e)=>{if(!!r[Be].has(e)){r[Br].forEach(t=>{Mt(r,t,e)}),Wr.push(e),r[Be].remove(e),r[rr].delete(e);for(let t=0;t<r[oe].length;t++)r[oe][t][e]=0}};function ks(...r){return function(){return r}}function Ys(...r){return function(){return r}}function zs(...r){return function(){return r}}var Br=Symbol("queries"),Bt=Symbol("notQueries"),Xs=Symbol("queryAny"),Qs=Symbol("queryAll"),$s=Symbol("queryNone"),Fr=Symbol("queryMap"),Mr=Symbol("$dirtyQueries"),In=Symbol("queryComponents"),Rd=Symbol("enterQuery"),vd=Symbol("exitQuery");var qs=(r,e)=>{let t=[],o=[],n=[];e[In].forEach(I=>{if(typeof I=="function"){let[O,ue]=I();r[ie].has(O)||Nt(r,O),ue==="not"&&o.push(O),ue==="changed"&&(n.push(O),t.push(O))}else r[ie].has(I)||Nt(r,I),t.push(I)});let i=I=>r[ie].get(I),m=t.concat(o).map(i),a=Cn(),d=[],f=[],l=[],c=[],h=[],b=m.map(I=>I.generationId).reduce((I,O)=>(I.includes(O)||I.push(O),I),[]),p=(I,O)=>(I[O.generationId]||(I[O.generationId]=0),I[O.generationId]|=O.bitflag,I),T=t.map(i).reduce(p,{}),x=o.map(i).reduce(p,{}),E=m.reduce(p,{}),P=t.filter(I=>!I[_t]).map(I=>Object.getOwnPropertySymbols(I).includes(te)?I[te]:[I]).reduce((I,O)=>I.concat(O),[]),B=P.map(I=>{let O=Symbol();return _s(I,O),I[O]},[]),V=Object.assign(a,{archetypes:d,changed:f,components:t,notComponents:o,changedComponents:n,masks:T,notMasks:x,hasMasks:E,generations:b,flatProps:P,toRemove:l,entered:c,exited:h,shadows:B});r[Fr].set(e,V),r[Br].add(V),m.forEach(I=>{I.queries.add(V)}),o.length&&r[Bt].add(V);for(let I=0;I<Vs();I++)!r[Be].has(I)||Nr(r,V,I)&&wr(V,I)},Ks=(r,e)=>{e&&(r.changed=[]);let{flatProps:t,shadows:o}=r;for(let n=0;n<r.dense.length;n++){let i=r.dense[n],m=!1;for(let a=0;a<t.length;a++){let d=t[a],f=o[a];if(ArrayBuffer.isView(d[i])){for(let l=0;l<d[i].length;l++)if(d[i][l]!==f[i][l]){m=!0,f[i][l]=d[i][l];break}}else d[i]!==f[i]&&(m=!0,f[i]=d[i])}m&&r.changed.push(i)}return r.changed},Zs=(r,e)=>r.concat(e),Ft=r=>e=>e.filter(t=>t.name===r().constructor.name).reduce(Zs),Js=Ft(ks),em=Ft(Ys),rm=Ft(zs),nr=(...r)=>{let e,t,o,n;if(Array.isArray(r[0])?e=r[0]:(t=Js(r),o=em(r),n=rm(r)),e===void 0||e[ie]!==void 0)return m=>m?m[tr]:e[tr];let i=function(m,a=!0){m[Fr].has(i)||qs(m,i);let d=m[Fr].get(i);return om(m),d.changedComponents.length?Ks(d,a):d.dense};return i[In]=e,i[Xs]=t,i[Qs]=o,i[$s]=n,i},Nr=(r,e,t)=>{let{masks:o,notMasks:n,generations:i}=e,m=0;for(let a=0;a<i.length;a++){let d=i[a],f=o[d],l=n[d],c=r[oe][d][t];if(l&&(c&l)>0||f&&(c&f)!==f)return!1}return!0},wr=(r,e)=>{r.has(e)||(r.add(e),r.entered.push(e))},tm=r=>{for(;r.toRemove.length;)r.remove(r.toRemove.pop())},om=r=>{r[Mr].forEach(tm),r[Mr].clear()},Mt=(r,e,t)=>{!e.has(t)||(e.toRemove.push(t),r[Mr].add(e),e.exited.push(t))};var ie=Symbol("componentMap"),nm=[],Y=r=>{let e=Ns(r,Hs());return r&&Object.keys(r).length&&nm.push(e),e},im=r=>{r[sr]*=2,r[sr]>=2**31&&(r[sr]=1,r[oe].push(new Uint32Array(r[Ur])))},Nt=(r,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");let t=new Set,o=new Set,n=new Set;r[Br].forEach(i=>{i.components.includes(e)&&t.add(i)}),r[ie].set(e,{generationId:r[oe].length-1,bitflag:r[sr],store:e,queries:t,notQueries:o,changedQueries:n}),e[Je]<r[Ur]&&Bs(e,r[Ur]),im(r)};var ir=(r,e,t)=>{let o=r[ie].get(e);if(!o)return;let{generationId:n,bitflag:i}=o;return(r[oe][n][t]&i)===i},q=(r,e,t,o=!0)=>{if(r[ie].has(e)||Nt(r,e),ir(r,e,t))return;let n=r[ie].get(e),{generationId:i,bitflag:m,queries:a,notQueries:d}=n;r[oe][i][t]|=m,a.forEach(f=>{Nr(r,f,t)?wr(f,t):Mt(r,f,t)}),r[rr].get(t).add(e),o&&hn(e,t)},Ce=(r,e,t,o=!1)=>{let n=r[ie].get(e),{generationId:i,bitflag:m,queries:a,notQueries:d}=n;!(r[oe][i][t]&m)||(r[oe][i][t]&=~m,a.forEach(f=>{Nr(r,f,t)?wr(f,t):Mt(r,f,t)}),r[rr].get(t).delete(e),o&&hn(e,t))},Ur=Symbol("size"),Ed=Symbol("resizeThreshold"),sr=Symbol("bitflag"),sm=Symbol("archetypes"),mm=Symbol("localEntities"),am=[],Sn=()=>{let r={};return um(r),am.push(r),r},um=r=>{let e=ws();return r[Ur]=e,r[tr]&&r[tr].forEach(t=>or(r,t)),r[oe]=[new Uint32Array(e)],r[rr]=new Map,r[sm]=[],r[Be]=Cn(),r[tr]=r[Be].dense,r[sr]=1,r[ie]=new Map,r[Fr]=new Map,r[Br]=new Set,r[Bt]=new Set,r[Mr]=new Set,r[mm]=new Map,r};var U=Gt;var u={IS_ROOT:0,DIRTY:1,X:2,Y:3,ROTATION:4,SCALE_X:5,SCALE_Y:6,SKEW_X:7,SKEW_Y:8,AXIS_ALIGNED:9,FRAME_X1:10,FRAME_Y1:11,FRAME_X2:12,FRAME_Y2:13,LOCAL_A:14,LOCAL_B:15,LOCAL_C:16,LOCAL_D:17,LOCAL_TX:18,LOCAL_TY:19,BOUNDS_X1:20,BOUNDS_Y1:21,BOUNDS_X2:22,BOUNDS_Y2:23,ORIGIN_X:24,ORIGIN_Y:25,WORLD_A:26,WORLD_B:27,WORLD_C:28,WORLD_D:29,WORLD_TX:30,WORLD_TY:31,FRAME_WIDTH:32,FRAME_HEIGHT:33,DIRTY_WORLD:34,IN_VIEW:35,UPDATED:36},C=Y({data:[U.f32,37]});window.defaultSize?Wt(parseInt(window.defaultSize)):Wt(1e4);var dm=Sn(),G=dm;function Hr(r,e=0,t=0,o=0,n=0){q(G,C,r);let i=C.data[r];i[u.IS_ROOT]=0,i[u.DIRTY]=1,i[u.X]=e,i[u.Y]=t,i[u.SCALE_X]=1,i[u.SCALE_Y]=1,i[u.ORIGIN_X]=o,i[u.ORIGIN_Y]=n,i[u.AXIS_ALIGNED]=1,i[u.IN_VIEW]=1}function wt(){}var mr=class{data;onChange;constructor(e){let t=new Float32Array(16);this.data=t,this.onChange=wt,e?Array.isArray(e)?this.fromArray(e):this.fromArray(e.data):(t[0]=1,t[5]=1,t[10]=1,t[15]=1)}set(e,t,o,n,i,m,a,d,f,l,c,h,b,p,T,x){return this.data.set([e,t,o,n,i,m,a,d,f,l,c,h,b,p,T,x]),this.onChange(this),this}toArray(e=[],t=0){let o=this.data;for(let n=0;n<16;n++)e[t+n]=o[n];return e}fromArray(e,t=0){let o=this.data;for(let n=0;n<16;n++)o[n]=e[t+n];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=wt,this.data=null}};function Vr(r,e,t,o,n){let i=C.data[r];i[u.BOUNDS_X1]=e,i[u.BOUNDS_Y1]=t,i[u.BOUNDS_X2]=o,i[u.BOUNDS_Y2]=n}var Ut=class{id=ne(G);type="StaticCamera";name="";isDirty=!0;matrix;constructor(e,t){let o=this.id;Hr(o,0,0,0,0),this.matrix=new mr,this.reset(e,t)}getBoundsX(){return C.data[this.id][u.BOUNDS_X1]}getBoundsY(){return C.data[this.id][u.BOUNDS_Y1]}getBoundsRight(){return C.data[this.id][u.BOUNDS_X2]}getBoundsBottom(){return C.data[this.id][u.BOUNDS_Y2]}getMatrix(){return this.matrix.data}updateBounds(){return this.isDirty=!0,!0}update(){return!1}reset(e,t){Vr(this.id,0,0,e,t)}destroy(){let e=this.id;Ce(G,C,e),or(G,e)}};function Dn(){let r=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),e=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);console.log("MAX GPU",r,"MAX COMBINED",e);let t=_e();t===0||t>r?xr(r):r=t;let o=[];for(let n=0;n<r;n++){let i=s.createTexture();s.activeTexture(s.TEXTURE0+n),s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o.push([n,i])}return o}var yn,jr={get:()=>yn,set:r=>{yn=r}};var Ht=class{renderPass;textures;tempTextures;textureIndex;maxTextures;constructor(e){this.renderPass=e}bind(e,t=0){let o=e.binding;o.bind(t),s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,o.texture)}unbind(e=0){s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,this.tempTextures[e])}unbindTexture(e){let t=e.binding.textureUnit;e.binding.unbind(),s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,this.tempTextures[t])}setWhite(){return this.set(jr.get())}set(e){if(!e.binding)return-1;let t=e.binding,o=this.textures;if(!t.isBound){o.size===this.maxTextures&&(ee(this.renderPass),this.clear());let n=o.size;s.activeTexture(s.TEXTURE0+n),s.bindTexture(s.TEXTURE_2D,t.texture),o.set(n,e),t.bind(n)}return t.textureUnit}setDefault(){this.textures&&this.reset();let e=Dn();this.maxTextures=e.length,this.tempTextures=new Map(e),this.textures=new Map,this.textureIndex=[],this.tempTextures.forEach((t,o)=>{this.textureIndex.push(o)})}clear(){this.textures.forEach(e=>e.binding.unbind()),this.textures.clear()}reset(){this.tempTextures.forEach((e,t)=>{s.activeTexture(s.TEXTURE0+t),s.bindTexture(s.TEXTURE_2D,e)}),this.clear()}};function Vt(r){s.isBuffer(r)&&s.deleteBuffer(r)}var jt=class{name;batchSize;dataSize;vertexElementSize;vertexByteSize;entryByteSize;bufferByteSize;data;vertexViewF32;vertexBuffer;entryElementSize;indexed=!1;isDynamic=!1;count=0;offset=0;elementsPerEntry;isBound=!1;constructor(e={}){let{name:t="VBO",batchSize:o=1,dataSize:n=4,isDynamic:i=!0,elementsPerEntry:m=3,vertexElementSize:a=9}=e;this.name=t,this.batchSize=o,this.dataSize=n,this.vertexElementSize=a,this.isDynamic=i,this.elementsPerEntry=m,this.vertexByteSize=a*n,this.entryByteSize=this.vertexByteSize*m,this.bufferByteSize=o*this.entryByteSize,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry,this.create()}resize(e){this.batchSize=e,this.bufferByteSize=e*this.entryByteSize,this.vertexBuffer&&Vt(this.vertexBuffer),this.create()}create(){let e=new ArrayBuffer(this.bufferByteSize);this.data=e,this.vertexViewF32=new Float32Array(e),this.vertexBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);let t=this.isDynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW;s.bufferData(s.ARRAY_BUFFER,e,t),s.bindBuffer(s.ARRAY_BUFFER,null),this.isBound=!1}add(e){this.count+=e,this.offset+=this.vertexElementSize*e}reset(){this.count=0,this.offset=0}canContain(e){return this.count+e<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Vt(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexBuffer=null}};var kt=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e){return this.index++,this.index===this.stack.length?this.stack.push(e):this.stack[this.index]=e,e}bindDefault(){this.index=0,this.bind(this.default)}bind(e){if(e||(e=this.current),!e.isBound){let t=e.indexed?e.indexBuffer:null;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.bindBuffer(s.ARRAY_BUFFER,e.vertexBuffer),e.isBound=!0,this.active&&this.active!==e&&(this.active.isBound=!1),this.active=e}}pop(){this.index--,this.bind()}set(e){let t=this.add(e);this.bind(t)}setDefault(e){this.stack[0]=e,this.index=0,this.default=e}};function Tn(r,e,t){return r.width<=0||r.height<=0?!1:r.x<=e&&r.x+r.width>=e&&r.y<=t&&r.y+r.height>=t}var kr=class{x;y;width;height;constructor(e=0,t=0,o=0,n=0){this.set(e,t,o,n)}set(e=0,t=0,o=0,n=0){return this.x=e,this.y=t,this.width=o,this.height=n,this}contains(e,t){return Tn(this,e,t)}set right(e){e<=this.x?this.width=0:this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){e<=this.y?this.height=0:this.height=e-this.y}get bottom(){return this.y+this.height}};function gn(r,e){return r.x===e.x&&r.y===e.y&&r.width===e.width&&r.height===e.height}var Yt=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e=0,t=0,o=0,n=0){let i=new kr(e,t,o,n);return this.index++,this.index===this.stack.length?this.stack.push(i):this.stack[this.index]=i,i}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),(!this.active||!gn(this.active,e))&&(s.viewport(e.x,e.y,e.width,e.height),this.active=e)}pop(){this.index--,this.bind()}set(e=0,t=0,o=0,n=0){let i=this.add(e,t,o,n);this.bind(i)}setDefault(e=0,t=0,o=0,n=0){let i=new kr(e,t,o,n);this.stack[0]=i,this.index=0,this.default=i}};var zt=class{renderer;projectionMatrix;cameraMatrix;count=0;prevCount=0;flushTotal=0;framebuffer;vertexbuffer;blendMode;shader;viewport;textures;colorMatrix;quadShader;quadCamera;current2DCamera;constructor(e){this.renderer=e,this.projectionMatrix=new Float32Array(16),this.framebuffer=new Tt(this),this.vertexbuffer=new kt(this),this.blendMode=new Dt(this),this.shader=new Et(this),this.viewport=new Yt(this),this.textures=new Ht(this),this.colorMatrix=new yt(this),this.reset()}getCurrentShader(){return this.shader.current.shader}flush(){this.prevCount=this.count,this.count=0,this.flushTotal++}reset(){let e=this.renderer.gl;this.quadShader=new We,this.quadCamera=new Ut(this.renderer.width,this.renderer.height),this.textures.setDefault(),this.framebuffer.setDefault(),this.blendMode.setDefault(!0,e.ONE,e.ONE_MINUS_SRC_ALPHA),this.colorMatrix.setDefault(Tr,ko),this.vertexbuffer.setDefault(new jt({batchSize:zo()})),this.shader.setDefault(_e()===1?new We:new vt)}resize(e,t){Xo(this.projectionMatrix,0,e,t,0,-1e3,1e3),this.quadCamera.reset(e,t),this.viewport.setDefault(0,0,e,t)}isCameraDirty(){return this.current2DCamera.isDirty}};function Rn(r){return r.current2DCamera||(r.current2DCamera=r.quadCamera,r.cameraMatrix=r.quadCamera.getMatrix()),r.count=0,r.flushTotal=0,r.framebuffer.bindDefault(),r.blendMode.bindDefault(),r.viewport.bindDefault(),r.vertexbuffer.bindDefault(),r.shader.bindDefault(),r.colorMatrix.bindDefault(),r}var vn,xe={get:()=>vn,set:r=>{vn=r}};var En,Xt={get:()=>En,set:r=>{En=r,xe.set(r)}};var Qt=class{canvas;gl;renderPass;clearColor=[0,0,0,1];width;height;resolution;clearBeforeRender=!0;optimizeRedraw=!0;autoResize=!0;contextLost=!1;compression;constructor(){this.width=Cr(),this.height=hr(),this.resolution=br(),this.setBackgroundColor(Go());let e=document.createElement("canvas");e.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),e.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=e,this.initContext(),Xt.set(this),this.renderPass=new zt(this),this.resize(this.width,this.height,this.resolution),St()}initContext(){let e=this.canvas.getContext("webgl",Uo());Bo.set(e),this.gl=e,this.compression=No(e),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}resize(e,t,o=1){let n=e*o,i=t*o;this.width=n,this.height=i,this.resolution=o;let m=this.canvas;m.width=n,m.height=i,this.autoResize&&(m.style.width=e.toString()+"px",m.style.height=t.toString()+"px"),this.renderPass.resize(n,i)}onContextLost(e){e.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(e){return wo(e,this.clearColor),this}reset(){}begin(e){if(this.contextLost)return;let t=this.gl;if(t.getContextAttributes(),St(),this.optimizeRedraw&&!e,this.clearBeforeRender){let o=this.clearColor;t.clearColor(o[0],o[1],o[2],o[3]),t.clear(t.COLOR_BUFFER_BIT)}return Rn(this.renderPass)}end(){Mo(this.renderPass)}destroy(){Xt.set(void 0)}};function $t(){return()=>{Lo(Qt)}}function Gn(r){D.set(S.WEBGL_CONTEXT,r)}var g={WORLD:0,PARENT:1,NEXT:2,PREV:3,FIRST:4,LAST:5,NUM_CHILDREN:6,DEPTH:7},R=Y({data:[U.ui32,8]});function Me(r){return R.data[r][g.LAST]}function z(r){return R.data[r][g.NUM_CHILDREN]}function W(r){return R.data[r][g.PARENT]}function Ln(r,e){let t=e.id,o=r.id;return!(o===0||t===o||o===W(t))}function Ne(r,e){R.data[r][g.NEXT]=e}function we(r,e){R.data[r][g.PREV]=e}function Ue(r,e){Ne(r,e),we(e,r)}function M(r){return R.data[r][g.FIRST]}function w(r){return R.data[r][g.NEXT]}function Yr(r){return R.data[r][g.PREV]}function An(r){q(G,R,r)}function zr(r,e=1){let t=R.data[r];t[g.NUM_CHILDREN]-=e,t[g.NUM_CHILDREN]<0&&(t[g.NUM_CHILDREN]=0)}var N={local:[],set:function(r,e){this.local[r]=e},get:function(r){return this.local[r]},clear:function(){this.local.length=0},remove:function(r){this.local[r]=null}};function F(r){return R.data[r][g.WORLD]}function Pn(r){let e=[],t=W(r);for(;t;)e.push(t),t=W(t);return e}var v={CHILD:0,CHILD_CACHE:1,CHILD_TRANSFORM:2,CHILD_WORLD_TRANSFORM:3,CHILD_COLOR:4,DISPLAY_LIST:5,COLOR:6},y=Y({data:[U.ui8,7]});function On(r){y.data[r][v.CHILD]=1}function _n(r){y.data[r][v.CHILD_CACHE]=1}function He(r){y.data[r][v.CHILD_TRANSFORM]=1}function se(r){C.data[r][u.DIRTY]=1,X(r)}var A={VISIBLE:0,VISIBLE_CHILDREN:1,WILL_UPDATE:2,WILL_UPDATE_CHILDREN:3,WILL_RENDER:4,WILL_RENDER_CHILDREN:5,WILL_CACHE_CHILDREN:6,WILL_TRANSFORM_CHILDREN:7,WILL_COLOR_CHILDREN:8},L=Y({data:[U.ui8,9]});function Le(r){return Boolean(L.data[r][A.WILL_CACHE_CHILDREN])}function Ve(r){return Boolean(L.data[r][A.WILL_TRANSFORM_CHILDREN])}function X(r){let e=F(r),t=Pn(r);for(let o=0;o<t.length;o++){let n=t[o];On(n),Ve(n)&&se(n),Le(n)&&_n(n),n===e&&He(n)}}function Wn(r){let e=F(r),t=W(r),o=N.get(e);R.data[r][g.WORLD]=0,R.data[r][g.PARENT]=0,o&&ir(G,o.tag,r)&&Ce(G,o.tag,r),zr(t),X(r)}function Bn(r,e){let t=M(r);if(t>0)return t;{let o=w(r);if(o===0){let n=W(r);return n===e?0:w(n)}else return o}}function Xr(r,e=!0){let t=[r],o=M(r);for(;o>0;)t.push(o),o=Bn(o,r);return e&&t.shift(),t}function Fn(r){let e=M(r.id),t=[];for(;e>0;)t.push(e),e=w(e);return t}function Mn(r){let e=[],t=M(r);for(;t>0;)e.push(N.get(t)),t=w(t);return e}function Nn(r){return R.data[r][g.DEPTH]}function wn(r){return N.get(R.data[r][g.PARENT])}function Qr(r){let e=F(r);if(e)return N.get(e)}function $r(r){let e=F(r);return N.get(e)}function Un(r,e){R.data[r][g.DEPTH]=e}function Ie(r,e){R.data[r][g.NUM_CHILDREN]=e}function qr(r,e){R.data[r][g.PARENT]=e}function je(r,e){R.data[r][g.WORLD]=e}function Hn(r){let e=$r(r);Xr(r,!1).map(o=>{Ce(G,e.tag,o),je(o,0)})}function be(r,e){R.data[r][g.FIRST]=e}function me(r,e){R.data[r][g.LAST]=e}function Vn(r,e){let t=W(r);if(t){let i=M(t),m=Me(t),a=w(r),d=Yr(r);r===i&&be(t,a),r===m&&me(t,d),a&&we(a,d),d&&Ne(d,a),X(r),qr(r,0),Ie(t,z(t)-1)}let o=Qr(r),n=e?Qr(e):null;o&&o!==n&&Hn(r)}function jn(r){y.data[r][v.CHILD_COLOR]=1}function ke(r){y.data[r][v.DISPLAY_LIST]=1}function kn(r,e){let t=r.id,o=r.tag;Xr(e,!1).map(i=>{q(G,o,i),je(i,t)}),ke(t),jn(t),He(t)}function Yn(r){let e=F(r),t=W(r),o=!0;for(;t&&t!==e;){if(Ve(t)){o=!1;break}t=W(t)}C.data[r][u.IS_ROOT]=Number(o)}function zn(r,e,t=1){qr(e,r),se(e),X(e),Yn(e),Ie(r,z(r)+t);let o=$r(r);o&&kn(o,e)}function ar(r,e){if(Ln(r,e)){let t=e.id,o=r.id,n=z(o);if(Vn(t,o),n===0)be(o,t);else{let i=Me(o);Ue(i,t)}me(o,t),zn(o,t)}return e}function Xn(r,e){let t=e.length;if(t===0){Ie(r,0),be(r,0),me(r,0);return}let o=1,n=e[0];if(be(r,n),t===1){me(r,n),Ie(r,o);return}for(let i=1;i<t;i++){let m=e[i];Ue(n,m),n=m,o++}me(r,n),Ie(r,o)}function Kr(r,e=0,t){let o=r.id;t===void 0&&(t=z(o));let n=t-e;if(n>0&&n<=t){let i=Fn(r),m=i.splice(e,n);return m.forEach(a=>{Wn(a)}),Xn(o,i),m.map(a=>N.get(a))}else return[]}function Qn(r){let e=F(r);e>0&&y.data[e][v.DISPLAY_LIST]}function $n(r,e=0,t){Kr(r,e,t).forEach(n=>{n.destroy()}),Qn(r.id)}var _=Y({r:U.ui8c,g:U.ui8c,b:U.ui8c,a:U.f32,colorMatrix:[U.f32,16],colorOffset:[U.f32,4]});function qn(r){q(G,_,r),_.r[r]=255,_.g[r]=255,_.b[r]=255,_.a[r]=1,_.colorMatrix[r].set(Tr)}function ae(r){y.data[r][v.COLOR]=1;let e=F(r);e&&(y.data[e][v.CHILD_COLOR]=1)}function Kn(r){q(G,y,r),ae(r)}function Zn(r){y.data[r][v.CHILD]=0}function Jn(r){y.data[r][v.COLOR]=0}function ei(r){y.data[r][v.DISPLAY_LIST]=0}function Zr(r){C.data[r][u.DIRTY]=0}function ri(r){return Boolean(y.data[r][v.CHILD_CACHE])}function ti(r){return Boolean(y.data[r][v.COLOR])}function Jr(r){return Boolean(y.data[r][v.DISPLAY_LIST])}function et(r){return Boolean(C.data[r][u.DIRTY])}function oi(r,e){L.data[r][A.WILL_COLOR_CHILDREN]=Number(e)}function ni(r){return Boolean(L.data[r][A.WILL_COLOR_CHILDREN])}var qt=class{id;colorMatrixEnabled=!1;constructor(e,t=255,o=255,n=255,i=1){qn(e),this.id=e,this.set(t,o,n,i)}set(e,t,o,n){this.red=e,this.green=t,this.blue=o,this.alpha=n}set tint(e){this.red=e>>16&255,this.green=e>>8&255,this.blue=e&255}get tint(){return this.red<<16|this.green<<8|this.blue}set willColorChildren(e){oi(this.id,e)}get willColorChildren(){return ni(this.id)}set colorMatrix(e){_.colorMatrix[this.id].set(e),ae(this.id),this.colorMatrixEnabled=!0}get colorMatrix(){return _.colorMatrix[this.id]}set colorOffset(e){_.colorOffset[this.id].set(e),ae(this.id)}get colorOffset(){return _.colorOffset[this.id]}set red(e){_.r[this.id]=e,ae(this.id)}get red(){return _.r[this.id]}set green(e){_.g[this.id]=e,ae(this.id)}get green(){return _.g[this.id]}set blue(e){_.b[this.id]=e,ae(this.id)}get blue(){return _.b[this.id]}set alpha(e){_.a[this.id]=e,ae(this.id)}get alpha(){return _.a[this.id]}};function ii(r){q(G,L,r),L.data[r].set([1,1,1,1,1,1,1,1,1])}var si="destroy";function H(r,e,...t){if(r.events.size===0||!r.events.has(e))return!1;let o=r.events.get(e),n=[...o];for(let i of n)i.callback.apply(i.context,t),i.once&&o.delete(i);return o.size===0&&r.events.delete(e),!0}function mi(r){return Boolean(L.data[r][A.VISIBLE])}function rt(r){return Boolean(L.data[r][A.VISIBLE_CHILDREN])}function ai(r,e,t=0,o){let n=Kr(r,t,o);return n.forEach(i=>{ar(e,i)}),n}function ui(r,e){L.data[r][A.VISIBLE]=Number(e),X(r),ke(F(r))}function di(r,e){L.data[r][A.VISIBLE_CHILDREN]=Number(e),X(r),ke(F(r))}function Se(r){return Boolean(L.data[r][A.VISIBLE])&&Boolean(L.data[r][A.WILL_RENDER])}var ur=class{id=ne(G);type="GameObject";name="";events;constructor(){let e=this.id;An(e),ii(e),Kn(e),N.set(e,this),this.events=new Map}isRenderable(){return Se(this.id)}beforeUpdate(e,t){}update(e,t){}afterUpdate(e,t){}preRenderGL(e){}renderGL(e){}renderCanvas(e){}postRenderGL(e){}postRenderCanvas(e){}set visible(e){ui(this.id,e)}get visible(){return mi(this.id)}set visibleChildren(e){di(this.id,e)}get visibleChildren(){return rt(this.id)}set depth(e){Un(this.id,e)}get depth(){return Nn(this.id)}hasParent(e){let t=W(this.id);return e?t===e:t>0}getParent(){return wn(this.id)}getChildren(){return Mn(this.id)}getNumChildren(){return z(this.id)}toString(){return`${this.type} id="${this.id}" name="${this.name}"`}destroy(e){e?ai(this,e):$n(this),H(this,si,this),this.events.clear(),this.events=null}};function Kt(r,e,t){let o=C.data[r],n=-o[u.ORIGIN_X]*e,i=-o[u.ORIGIN_Y]*t;o[u.FRAME_X1]=n,o[u.FRAME_Y1]=i,o[u.FRAME_X2]=n+e,o[u.FRAME_Y2]=i+t,o[u.FRAME_WIDTH]=e,o[u.FRAME_HEIGHT]=t,o[u.WORLD_A]=n,o[u.WORLD_B]=i,o[u.WORLD_C]=n+e,o[u.WORLD_D]=i+t,o[u.WORLD_TX]=e,o[u.WORLD_TY]=t,se(r)}function fi(r,e){e.colorMatrixEnabled&&e.willColorChildren&&r.colorMatrix.pop()}var Zt=class{id;_x;_y;constructor(e,t=0,o=0){this.id=e,this.set(t,o)}set(e,t=e){return this.x=e,this.y=t,this}set x(e){this._x=e;let t=this.id;C.data[t][u.X]=e,se(t)}get x(){return this._x}set y(e){this._y=e;let t=this.id;C.data[t][u.Y]=e,se(t)}get y(){return this._y}};function li(r,e){e.colorMatrixEnabled&&e.willColorChildren&&r.colorMatrix.set(e)}var Jt=class{id;constructor(e,t=0,o=0){this.id=e,this.set(t,o)}set(e,t=e){return this.width=e,this.height=t,this}set width(e){Kt(this.id,e,this.height)}get width(){return C.data[this.id][u.FRAME_WIDTH]}set height(e){Kt(this.id,this.width,e)}get height(){return C.data[this.id][u.FRAME_HEIGHT]}set x(e){this.width=e}get x(){return this.width}set y(e){this.height=e}get y(){return this.height}};var eo,ci={get:()=>eo,set:r=>{if(eo)throw new Error("Cannot instantiate TextureManager more than once");eo=r}};function pi(r){Ne(r,0),we(r,0)}function hi(r){let e=W(r),t=M(e),o=Me(e),n=Yr(r),i=w(r);Ue(n,i),t===r&&be(e,i),o===r&&me(e,n),pi(r)}function bi(r,e){let t=e.id,o=r.id;return e.hasParent(o)&&(hi(t),zr(o)),e}function Ci(r,...e){return e.forEach(t=>{bi(r,t)}),e}var Ye=Y({values:[U.f32,54]});function xi(r,e,t,o,n){let i=Ye.values[r];i[5]=e,i[6]=t,i[7]=o,i[8]=n,i[14]=e,i[15]=t,i[16]=o,i[17]=n,i[23]=e,i[24]=t,i[25]=o,i[26]=n,i[32]=e,i[33]=t,i[34]=o,i[35]=n,i[41]=e,i[42]=t,i[43]=o,i[44]=n,i[50]=e,i[51]=t,i[52]=o,i[53]=n}function dr(r,e,t,o,n,i,m,a,d){let f=Ye.values[r];f[0]=e,f[1]=t,f[9]=o,f[10]=n,f[18]=i,f[19]=m,f[27]=e,f[28]=t,f[36]=i,f[37]=m,f[45]=a,f[46]=d}var tt={buffer:null,F32:null,offset:0};function j(r,e=0){let t=r.vertexbuffer.current;return r.count+e>=t.batchSize&&ee(r),tt.buffer=t,tt.F32=t.vertexViewF32,tt.offset=r.count*t.entryElementSize,r.count+=e,tt}function Ii(r){let e=0,t=r.length;for(let o=0;o<t;o++){let n=r[o];if(ti(n)){let i=_.r[n]/255,m=_.g[n]/255,a=_.b[n]/255,d=_.a[n];xi(n,i,m,a,d),Jn(n),e++}}return e}function Si(r){return rt(r)&&Boolean(L.data[r][A.WILL_RENDER_CHILDREN])}function Di(r,e){let t=z(r);return t===0||!Si(r)?0:e||!Le(r)||Le(r)&&ri(r)?t:0}function yi(r,e){L.data[r][A.WILL_CACHE_CHILDREN]=Number(e)}function Ti(r,e){L.data[r][A.WILL_TRANSFORM_CHILDREN]=Number(e)}function ot(r){return Boolean(L.data[r][A.WILL_UPDATE])}function gi(r){return Boolean(L.data[r][A.WILL_UPDATE_CHILDREN])}function Ri(r,e=[],t=0){return r.set(e[t],e[t+1])}function vi(r,e=[],t=0){return e[t]=r.x,e[t+1]=r.y,e}var fr=class{x;y;constructor(e=0,t=0){this.set(e,t)}set(e=0,t=0){return this.x=e,this.y=t,this}toArray(e=[],t=0){return vi(this,e,t)}fromArray(e,t=0){return Ri(this,e,t),this}toString(){return`{ x=${this.x}, y=${this.y} }`}};function Ei(r){let e=C.data[r];e[u.DIRTY]=0,e[u.DIRTY_WORLD]=0}function Gi(r){y.data[r][v.CHILD_WORLD_TRANSFORM]=1}function Li(r,e,t,o){let n=t.getBoundsX(),i=t.getBoundsY(),m=t.getBoundsRight(),a=t.getBoundsBottom(),d=0,f=0,l=!1,c=e.length;for(let h=0;h<c;h++){let b=e[h],p=C.data[b];if(p[u.DIRTY]===0)continue;let T=p[u.IS_ROOT],x=p[u.X],E=p[u.Y],P=p[u.ROTATION],B=p[u.SCALE_X],V=p[u.SCALE_Y],I=p[u.SKEW_X],O=p[u.SKEW_Y],ue=p[u.AXIS_ALIGNED],Z=p[u.FRAME_X1],de=p[u.FRAME_Y1],fe=p[u.FRAME_X2],le=p[u.FRAME_Y2],k=B,ge=0,Re=0,K=V;if(ue||(k=Math.cos(P+O)*B,ge=Math.sin(P+O)*B,Re=-Math.sin(P-I)*V,K=Math.cos(P-I)*V),p[u.LOCAL_A]=k,p[u.LOCAL_B]=ge,p[u.LOCAL_C]=Re,p[u.LOCAL_D]=K,p[u.LOCAL_TX]=x,p[u.LOCAL_TY]=E,T){if(p[u.WORLD_A]=k,p[u.WORLD_B]=ge,p[u.WORLD_C]=Re,p[u.WORLD_D]=K,p[u.WORLD_TX]=x,p[u.WORLD_TY]=E,p[u.UPDATED]=o,ue){let J=Z*k+x,ve=de*K+E,Xe=Z*k+x,Qe=le*K+E,Ee=fe*k+x,Ge=le*K+E,$e=fe*k+x,qe=de*K+E;p[u.BOUNDS_X1]=J,p[u.BOUNDS_Y1]=ve,p[u.BOUNDS_X2]=Ee,p[u.BOUNDS_Y2]=Ge,p[u.IN_VIEW]=Number(!(m<J||a<ve||n>Ee||i>Ge)),dr(b,J,ve,Xe,Qe,Ee,Ge,$e,qe)}else{let J=Z*k+de*Re+x,ve=Z*ge+de*K+E,Xe=Z*k+le*Re+x,Qe=Z*ge+le*K+E,Ee=fe*k+le*Re+x,Ge=fe*ge+le*K+E,$e=fe*k+de*Re+x,qe=fe*ge+de*K+E,yo=Math.min(J,Xe,Ee,$e),To=Math.min(ve,Qe,Ge,qe),go=Math.max(J,Xe,Ee,$e),Ro=Math.max(ve,Qe,Ge,qe);p[u.BOUNDS_X1]=yo,p[u.BOUNDS_Y1]=To,p[u.BOUNDS_X2]=go,p[u.BOUNDS_Y2]=Ro,p[u.IN_VIEW]=Number(!(m<yo||a<To||n>go||i>Ro)),dr(b,J,ve,Xe,Qe,Ee,Ge,$e,qe)}Ei(b)}else{let J=W(b);J!==f&&(X(b),f=J),l=!0}He(b),d++}return l&&Gi(r),d}function ze(r){C.data[r][u.DIRTY_WORLD]=1}function Ai(r,e){let t=C.data[e],o=C.data[r];t[u.WORLD_A]=o[u.LOCAL_A],t[u.WORLD_B]=o[u.LOCAL_B],t[u.WORLD_C]=o[u.LOCAL_C],t[u.WORLD_D]=o[u.LOCAL_D],t[u.WORLD_TX]=o[u.LOCAL_TX],t[u.WORLD_TY]=o[u.LOCAL_TY],ze(e)}function Pi(r,e){let t=C.data[e],o=C.data[r];t[u.WORLD_A]=o[u.WORLD_A],t[u.WORLD_B]=o[u.WORLD_B],t[u.WORLD_C]=o[u.WORLD_C],t[u.WORLD_D]=o[u.WORLD_D],t[u.WORLD_TX]=o[u.WORLD_TX],t[u.WORLD_TY]=o[u.WORLD_TY],ze(e)}function Oi(r,e){let t=C.data[r],o=C.data[e],n=t[u.WORLD_A],i=t[u.WORLD_B],m=t[u.WORLD_C],a=t[u.WORLD_D],d=t[u.WORLD_TX],f=t[u.WORLD_TY],l=o[u.LOCAL_A],c=o[u.LOCAL_B],h=o[u.LOCAL_C],b=o[u.LOCAL_D],p=o[u.LOCAL_TX],T=o[u.LOCAL_TY];o[u.WORLD_A]=l*n+c*m,o[u.WORLD_B]=l*i+c*a,o[u.WORLD_C]=h*n+b*m,o[u.WORLD_D]=h*i+b*a,o[u.WORLD_TX]=p*n+T*m+d,o[u.WORLD_TY]=p*i+T*a+f,ze(e)}function _i(r){let e=W(r);ir(G,C,e)?Ve(r)?Oi(e,r):Pi(e,r):Ai(r,r)}function nt(r){y.data[r][v.CHILD_TRANSFORM]=0}function Wi(r){C.data[r][u.DIRTY_WORLD]=0}function Bi(r){return Boolean(C.data[r][u.DIRTY_WORLD])}function Fi(r,e,t,o,n,i){let m=C.data[r],a=m[u.WORLD_A],d=m[u.WORLD_B],f=m[u.WORLD_C],l=m[u.WORLD_D],c=m[u.WORLD_TX],h=m[u.WORLD_TY],b=m[u.FRAME_X1],p=m[u.FRAME_Y1],T=m[u.FRAME_X2],x=m[u.FRAME_Y2],E=b*a+p*f+c,P=b*d+p*l+h,B=b*a+x*f+c,V=b*d+x*l+h,I=T*a+x*f+c,O=T*d+x*l+h,ue=T*a+p*f+c,Z=T*d+p*l+h,de=Math.min(E,B,I,ue),fe=Math.min(P,V,O,Z),le=Math.max(E,B,I,ue),k=Math.max(P,V,O,Z);m[u.BOUNDS_X1]=de,m[u.BOUNDS_Y1]=fe,m[u.BOUNDS_X2]=le,m[u.BOUNDS_Y2]=k,m[u.IN_VIEW]=Number(!(n<de||i<fe||t>le||o>k)),m[u.UPDATED]=e,dr(r,E,P,B,V,I,O,ue,Z)}function Mi(r,e,t){let o=e.getBoundsX(),n=e.getBoundsY(),i=e.getBoundsRight(),m=e.getBoundsBottom(),a=0,d=r.length;for(let f=0;f<d;f++){let l=r[f];Bi(l)&&(Fi(l,t,o,n,i,m),Wi(l),nt(l),a++)}return a}function De(r,e,t,o,n,i,m,a,d,f,l,c,h,b,p,T,x,E,P){return r[e+0]=o,r[e+1]=n,r[e+2]=c,r[e+3]=h,r[e+4]=t,r[e+5]=T,r[e+6]=x,r[e+7]=E,r[e+8]=P,r[e+9]=i,r[e+10]=m,r[e+11]=c,r[e+12]=p,r[e+13]=t,r[e+14]=T,r[e+15]=x,r[e+16]=E,r[e+17]=P,r[e+18]=a,r[e+19]=d,r[e+20]=b,r[e+21]=p,r[e+22]=t,r[e+23]=T,r[e+24]=x,r[e+25]=E,r[e+26]=P,r[e+27]=o,r[e+28]=n,r[e+29]=c,r[e+30]=h,r[e+31]=t,r[e+32]=T,r[e+33]=x,r[e+34]=E,r[e+35]=P,r[e+36]=a,r[e+37]=d,r[e+38]=b,r[e+39]=p,r[e+40]=t,r[e+41]=T,r[e+42]=x,r[e+43]=E,r[e+44]=P,r[e+45]=f,r[e+46]=l,r[e+47]=b,r[e+48]=h,r[e+49]=t,r[e+50]=T,r[e+51]=x,r[e+52]=E,r[e+53]=P,e+54}function it(r,e,t,o,n,i=1,m=1,a=1){let{F32:d,offset:f}=j(r,2);t=e.getFrame(t);let l=r.textures.set(e),c=t.width*m,h=t.height*a;De(d,f,l,o,n,o,n+h,o+c,n+h,o+c,n,t.u0,t.v0,t.u1,t.v1,1,1,1,i)}function Ni(r,e,t,o,n=1,i=1,m=1){let{F32:a,offset:d}=j(r,2),f=e.firstFrame,l=r.textures.set(e),c=f.width*i,h=f.height*m;De(a,d,l,t,o,t,o+h,t+c,o+h,t+c,o,f.u0,f.v0,f.u1,f.v1,1,1,1,n)}function Ae(r,e,t){return Math.max(e,Math.min(t,r))}function wi(r,e,t,o,n,i,m,a,d,f,l=1){let{F32:c,offset:h}=j(r,2),b=e.firstFrame,p=r.textures.set(e),T=b.width,x=b.height;t=Ae(t,0,T),n=Ae(n,t,T),o=Ae(o,0,x),i=Ae(i,o,x);let E=b.u1-b.u0,P=b.v1-b.v0,B=b.u0+E*(t/T),V=b.v0+P*(o/x),I=b.u0+E*(n/T),O=b.v0+P*(i/x);d==null&&(d=n-t),f==null&&(f=i-o),De(c,h,p,m,a,m,a+f,m+d,a+f,m+d,a,B,V,I,O,1,1,1,l)}function Ui(r,e,t,o,n,i,m,a,d,f,l,c=1){let{F32:h,offset:b}=j(r,2);t=e.getFrame(t);let p=r.textures.set(e);De(h,b,p,o,n,i,m,a,d,f,l,t.u0,t.v0,t.u1,t.v1,1,1,1,c)}function Hi(r,e,t,o,n,i,m=0,a=0,d=1){let f=0,l=0,c=0;n.forEach(h=>{h!==-1&&it(r,e,h,Math.floor(m+f),Math.floor(a+l),d),c++,f+=t,c===i&&(f=0,l+=o,c=0)})}function st(r,e,t,o,n,i,m,a,d,f,l,c,h){return r.set([o,n,0,0,t,f,l,c,h,i,m,0,1,t,f,l,c,h,a,d,1,1,t,f,l,c,h],e),e+27}function Vi(r,e,t){if(r.radius>0&&e>=r.left&&e<=r.right&&t>=r.top&&t<=r.bottom){let o=(r.x-e)*(r.x-e),n=(r.y-t)*(r.y-t);return o+n<=r.radius*r.radius}else return!1}var ro=class{x;y;_radius;_diameter;constructor(e=0,t=0,o=0){this.set(e,t,o)}set(e=0,t=0,o=0){return this.x=e,this.y=t,this.radius=o,this}contains(e,t){return Vi(this,e,t)}get radius(){return this._radius}set radius(e){this._radius=e,this._diameter=e*2}get diameter(){return this._diameter}set diameter(e){this._diameter=e,this._radius=e*.5}get left(){return this.x-this._radius}set left(e){this.x=e+this._radius}get right(){return this.x+this._radius}set right(e){this.x=e-this._radius}get top(){return this.y-this._radius}set top(e){this.y=e+this._radius}get bottom(){return this.y+this._radius}set bottom(e){this.y=e-this._radius}};function ji(r,e,t){return r=Ae(r,0,1),(t-e)*r}function ki(r){return 2*(Math.PI*r.radius)}function Yi(r,e,t=new fr){return t.set(r.x+r.radius*Math.cos(e),r.y+r.radius*Math.sin(e))}var zi={PI2:Math.PI*2,HALF_PI:Math.PI*.5,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function Xi(r,e,t,o,n=!1,i=!1,m=0,a=[]){m||(m=ki(r)/o);for(let d=0;d<m;d++){let f=ji(d/m,0,zi.PI2);f>=e&&f<=t&&a.push(Yi(r,f))}return n&&(a=a.reverse()),i&&a.push(new fr(r.x,r.y)),a}function $(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function fm(r,e,t){return $(r,e,t)<0}function mt(r,e){return r.x===e.x&&r.y===e.y}function lm(r){let e=0;for(let t=0,o=r.length;t<o;++t){let n=r[t],i=r[(t+1)%o];e+=(i.x-n.x)*(i.y+n.y)}return e>0}function Qi(r,e){if(!r.shouldUpdate)return;r.shouldUpdate=!1;let t=r.prev.point,o=r.point,n=r.next.point;r.isConvex=fm(t,o,n);let i=t.x-o.x,m=t.y-o.y,a=Math.sqrt(i*i+m*m);i/=a,m/=a;let d=n.x-o.x,f=n.y-o.y,l=Math.sqrt(d*d+f*f);if(d/=l,f/=l,r.angleCos=i*d+m*f,r.isConvex){r.isEar=!0;for(let c=0,h=e.length;c<h;++c){let b=e[c];if(!b.isActive||b===r||mt(t,b.point)||mt(o,b.point)||mt(n,b.point))continue;let p=$(t,b.point,o),T=$(o,b.point,n),x=$(n,b.point,t);if(p>0&&T>0&&x>0){r.isEar=!1;break}if(p===0&&T>=0&&x>=0&&($(t,b.prev.point,o)>0||$(t,b.next.point,o)>0)){r.isEar=!1;break}if(T===0&&p>=0&&x>=0&&($(o,b.prev.point,n)>0||$(o,b.next.point,n)>0)){r.isEar=!1;break}if(x===0&&p>=0&&T>=0&&($(n,b.prev.point,t)>0||$(n,b.next.point,t)>0)){r.isEar=!1;break}}}else r.isEar=!1}function cm(r){for(let e=r,t=r;;){if(mt(e.point,e.next.point)||$(e.prev.point,e.point,e.next.point)===0){if(e.prev.next=e.next,e.next.prev=e.prev,e.prev.shouldUpdate=!0,e.next.shouldUpdate=!0,e===e.next)break;t=e.prev,e=e.next;continue}if(e=e.next,e===t)break}}function $i(r,e=!1){if(!e&&lm(r))throw new Error("Polygon should be counterclockwise");if(r.length<4)return[r];let t=r.length,o=[],n=[];for(let i=0;i<t;++i)o.push({isActive:!0,isConvex:!1,isEar:!1,point:r[i],angleCos:0,shouldUpdate:!0,index:i});for(let i=0;i<t;++i){let m=o[i];m.prev=o[(i+t-1)%t],m.next=o[(i+1)%t]}o.forEach(i=>Qi(i,o));for(let i=0;i<t-3;++i){let m=null;for(let a=0;a<t;++a){let d=o[a];!d.isActive||!d.isEar||(m?d.angleCos>m.angleCos&&(m=d):m=d)}if(!m){for(let a=0;a<t;++a){let d=o[a];if(d.isActive){let f=d.prev.point,l=d.point,c=d.next.point;if(Math.abs($(f,l,c))>1e-5)throw new Error("Failed to find ear. There may be self-intersection in the polygon.")}}break}if(n.push([m.prev.point,m.point,m.next.point]),m.isActive=!1,m.prev.next=m.next,m.next.prev=m.prev,m.prev.shouldUpdate=!0,m.next.shouldUpdate=!0,cm(m.next),i===t-4)break;for(let a=0;a<t;++a)Qi(o[a],o)}for(let i=0;i<t;++i){let m=o[i];if(m.isActive){m.prev.isActive=!1,m.next.isActive=!1;let a=m.prev.point,d=m.point,f=m.next.point;Math.abs($(a,d,f))>1e-5&&n.push([a,d,f])}}return n}var at;function to(r,e,t,o,n,i,m,a,d,f,l,c,h){at||(at=new ro),at.set(e,t,o);let b=Xi(at,n,i,m,a,d),p=$i(b);if(!p.length)return;let{F32:T,offset:x}=j(r,p.length),E=r.textures.setWhite(),P=x;p.forEach(B=>{P=st(T,P,E,B[0].x,B[0].y,B[1].x,B[1].y,B[2].x,B[2].y,f,l,c,h)})}function ut(r,e,t,o,n,i,m,a,d,f,l,c,h,b,p){return r.set([o,n,0,0,t,c,h,b,p,i,m,0,1,t,c,h,b,p,a,d,1,1,t,c,h,b,p,o,n,0,0,t,c,h,b,p,a,d,1,1,t,c,h,b,p,f,l,1,0,t,c,h,b,p],e),e+54}function qi(r,e,t,o,n,i,m,a,d,f){let{F32:l,offset:c}=j(r,2),h=r.textures.setWhite(),b=o-e,p=n-t,T=Math.sqrt(b*b+p*p);i*=.5;let x=i*(n-t)/T,E=i*(e-o)/T,P=i*(n-t)/T,B=i*(e-o)/T;ut(l,c,h,Math.floor(e+x),Math.floor(t+E),Math.floor(e-x),Math.floor(t-E),Math.floor(o-P),Math.floor(n-B),Math.floor(o+P),Math.floor(n+B),m,a,d,f)}function oo(r,e,t,o,n,i,m,a,d){let{F32:f,offset:l}=j(r,2),c=r.textures.setWhite();e=Math.round(e),t=Math.round(t),ut(f,l,c,e,t,e,t+n,e+o,t+n,e+o,t,i,m,a,d)}function Ki(r,e,t,o,n,i,m,a,d,f,l){let{F32:c,offset:h}=j(r,1),b=r.textures.setWhite();st(c,h,b,e,t,o,n,i,m,a,d,f,l)}var dt=class extends ur{type="DirectDraw";red=1;green=1;blue=1;alpha=1;smoothness=8;renderPass;_color;constructor(){super()}set color(e){e!==void 0&&e!==this._color&&(this.red=(e>>16&255)/255,this.green=(e>>8&255)/255,this.blue=(e&255)/255,this._color=e)}setRGB(e,t,o,n=1){return this.red=e/255,this.green=t/255,this.blue=o/255,this.alpha=n,this}arc(e,t,o,n=0,i=6.283185307179586,m=!1,a=!1,d){return this.color=d,to(this.renderPass,e,t,o,n,i,this.smoothness,m,a,this.red,this.green,this.blue,this.alpha),this}circle(e,t,o,n){return this.color=n,to(this.renderPass,e,t,o,0,Math.PI*2,this.smoothness,!1,!1,this.red,this.green,this.blue,this.alpha),this}plot(e,t,o){return this.color=o,oo(this.renderPass,e,t,1,1,this.red,this.green,this.blue,this.alpha),this}box(e,t,o,n,i=1,m){this.color=m;let a=i*.5;return this.line(e,t+a,e+o,t+a,i),this.line(e,t+n-a,e+o,t+n-a,i),this.line(e+a,t+i,e+a,t+n-i,i),this.line(e+o-a,t+i,e+o-a,t+n-i,i),this}rect(e,t,o,n,i){return this.color=i,oo(this.renderPass,e,t,o,n,this.red,this.green,this.blue,this.alpha),this}triangle(e,t,o,n,i,m,a){return this.color=a,Ki(this.renderPass,e,t,o,n,i,m,this.red,this.green,this.blue,this.alpha),this}line(e,t,o,n,i,m){return this.color=m,qi(this.renderPass,e,t,o,n,i,this.red,this.green,this.blue,this.alpha),this}image(e,t,o,n=1,i=1,m=1){return Ni(this.renderPass,e,t,o,n,i,m),this}imagePart(e,t,o,n,i,m,a,d,f,l=1){return wi(this.renderPass,e,t,o,n,i,m,a,d,f,l),this}frame(e,t,o,n,i=1,m=1,a=1){return it(this.renderPass,e,t,o,n,i,m,a),this}quad(e,t,o,n,i,m,a,d,f,l,c=1){return Ui(this.renderPass,e,t,o,n,i,m,a,d,f,l,c),this}tiles(e,t,o,n,i,m=0,a=0){return Hi(this.renderPass,e,t,o,n,i,m,a,this.alpha),this}render(){}renderGL(e){this.renderPass=e,this.render()}};function ft(r,e){let t=document.createElement("canvas");return t.width=r,t.height=e,t.getContext("2d")}var no=class{textures;constructor(){ci.set(this),this.textures=new Map,this.createDefaultTextures()}createDefaultTextures(){this.add("__BLANK",new ce(ft(2,2).canvas));let e=ft(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new ce(e.canvas));let t=ft(2,2);t.fillStyle="#fff",t.fillRect(0,0,2,2);let o=this.add("__WHITE",new ce(t.canvas));jr.set(o)}get(e){let t=this.textures;return t.has(e)?t.get(e):t.get("__MISSING")}has(e){return this.textures.has(e)}add(e,t,o){let n;return this.textures.has(e)||(t instanceof ce?n=t:n=new ce(t,0,0,o),n.key=e,this.textures.set(e,n)),n}update(e,t,o){let n=this.textures.get(e);return n&&n.update(t,o),n}};function Zi(){new no}function Ji(){let{title:r,version:e,url:t,color:o,background:n}=D.get(S.BANNER);if(r!==""){let i=`${r} ${e}`.trimEnd();console.log(`%c${i}%c ${t}`,`padding: 4px 16px; color: ${o}; background: ${n}`,"")}}function es(r){let e=D.get(S.GLOBAL_VAR);e&&window&&(window[e]=r)}function rs(r,e){return Ir(e).appendChild(r),r}function ts(){let r=D.get(S.PARENT),e=xe.get().canvas;r&&e&&rs(e,r)}function os(){let r=D.get(S.RENDERER);r&&new r}var ns,is=0,ss=0,ye={get:()=>ns,set:r=>{ns=r},getFrame:()=>is,setFrame:r=>{is=r},getElapsed:()=>ss,setElapsed:r=>{ss=r}};function ms(){return D.get(S.SCENES)}var io=class{callback;context;once;constructor(e,t,o=!1){this.callback=e,this.context=t,this.once=o}};function as(r,e,t,o=r,n=!1){if(typeof t!="function")throw new TypeError("Listener not a function");let i=new io(t,o,n),m=r.events.get(e);return m?m.add(i):r.events.set(e,new Set([i])),i}function lt(r,e,t,o=r){return as(r,e,t,o,!0)}var Q={fps:0,delta:0,gameFrame:0,numScenes:0,numWorlds:0,numGameObjects:0,numGameObjectsRendered:0,numDirtyLocalTransforms:0,numDirtyWorldTransforms:0,numDirtyVertices:0,numDirtyWorldLists:0,numDirtyCameras:0};function us(r,e){Q.gameFrame=r,Q.numScenes=e,Q.numWorlds=0,Q.numGameObjects=0,Q.numGameObjectsRendered=0,Q.numDirtyWorldLists=0,Q.numDirtyVertices=0,Q.numDirtyLocalTransforms=0,Q.numDirtyWorldTransforms=0,Q.numDirtyCameras=0}var so,Pe={get:()=>so,set:r=>{if(so)throw new Error("Cannot instantiate SceneManager more than once");so=r}};var Te=new Map;var mo=class{id=ne(G);game;scenes=new Map;sceneIndex=0;flush;constructor(){Pe.set(this),this.game=ye.get(),lt(this.game,"boot",()=>this.boot())}boot(){let e=ms();e&&e.forEach(t=>new t)}update(){let e=this.game.time,t=e.delta,o=e.lastTick,n=e.frame;us(n,this.scenes.size);for(let i of this.scenes.values()){let m=Te.get(i);for(let a of m)a.beforeUpdate(t,o);i.update&&i.update(t,o);for(let a of m)a.update(t,o);for(let a of m)a.afterUpdate(t,o)}}preRender(){let e=this.game.time.frame;for(let t of this.scenes.values()){let o=Te.get(t);for(let n of o)n.preRender(e)&&(this.flush=!0)}}render(e){for(let t of this.scenes.values()){let o=Te.get(t);for(let n of o)n.renderGL(e)}this.flush=!1}};function ds(){new mo}function fs(r){let e=document.readyState;if(e==="complete"||e==="interactive"){r();return}let t=()=>{document.removeEventListener("deviceready",t,!0),document.removeEventListener("DOMContentLoaded",t,!0),window.removeEventListener("load",t,!0),r()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",t,!0):(document.addEventListener("DOMContentLoaded",t,!0),window.addEventListener("load",t,!0)):window.setTimeout(t,20)}var ao=class{events;constructor(){this.events=new Map}};function ls(r,e,t){return Object.prototype.hasOwnProperty.call(r,e)?r[e]:t}function cs(r,e={}){let t=Pe.get(),o=t.scenes.size,n=t.sceneIndex,i=o===0;typeof e=="string"?r.key=e:(e||!e&&i)&&(r.key=ls(e,"key","scene"+n.toString())),t.scenes.has(r.key)?console.warn("Scene key already in use: "+r.key):(t.scenes.set(r.key,r),t.flush=!0,t.sceneIndex++),Te.set(r,[])}var uo=class{key;game;events;constructor(e){this.game=ye.get(),this.events=new Map,cs(this,e)}};function ps(){pr(0),Eo(2048),vo("Phaser","4.0.0","https://phaser4.io"),xr(0),Ao(.5,.5),Wo(800,600,1),Gn({antialias:!0,desynchronized:!0,preserveDrawingBuffer:!0})}var fo=class{lastTick=0;elapsed=0;delta=0;fps=60;fpsCount=0;frame=0;ms=0;prevFrame=0;constructor(){let e=performance.now();this.lastTick=e,this.prevFrame=e}update(e){this.ms=e-this.lastTick}updateDelta(e){let t=performance.now(),o=t-e;return this.fpsCount++,t>=this.prevFrame+1e3&&(this.fps=this.fpsCount*1e3/(t-this.prevFrame),this.prevFrame=t,this.fpsCount=0),this.lastTick=t,this.elapsed+=o,this.delta=1e3/this.fps,this.frame++,ye.setFrame(this.frame),Q.fps=this.fps,Q.delta=1e3/this.fps,this.frame}resetLastTick(){this.lastTick=performance.now()}};var lo=class extends ao{id=ne(G);time;isBooted=!1;isPaused=!1;willUpdate=!0;willRender=!0;constructor(...e){super();this.time=new fo,ye.set(this),ps(),fs(()=>this.boot(e))}boot(e){e.forEach(t=>t()),os(),Zi(),ds(),Ji(),es(this),ts(),this.isBooted=!0,H(this,"boot"),requestAnimationFrame(t=>this.step(t))}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.time.resetLastTick()}update(e,t){}render(e,t,o){}step(e){let t=xe.get(),o=Pe.get(),n=this.time;if(n.update(e),!this.isPaused){let i=n.delta;if(this.willUpdate&&(o.update(),this.update(i,e),H(this,"update",i,e)),this.willRender){o.preRender(),t.begin(o.flush);let m=t.renderPass;o.render(m),this.render(m,i,e),H(this,"render",m,i,e),t.end()}}n.updateDelta(e),H(this,"step"),requestAnimationFrame(i=>this.step(i))}destroy(){}};var co="afterupdate";var lr="beforeupdate";var po="worldpostrender";var ho="worldrender";var bo="worldshutdown";var cr="update";function Co(r){return Boolean(C.data[r][u.IN_VIEW])}var ct=0;function hs(){return ct}function bs(){ct=0}function xo(r,e){let t=Co(e)||Le(e),o;t&&(o=N.get(e),o.renderGL(r),ct++);let n=Di(e,r.isCameraDirty());if(n){let i=M(e);for(let m=0;m<n;m++){if(Se(i)){if(z(i))xo(r,i);else if(Co(i)){let a=N.get(i);a.renderGL(r),a.postRenderGL(r),ct++}}i=w(i)}}t&&o.postRenderGL(r)}var Cs="destroy";var Io=class extends ur{type="BaseWorld";tag=Y();scene;camera;is3D=!1;color;totalChildren=0;totalChildrenQuery;constructor(e){super();let t=this.id,o=this.tag;this.scene=e,this.totalChildrenQuery=nr([o]),je(t,t),Te.get(e).push(this),this.color=new qt(t),lt(e,Cs,()=>this.destroy())}getNumChildren(){return Jr(this.id)&&(this.totalChildren=this.totalChildrenQuery(G).length),this.totalChildren}beforeUpdate(e,t){H(this,lr,e,t,this)}update(e,t){!ot(this.id)||(H(this,cr,e,t,this),super.update(e,t))}afterUpdate(e,t){H(this,co,e,t,this)}preRender(e){return!0}renderGL(e){}shutdown(){Ci(this),H(this,bo,this)}destroy(e){super.destroy(e),this.shutdown(),this.camera&&this.camera.destroy(),this.camera=null}};function xs(r,e){r.current2DCamera!==e&&(ee(r),r.current2DCamera=e,r.cameraMatrix=e.getMatrix()),e.update()&&r.getCurrentShader().bind(r)}function Is(r,e){r.shader.bindDefault(),xs(r,e)}function Ss(r){y.data[r][v.CHILD_COLOR]=0}function Ds(r){y.data[r][v.CHILD_WORLD_TRANSFORM]=0}function ys(r){return Boolean(y.data[r][v.CHILD_COLOR])}function pt(r){return Boolean(y.data[r][v.CHILD_TRANSFORM])}function Ts(r){return Boolean(y.data[r][v.CHILD_WORLD_TRANSFORM])}function gs(r){let e=M(r);if(e>0&&gi(r))return e;{let t=w(r);if(t===0){let o=W(r);return o===F(r)?0:w(o)}else return t}}function Rs(r){let e=0;for(let t=0;t<r.length;t++){let o=r[t],n=W(o);(et(o)||pt(n))&&(_i(o),Zr(o),e++)}return e}function vs(r,e,t,o,n,i){let m=C.data[r];if(m[u.UPDATED]<e){let a=m[u.BOUNDS_X1],d=m[u.BOUNDS_Y1],f=m[u.BOUNDS_X2],l=m[u.BOUNDS_Y2];m[u.IN_VIEW]=Number(!(n<a||i<d||t>f||o>l)),m[u.UPDATED]=e}}function Es(r,e,t){let o=e.getBoundsX(),n=e.getBoundsY(),i=e.getBoundsRight(),m=e.getBoundsBottom(),a=0,d=r.length;for(let f=0;f<d;f++){let l=r[f];Se(l)&&(vs(l,t,o,n,i,m),a++)}return a}var So=class{id=ne(G);type="WorldCamera";name="";size;position;isDirty=!0;matrix;constructor(e,t){let o=this.id;Hr(o,0,0,0,0),this.matrix=new mr,this.position=new Zt(o,0,0),this.size=new Jt(o,e,t),this.reset(e,t)}set x(e){this.position.x=e,this.isDirty=!0}get x(){return this.position.x}set y(e){this.position.y=e,this.isDirty=!0}get y(){return this.position.y}setPosition(e,t){return this.position.set(e,t),this.isDirty=!0,this}updateBounds(){let e=this.id;if(et(e)){let t=this.x,o=this.y,n=this.size.width,i=this.size.height,m=-t+n/2,a=-o+i/2,d=m-n/2,f=a-i/2;return Vr(e,d,f,d+n,f+i),Zr(e),this.isDirty=!0,!0}return!1}update(){if(this.isDirty){let e=this.matrix.data;return e[12]=this.x,e[13]=this.y,!0}return!1}getBoundsX(){return C.data[this.id][u.BOUNDS_X1]}getBoundsY(){return C.data[this.id][u.BOUNDS_Y1]}getBoundsRight(){return C.data[this.id][u.BOUNDS_X2]}getBoundsBottom(){return C.data[this.id][u.BOUNDS_Y2]}getMatrix(){return this.matrix.data}reset(e,t){this.size.set(e,t),this.isDirty=!0}destroy(){let e=this.id;Ce(G,C,e),or(G,e)}};var Do=class extends Io{type="StaticWorld";colorQuery;transformQuery;renderData;constructor(e){super(e);let t=this.tag;this.colorQuery=nr([t,_,Ye]),this.transformQuery=nr([t,C]);let o=xe.get();this.camera=new So(o.width,o.height),this.renderData={gameFrame:0,dirtyLocal:0,dirtyWorld:0,dirtyQuad:0,dirtyColor:0,dirtyView:0,numChildren:0,rendered:0,renderMs:0,updated:0,updateMs:0,fps:0},Ti(this.id,!1),yi(this.id,!1)}preRender(e){let t=this.id,o=this.renderData;o.gameFrame=e,o.rendered=0,Zn(t);let n=this.camera,i=n.updateBounds(),m=this.transformQuery(G),a=0,d=0,f=0,l=0,c=0;pt(t)&&(a=Li(t,m,n,e),nt(t)),Ts(t)&&(d=Rs(m),f=Mi(m,n,e),Ds(t)),ys(t)&&(l=Ii(this.colorQuery(G)),Ss(t)),Jr(t)&&(this.getNumChildren(),ei(t));let h=a+f;return i&&h!==m.length&&(c=Es(m,n,e)),o.dirtyLocal=a,o.dirtyWorld=d,o.dirtyQuad=f,o.dirtyColor=l,o.dirtyView=c,o.rendered=hs(),!0}update(e,t){H(this,lr,e,t);let o=performance.now(),n=M(this.id),i=0;for(;n>0;)ot(n)&&(N.get(n).update(e,t),i++),n=gs(n);this.renderData.updated=i,this.renderData.updateMs=performance.now()-o,H(this,cr,e,t)}renderGL(e){li(e,this.color),H(this,ho,this);let t=this.camera,o=this.renderData,n=performance.now();Is(e,t),bs();let i=M(this.id);for(;i>0;)Se(i)&&xo(e,i),i=w(i);t.isDirty=!1,fi(e,this.color),o.renderMs=performance.now()-n,o.numChildren=this.getNumChildren(),o.fps=this.scene.game.time.fps,window.renderStats=o,H(this,po,e,this)}};var Gs=class extends uo{constructor(){super();this.create()}async create(){let e=new Do(this),t=new dt;t.render=()=>{t.circle(400,300,256,65535)},ar(e,t)}};new lo($t(),xt("gameParent"),Ct("Phaser4"),ht(2960685),It(Gs));})();
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
