<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Phaser 4 RenderStats</title>
        <link rel="stylesheet" href="libs/css/uPlot.min.css">
        <script src="libs/uPlot.iife.js"></script>
        <style>
            body {
                background-color: rgb(50, 50, 50);
                color: white;
            }
        </style>
    </head>
    <body>

        <button id="pause">Pause</button>
        <button id="play">Play</button>

    <script>

const { linear, spline, stepped, bars } = uPlot.paths;

const stepBefore = stepped({ align: -1 });
const stepAfter  = stepped({ align:  1 });
// const spline     = spline();

const a = [];
const b = [];
const c = [];

for (let i = 0; i < 300; i++)
{
    a[i] = i;
    b[i] = 0;
    c[i] = 0;
}

let data = [
    a,
    b,
    c
];

let opts = {
    id: 'chart',
    width: 800,
    height: 300,
    axes: [
        {
            stroke: '#00ff00',
            font: `10px 'MonoLisa'`,
            labelFont: `10px 'MonoLisa'`,
            grid: {
                width: 1 / devicePixelRatio,
                stroke: 'rgb(20, 20, 20)',
            },
            ticks: {
                width: 1 / devicePixelRatio,
                stroke: 'rgb(20, 20, 20)',
            },
            space: 60
        },
        {
            stroke: '#00ff00',
            font: `10px 'MonoLisa'`,
            labelFont: `10px 'MonoLisa'`,
            grid: {
                width: 1 / devicePixelRatio,
                stroke: 'rgb(20, 20, 20)',
            },
            ticks: {
                width: 1 / devicePixelRatio,
                stroke: 'rgb(20, 20, 20)',
            }
        },
    ],
    scales: {
        x: {
            time: false,
        },
        y: {
            auto: false,
            range: (min, max) => [ 0, 100 ]
        }
    },
    series: [
        {
            label: 'Frame'
        },
        {
            label: 'Game Objects',
            stroke: 'red',
            fill: 'rgba(255, 0, 0, 0.3)',
            paths: spline()
        },
        {
            label: 'Rendered',
            stroke: 'green',
            fill: 'rgba(0, 255, 0, 0.3)',
            paths: spline()
        }
    ]
};

let uplot = new uPlot(opts, data, document.body);

let f = 0;
let paused = false;

document.getElementById('pause').addEventListener('click', () => {

    paused = true;

});

document.getElementById('play').addEventListener('click', () => {

    paused = false;

});

setInterval(() => {

    if (paused)
    {
        //  TODO - Keep recording data into another array
        //  while paused and then re-sync the data when resumed
        return;
    }

    const v = 50 + Math.abs(Math.random() * 30);
    const v2 = v - (10 + Math.abs(Math.random() * 30));

    if (f > 300)
    {
        data[0].shift();
        data[1].shift();
        data[2].shift();

        data[0].push(f);
        data[1].push(v);
        data[2].push(v2);
    }
    else
    {
        data[1][f] = v;
        data[2][f] = v2;
    }

    uplot.setData(data);

    f++;

}, 20);

    </script>

    </body>
</html>