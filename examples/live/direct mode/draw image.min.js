(()=>{var C={AUTO:"Auto",BACKGROUND_COLOR:"BackgroundColor",BANNER:"Banner",BATCH_SIZE:"BatchSize",CANVAS_CONTEXT:"CanvasContext",CANVAS:"Canvas",DEFAULT_ORIGIN:"DefaultOrigin",GLOBAL_VAR:"GlobalVar",MAX_TEXTURES:"MaxTextures",PARENT:"Parent",RENDERER:"Renderer",SCENES:"Scenes",SIZE:"Size",WEBGL_CONTEXT:"WebGLContext",WEBGL:"WebGL",WORLD_SIZE:"WorldSize",WORLD_WIDTH:"WorldWidth",WORLD_HEIGHT:"WorldHeight"};var I=new Map;function ut(t){I.set(C.BACKGROUND_COLOR,t)}function ir(t){return()=>{ut(t)}}function lo(t="",e="",r="",o="#fff",n="linear-gradient(#3e0081 40%, #00bcc3)"){I.set(C.BANNER,{title:t,version:e,url:r,color:o,background:n})}function po(t){I.set(C.BATCH_SIZE,t)}var sr=[],Le={add:(t,e)=>{sr.push({texture:t,glConfig:e})},get:()=>sr,clear:()=>{sr.length=0}};function ho(){return I.get(C.BACKGROUND_COLOR)}function dt(){return I.get(C.SIZE).height}function ft(){return I.get(C.SIZE).resolution}function ct(){return I.get(C.SIZE).width}function bo(t){I.set(C.RENDERER,t)}function Co(t=.5,e=t){I.set(C.DEFAULT_ORIGIN,{x:t,y:e})}function Io(t){I.set(C.GLOBAL_VAR,t)}function ar(t){return()=>{Io(t)}}function lt(t){I.set(C.MAX_TEXTURES,t)}function pt(t){let e;return t&&(typeof t=="string"?e=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(e=t)),e||(e=document.body),e}function xo(t){t&&I.set(C.PARENT,pt(t))}function mr(t){return()=>{xo(t)}}function So(t){I.set(C.SCENES,[].concat(t))}function ur(t){return()=>{So(t)}}function Do(t=800,e=600,r=1){r===0&&(r=window.devicePixelRatio),I.set(C.SIZE,{width:t,height:e,resolution:r})}var s,go={get:()=>s,set:t=>{s=t}};function yo(t){let e=t.count;if(e===0)return;let r=t.vertexbuffer.current,o=t.shader.current,n=o.shader.renderToFramebuffer;if(n&&t.framebuffer.set(o.shader.framebuffer,!0),e===r.batchSize){let i=r.isDynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW;s.bufferData(s.ARRAY_BUFFER,r.data,i)}else{let i=e*r.entryElementSize,m=r.vertexViewF32.subarray(0,i);s.bufferSubData(s.ARRAY_BUFFER,0,m)}r.indexed?s.drawElements(s.TRIANGLES,e*r.entryIndexSize,s.UNSIGNED_SHORT,0):s.drawArrays(s.TRIANGLES,0,e*r.elementsPerEntry),n&&t.framebuffer.pop()}function K(t,e){return e&&(t.count=e),t.count===0?!1:(yo(t),t.flush(),!0)}function To(t){K(t)}function Ro(t){let e="WEBGL_compressed_texture_",r="WEBKIT_"+e,o=n=>{let i=t.getExtension(e+n)||t.getExtension(r+n);if(i){let m={};for(let u in i)m[i[u]]=u;return m}};return{ETC:o("etc"),ETC1:o("etc1"),ATC:o("atc"),ASTC:o("astc"),BPTC:o("bptc"),RGTC:o("rgtc"),PVRTC:o("pvrtc"),S3TC:o("s3tc"),S3TCSRGB:o("s3tc_srgb"),IMG:!0}}function Eo(t,e=[]){let r=t>>16&255,o=t>>8&255,n=t&255,i=t>16777215?t>>>24:255;return e[0]=r/255,e[1]=o/255,e[2]=n/255,e[3]=i/255,e}function vo(){return I.get(C.WEBGL_CONTEXT)}function ht(t,e){e||(e=s.COLOR_ATTACHMENT0);let r=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,r),s.framebufferTexture2D(s.FRAMEBUFFER,e,s.TEXTURE_2D,t,0),s.bindFramebuffer(s.FRAMEBUFFER,null),r}function bt(t,e){let{generateMipmap:r,minFilter:o,parent:n,compressed:i,internalFormat:m,flipY:u,unpackPremultiplyAlpha:f,magFilter:d,wrapS:l,wrapT:b,isPOT:h}=t,T=n.image,c=n.width,W=n.height,E=s.createTexture();if(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,E),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,u),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),T)s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,T),c=T.width,W=T.height;else if(i&&e)for(let v=0;v<e.length;v++)s.compressedTexImage2D(s.TEXTURE_2D,v,m,e[v].width,e[v].height,0,e[v].data);else s.texImage2D(s.TEXTURE_2D,0,s.RGBA,c,W,0,s.RGBA,s.UNSIGNED_BYTE,null);return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,d),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,l),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,b),r&&h&&s.generateMipmap(s.TEXTURE_2D),t.texture=E,E}function Ct(t){s&&s.isFramebuffer(t)&&s.deleteFramebuffer(t)}function Qe(t){s.isTexture(t)&&s.deleteTexture(t)}function Lo(t,e){return t<1||e<1?!1:(t&t-1)==0&&(e&e-1)==0}function Go(t,e=!0){s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t);let r=e?s.LINEAR:s.NEAREST;s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,r)}function Ao(t){let e=t.parent.image,r=e.width,o=e.height;return r>0&&o>0&&(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t.texture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e)),t.texture}var $e=class{parent;texture;framebuffer;depthbuffer;format;internalFormat;compressed;mipmaps;isBound=!1;textureUnit=0;unpackPremultiplyAlpha=!0;minFilter;magFilter;wrapS;wrapT;flipY=!1;isPOT=!1;generateMipmap=!1;constructor(e,r={}){this.parent=e,this.isPOT=Lo(e.width,e.height);let{mipmaps:o=null,compressed:n=!1,format:i="IMG",internalFormat:m=0,texture:u=null,framebuffer:f=null,createFramebuffer:d=!1,depthbuffer:l=null,unpackPremultiplyAlpha:b=!0,minFilter:h=this.isPOT?s.LINEAR_MIPMAP_LINEAR:s.LINEAR,magFilter:T=s.LINEAR,wrapS:c=s.CLAMP_TO_EDGE,wrapT:W=s.CLAMP_TO_EDGE,generateMipmap:E=this.isPOT,flipY:v=!1}=r;this.compressed=n,this.format=i,this.internalFormat=m,this.mipmaps=o,n?this.minFilter=s.LINEAR:this.minFilter=h,this.magFilter=T,this.wrapS=c,this.wrapT=W,this.generateMipmap=E,this.flipY=v,this.unpackPremultiplyAlpha=b,u?this.texture=u:bt(this,o),f?this.framebuffer=f:d&&(this.framebuffer=ht(this.texture)),l&&(this.depthbuffer=l),e.binding=this}setFilter(e){this.texture&&Go(this.texture,e)}create(){let e=this.texture;return e&&Qe(e),bt(this)}update(){return this.texture?Ao(this):bt(this)}bind(e){this.isBound=!0,this.textureUnit=e}unbind(){this.isBound=!1,this.textureUnit=0}destroy(){this.unbind(),Qe(this.texture),Ct(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}};function dr(){Le.get().forEach(e=>{let{texture:r,glConfig:o}=e;r.binding||(r.binding=new $e(r,o))}),Le.clear()}var It=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Oo=new Float32Array(4);var fr=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r,o){let n={enable:e,sfactor:r,dfactor:o};return this.index++,this.index===this.stack.length?this.stack.push(n):this.stack[this.index]=n,n}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.enable?(!s.isEnabled(s.BLEND)||this.current.sfactor!==e.sfactor||this.current.dfactor!==e.dfactor)&&(s.enable(s.BLEND),s.blendFunc(e.sfactor,e.dfactor)):s.disable(s.BLEND)}pop(){this.index--,this.bind()}set(e,r,o){let n=this.add(e,r,o);this.bind(n)}setDefault(e,r,o){let n={enable:e,sfactor:r,dfactor:o};this.stack[0]=n,this.index=0,this.default=n}};function Wo(t,e,r,o){for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;for(let n=0;n<t.length;n++)if(t[n]!==r[n])return!1;return!0}var cr=class{renderPass;stack;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let o={colorMatrix:e,colorOffset:r};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current);let r=this.renderPass.getCurrentShader();K(this.renderPass),r.setUniform("uColorMatrix",e.colorMatrix),r.setUniform("uColorOffset",e.colorOffset)}pop(){this.index--,this.bind()}set(e){let r=this.current,o=this.add(e.colorMatrix,e.colorOffset);Wo(o.colorMatrix,o.colorOffset,r.colorMatrix,r.colorOffset)||this.bind(o)}setDefault(e,r){let o={colorMatrix:e,colorOffset:r};this.stack[0]=o,this.index=0,this.default=o}};var lr=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let o={framebuffer:e,viewport:r};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(!1,this.default)}bind(e=!0,r){r||(r=this.current);let{framebuffer:o,viewport:n}=r;this.active!==o&&s.bindFramebuffer(s.FRAMEBUFFER,o),e&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),n&&this.renderPass.viewport.set(n.x,n.y,n.width,n.height),this.active=o}pop(){this.current.viewport&&this.renderPass.viewport.pop(),this.index--,this.bind(!1)}set(e,r=!0,o){let n=this.add(e,o);this.bind(r,n)}setDefault(e=null,r){let o={framebuffer:e,viewport:r};this.stack[0]=o,this.index=0,this.default=o}};function Po(){return I.get(C.BATCH_SIZE)}function Ge(){return I.get(C.MAX_TEXTURES)}function _o(t,e,r,o,n,i,m){let u=1/(e-r),f=1/(o-n),d=1/(i-m);t.set([-2*u,0,0,0,0,-2*f,0,0,0,0,2*d,0,(e+r)*u,(n+o)*f,(m+i)*d,1])}var Bo=`#define SHADER_NAME MULTI_QUAD_FRAG
#define numTextures %count%

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture[%count%];
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

vec4 getSampler (int index, vec2 uv)
{
    for (int i = 0; i < numTextures; ++i)
    {
        vec4 color = texture2D(uTexture[i], uv);

        if (i == index)
        {
            return color * vec4(vTintColor.rgb * vTintColor.a, vTintColor.a);
        }
    }

    //  Return black
    return vec4(0);
}

void main (void)
{
    vec4 color = getSampler(int(vTextureId), vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var xt={aVertexPosition:{size:2},aTextureCoord:{size:2},aTextureId:{size:1},aTintColor:{size:4}};var Fo=5120,Mo=5121,No=5122,Uo=5123;var wo=5126;function Ho(t,e){let r=new Map,o={size:1,type:wo,normalized:!1,stride:0},n=0;for(let[i,m]of Object.entries(e)){let u=s.getAttribLocation(t,i);if(u!==-1){s.enableVertexAttribArray(u);let{size:f=o.size,type:d=o.type,normalized:l=o.normalized,stride:b=o.stride}=m;r.set(i,{index:u,size:f,type:d,normalized:l,stride:b,offset:n});let h=4;d===Uo||d===No?h=2:(d===Mo||d===Fo)&&(h=1),n+=f*h}}return r}function jo(t,e,r){s.bindFramebuffer(s.FRAMEBUFFER,t);let o=s.createRenderbuffer();return s.bindRenderbuffer(s.RENDERBUFFER,o),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,e,r),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o),s.bindFramebuffer(s.FRAMEBUFFER,null),o}function St(...t){t.forEach(e=>{s.deleteShader(e)})}function ko(...t){let e=s.createProgram();if(t.forEach(o=>{s.attachShader(e,o)}),s.linkProgram(e),!s.getProgramParameter(e,s.LINK_STATUS)){let o=s.getProgramInfoLog(e);return console.error(`Error linking program: ${o}`),s.deleteProgram(e),St(...t),null}return e}function pr(t,e){let r=s.createShader(e);if(s.shaderSource(r,t),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS)){let n=s.getShaderInfoLog(r),i=t.split(`
`).map((m,u)=>`${u}: ${m}`);return console.error(`Error compiling shader: ${n}`,i.join(`
`)),s.deleteShader(r),null}return r}function Vo(t,e,r=!1){switch(t.type){case s.INT:case s.BOOL:return r?o=>{s.uniform1iv(e,o)}:o=>{s.uniform1i(e,o)};case s.INT_VEC2:case s.BOOL_VEC2:return o=>{s.uniform2iv(e,o)};case s.INT_VEC3:case s.BOOL_VEC3:return o=>{s.uniform3iv(e,o)};case s.INT_VEC4:case s.BOOL_VEC4:return o=>{s.uniform4iv(e,o)};case s.FLOAT:return r?o=>{s.uniform1fv(e,o)}:o=>{s.uniform1f(e,o)};case s.FLOAT_VEC2:return o=>{s.uniform2fv(e,o)};case s.FLOAT_VEC3:return o=>{s.uniform3fv(e,o)};case s.FLOAT_VEC4:return o=>{s.uniform4fv(e,o)};case s.FLOAT_MAT2:return o=>{s.uniformMatrix2fv(e,!1,o)};case s.FLOAT_MAT3:return o=>{s.uniformMatrix3fv(e,!1,o)};case s.FLOAT_MAT4:return o=>{s.uniformMatrix4fv(e,!1,o)};case s.SAMPLER_2D:case s.SAMPLER_CUBE:return t.size>1?o=>{s.uniform1iv(e,o)}:o=>{s.uniform1i(e,o)}}}function Yo(t){let e=new Map,r=s.getProgramParameter(t,s.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){let n=s.getActiveUniform(t,o),i=n.name;if(i.startsWith("gl_")||i.startsWith("webgl_"))continue;let m=s.getUniformLocation(t,i);if(m){let u=!1;i.endsWith("[0]")&&(i=i.slice(0,-3),u=n.size>1),e.set(i,Vo(n,m,u))}}return e}var zo={uProjectionMatrix:new Float32Array(16),uCameraMatrix:new Float32Array(16),uTexture:0,uColorMatrix:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uColorOffset:new Float32Array(4)};var Xo=`#define SHADER_NAME SINGLE_QUAD_FRAG

precision highp float;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

uniform sampler2D uTexture;
uniform mat4 uColorMatrix;
uniform vec4 uColorOffset;

void main (void)
{
    vec4 color = texture2D(uTexture, vTextureCoord);

    //  Un pre-mult alpha
    if (color.a > 0.0)
    {
        color.rgb /= color.a;
    }

    vec4 result = color * uColorMatrix + (uColorOffset / 255.0);

    //  Pre-mult alpha
    result.rgb *= result.a;

    gl_FragColor = vec4(result.rgb, result.a);
}`;var Qo=`#define SHADER_NAME SINGLE_QUAD_VERT

precision highp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute float aTextureId;
attribute vec4 aTintColor;

uniform mat4 uProjectionMatrix;
uniform mat4 uCameraMatrix;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vTintColor;

void main (void)
{
    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vTintColor = aTintColor;

    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);
}`;function Dt(t){let{x:e,y:r,width:o,height:n}=t,i=t.texture.width,m=t.texture.height;return t.u0=e/i,t.v0=r/m,t.u1=(e+o)/i,t.v1=(r+n)/m,t}var gt=class{texture;key;x;y;width;height;trimmed=!1;sourceSizeWidth;sourceSizeHeight;spriteSourceSizeX;spriteSourceSizeY;spriteSourceSizeWidth;spriteSourceSizeHeight;pivot;u0;v0;u1;v1;constructor(e,r,o,n,i,m){this.texture=e,this.key=r,this.x=o,this.y=n,this.width=i,this.height=m,this.sourceSizeWidth=i,this.sourceSizeHeight=m,Dt(this)}destroy(){this.texture=null}};function $o(t,e,r){return t.width=e,t.height=r,t.sourceSizeWidth=e,t.sourceSizeHeight=r,Dt(t)}var fe=class{key="";locked=!0;width;height;image;binding;firstFrame;frames;data;constructor(e,r,o,n){e&&(r=e.width,o=e.height),this.image=e,this.width=r,this.height=o,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,r,o),Le.add(this,n)}addFrame(e,r,o,n,i){if(this.frames.has(e))return null;let m=new gt(this,e,r,o,n,i);return this.frames.set(e,m),(!this.firstFrame||this.firstFrame.key==="__BASE")&&(this.firstFrame=m),m}getFrame(e){if(!e)return this.firstFrame;e instanceof gt&&(e=e.key);let r=this.frames.get(e);return r||(console.warn(`Frame missing: ${e}`),r=this.firstFrame),r}setSize(e,r){this.width=e,this.height=r;let o=this.frames.get("__BASE");$o(o,e,r)}update(e,r){this.image=e,this.setSize(e.width,e.height),Le.add(this,r)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.binding=null,this.data=null,this.image=null,this.firstFrame=null}};var hr=class{program;attributes;uniforms;uniformSetters;texture;framebuffer;renderToFramebuffer=!1;renderToDepthbuffer=!1;isActive=!1;constructor(e){e&&this.fromConfig(e)}fromConfig(e){let{attributes:r=xt,fragmentShader:o=Xo,height:n=dt(),renderToFramebuffer:i=!1,renderToDepthbuffer:m=!1,resolution:u=ft(),vertexShader:f=Qo,width:d=ct(),uniforms:l=zo}=e;if(this.create(o,f,l,r),i){this.renderToFramebuffer=!0;let b=new fe(null,d*u,n*u),h=new $e(b);h.framebuffer=ht(h.texture),m&&(this.renderToDepthbuffer=!0,h.depthbuffer=jo(h.framebuffer,b.width,b.height)),this.texture=b,this.framebuffer=h.framebuffer}}create(e,r,o,n){let i=pr(e,s.FRAGMENT_SHADER),m=pr(r,s.VERTEX_SHADER);if(!i||!m)return;let u=ko(i,m);if(!u)return;let f=s.getParameter(s.CURRENT_PROGRAM);s.useProgram(u),this.program=u,this.uniformSetters=Yo(u),this.uniforms=new Map;for(let[d,l]of Object.entries(o))this.uniformSetters.has(d)&&this.uniforms.set(d,l);this.attributes=Ho(u,n),s.useProgram(f),this.isActive=!1}updateUniforms(e){}bind(e){let r=this.uniforms;return r.set("uProjectionMatrix",e.projectionMatrix),r.set("uCameraMatrix",e.cameraMatrix),this.updateUniforms(e),this.setUniforms(e)}setUniform(e,r){let o=this.uniforms;o.has(e)&&(o.set(e,r),this.uniformSetters.get(e)(r))}setUniforms(e){if(!this.program)return!1;s.useProgram(this.program),this.isActive=!0;let r=this.uniforms;for(let[o,n]of this.uniformSetters.entries())n(r.get(o));return!0}setAttributes(e){if(this.program){let r=e.vertexbuffer.current.vertexByteSize;this.attributes.forEach(o=>{s.vertexAttribPointer(o.index,o.size,o.type,o.normalized,r,o.offset)})}}destroy(){St(this.program),Qe(this.texture),Ct(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}};var Ae=class extends hr{constructor(e={}){e.attributes=e?.attributes||xt,super(e)}};var br=class extends Ae{constructor(e={}){e.fragmentShader=e?.fragmentShader||Bo,super(e)}create(e,r,o,n){let i=Ge();e=e.replace(/%count%/gi,`${i}`),super.create(e,r,o,n)}bind(e){return this.uniforms.set("uTexture",e.textures.textureIndex),super.bind(e)}};var Cr=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e,r){let o={shader:e,textureID:r};return this.index++,this.index===this.stack.length?this.stack.push(o):this.stack[this.index]=o,o}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),e.shader.isActive||e.shader.bind(this.renderPass,e.textureID)&&(e.shader.setAttributes(this.renderPass),this.active&&this.active!==e.shader&&(this.active.isActive=!1),this.active=e.shader)}pop(){this.index--,this.bind()}set(e,r){let o=this.add(e,r);this.bind(o)}setDefault(e,r){let o={shader:e,textureID:r};this.stack[0]=o,this.index=0,this.default=o}};var Ir={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},yt={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},Z={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Tt={uint8:2**8,uint16:2**16,uint32:2**32},us=t=>e=>Math.ceil(e/t)*t,qo=us(4),ds=Symbol("storeRef"),qe=Symbol("storeSize"),fs=Symbol("storeMaps"),J=Symbol("storeFlattened"),Rt=Symbol("storeBase"),Ko=Symbol("storeType"),xr=Symbol("storeArrayCount"),ce=Symbol("storeSubarrays"),Ke=Symbol("subarrayCursors"),Zo=Symbol("subarray"),Sr=Symbol("subarrayFrom"),Dr=Symbol("subarrayTo"),gr=Symbol("subStore"),yr=Symbol("tagStore"),Zu=Symbol("queryShadow"),Ju=Symbol("serializeShadow"),Et=Symbol("indexType"),vt=Symbol("indexBytes"),Jo=Symbol("isEidType"),le={},cs=(t,e)=>{let r=new ArrayBuffer(e*t.BYTES_PER_ELEMENT),o=new t.constructor(r);return o.set(t,0),o},ls=(t,e)=>{if(ArrayBuffer.isView(t))t[e]=t.slice(0).fill(0);else{let r=t[gr].slice(0).fill(0);t[e]=t.map((o,n)=>{let i=t[n][Sr],m=t[n][Dr];return r.subarray(i,m)})}},ps=(t,e,r)=>{let o=t[Ke],n=e[Ko],i=e[0].length,m=i<=Tt.uint8?"ui8":i<=Tt.uint16?"ui16":"ui32",u=t[xr][n],f=Array(u).fill(0).reduce((h,T)=>h+i,0),d=new Z[n](qo(f*r));d.set(t[ce][n]),t[ce][n]=d,d[Et]=yt[m],d[vt]=Z[m].BYTES_PER_ELEMENT;let l=o[n],b=0;for(let h=0;h<r;h++){let T=o[n]+h*i,c=T+i;e[h]=t[ce][n].subarray(T,c),e[h][Sr]=T,e[h][Dr]=c,e[h][Zo]=!0,e[h][Et]=yt[m],e[h][vt]=Z[m].BYTES_PER_ELEMENT,b=c}o[n]=b,e[gr]=t[ce][n].subarray(l,b)},en=(t,e,r)=>{Object.keys(e).forEach(o=>{let n=e[o];Array.isArray(n)?(ps(t,n,r),e[J].push(n)):ArrayBuffer.isView(n)?(e[o]=cs(n,r),e[J].push(e[o])):typeof n=="object"&&en(t,e[o],r)})},hs=(t,e)=>{t[yr]||(t[qe]=e,t[J].length=0,Object.keys(t[Ke]).forEach(r=>{t[Ke][r]=0}),en(t,t,e))},tn=(t,e)=>{t[J]&&t[J].forEach(r=>{ArrayBuffer.isView(r)?r[e]=0:r[e].fill(0)})},bs=(t,e)=>{let r=e*Z[t].BYTES_PER_ELEMENT,o=new ArrayBuffer(r),n=new Z[t](o);return n[Jo]=t===Ir.eid,n};var Cs=(t,e,r)=>{let o=t[qe],n=Array(o).fill(0);n[Ko]=e,n[Jo]=e===Ir.eid;let i=t[Ke],m=r<Tt.uint8?"ui8":r<Tt.uint16?"ui16":"ui32";if(!r)throw new Error("bitECS - Must define component array length");if(!Z[e])throw new Error(`bitECS - Invalid component array property type ${e}`);if(!t[ce][e]){let d=t[xr][e],l=Array(d).fill(0).reduce((h,T)=>h+r,0),b=new Z[e](qo(l*o));t[ce][e]=b,b[Et]=yt[m],b[vt]=Z[m].BYTES_PER_ELEMENT}let u=i[e],f=0;for(let d=0;d<o;d++){let l=i[e]+d*r,b=l+r;n[d]=t[ce][e].subarray(l,b),n[d][Sr]=l,n[d][Dr]=b,n[d][Zo]=!0,n[d][Et]=yt[m],n[d][vt]=Z[m].BYTES_PER_ELEMENT,f=b}return i[e]=f,n[gr]=t[ce][e].subarray(u,f),n},rn=t=>Array.isArray(t)&&typeof t[0]=="string"&&typeof t[1]=="number",Is=(t,e)=>{let r=Symbol("store");if(!t||!Object.keys(t).length)return le[r]={[qe]:e,[yr]:!0,[Rt]:()=>le[r]},le[r];t=JSON.parse(JSON.stringify(t));let o={},n=m=>{let u=Object.keys(m);for(let f of u)rn(m[f])?(o[m[f][0]]||(o[m[f][0]]=0),o[m[f][0]]++):m[f]instanceof Object&&n(m[f])};n(t);let i={[qe]:e,[fs]:{},[ce]:{},[ds]:r,[Ke]:Object.keys(Z).reduce((m,u)=>({...m,[u]:0}),{}),[J]:[],[xr]:o};if(t instanceof Object&&Object.keys(t).length){let m=(u,f)=>{if(typeof u[f]=="string")u[f]=bs(u[f],e),u[f][Rt]=()=>le[r],i[J].push(u[f]);else if(rn(u[f])){let[d,l]=u[f];u[f]=Cs(i,d,l),u[f][Rt]=()=>le[r],i[J].push(u[f])}else u[f]instanceof Object&&(u[f]=Object.keys(u[f]).reduce(m,u[f]));return u};return le[r]=Object.assign(Object.keys(t).reduce(m,t),i),le[r][Rt]=()=>le[r],le[r]}},on=()=>{let t=[],e=[];t.sort=function(i){let m=Array.prototype.sort.call(this,i);for(let u=0;u<t.length;u++)e[t[u]]=u;return m};let r=i=>t[e[i]]===i;return{add:i=>{r(i)||(e[i]=t.push(i)-1)},remove:i=>{if(!r(i))return;let m=e[i],u=t.pop();u!==i&&(t[m]=u,e[u]=m)},has:r,sparse:e,dense:t}};var ed=new Map;var ee=Symbol("entityMasks"),Ze=Symbol("entityComponents"),Oe=Symbol("entitySparseSet"),Je=Symbol("entityArray"),td=Symbol("entityIndices"),rd=Symbol("removedEntities"),We=1e5,Lt=0,nn=We,xs=()=>nn,Gt=[],Ss=()=>{nn=We,Lt=0,Gt.length=0},Ds=()=>We,Tr=t=>{We=t,Ss()},gs=()=>Lt,ys=new Map,te=t=>{let e=Gt.length>0?Gt.shift():Lt++;return t[Oe].add(e),ys.set(e,t),Lt>=We&&console.error(`bitECS - max entities of ${We} reached, increase with setDefaultSize function.`),t[Rr].forEach(r=>{Pt(t,r,e)&&_t(r,e)}),t[Ze].set(e,new Set),e},et=(t,e)=>{if(!!t[Oe].has(e)){t[At].forEach(r=>{vr(t,r,e)}),Gt.push(e),t[Oe].remove(e),t[Ze].delete(e);for(let r=0;r<t[ee].length;r++)t[ee][r][e]=0}};function Ts(...t){return function(){return t}}function Rs(...t){return function(){return t}}function Es(...t){return function(){return t}}var At=Symbol("queries"),Rr=Symbol("notQueries"),vs=Symbol("queryAny"),Ls=Symbol("queryAll"),Gs=Symbol("queryNone"),Ot=Symbol("queryMap"),Wt=Symbol("$dirtyQueries"),sn=Symbol("queryComponents"),od=Symbol("enterQuery"),nd=Symbol("exitQuery");var As=(t,e)=>{let r=[],o=[],n=[];e[sn].forEach(x=>{if(typeof x=="function"){let[P,ae]=x();t[re].has(P)||Lr(t,P),ae==="not"&&o.push(P),ae==="changed"&&(n.push(P),r.push(P))}else t[re].has(x)||Lr(t,x),r.push(x)});let i=x=>t[re].get(x),m=r.concat(o).map(i),u=on(),f=[],d=[],l=[],b=[],h=[],T=m.map(x=>x.generationId).reduce((x,P)=>(x.includes(P)||x.push(P),x),[]),c=(x,P)=>(x[P.generationId]||(x[P.generationId]=0),x[P.generationId]|=P.bitflag,x),W=r.map(i).reduce(c,{}),E=o.map(i).reduce(c,{}),v=m.reduce(c,{}),M=r.filter(x=>!x[yr]).map(x=>Object.getOwnPropertySymbols(x).includes(J)?x[J]:[x]).reduce((x,P)=>x.concat(P),[]),se=M.map(x=>{let P=Symbol();return ls(x,P),x[P]},[]),H=Object.assign(u,{archetypes:f,changed:d,components:r,notComponents:o,changedComponents:n,masks:W,notMasks:E,hasMasks:v,generations:T,flatProps:M,toRemove:l,entered:b,exited:h,shadows:se});t[Ot].set(e,H),t[At].add(H),m.forEach(x=>{x.queries.add(H)}),o.length&&t[Rr].add(H);for(let x=0;x<gs();x++)!t[Oe].has(x)||Pt(t,H,x)&&_t(H,x)},Os=(t,e)=>{e&&(t.changed=[]);let{flatProps:r,shadows:o}=t;for(let n=0;n<t.dense.length;n++){let i=t.dense[n],m=!1;for(let u=0;u<r.length;u++){let f=r[u],d=o[u];if(ArrayBuffer.isView(f[i])){for(let l=0;l<f[i].length;l++)if(f[i][l]!==d[i][l]){m=!0,d[i][l]=f[i][l];break}}else f[i]!==d[i]&&(m=!0,d[i]=f[i])}m&&t.changed.push(i)}return t.changed},Ws=(t,e)=>t.concat(e),Er=t=>e=>e.filter(r=>r.name===t().constructor.name).reduce(Ws),Ps=Er(Ts),_s=Er(Rs),Bs=Er(Es),tt=(...t)=>{let e,r,o,n;if(Array.isArray(t[0])?e=t[0]:(r=Ps(t),o=_s(t),n=Bs(t)),e===void 0||e[re]!==void 0)return m=>m?m[Je]:e[Je];let i=function(m,u=!0){m[Ot].has(i)||As(m,i);let f=m[Ot].get(i);return Ms(m),f.changedComponents.length?Os(f,u):f.dense};return i[sn]=e,i[vs]=r,i[Ls]=o,i[Gs]=n,i},Pt=(t,e,r)=>{let{masks:o,notMasks:n,generations:i}=e,m=0;for(let u=0;u<i.length;u++){let f=i[u],d=o[f],l=n[f],b=t[ee][f][r];if(l&&(b&l)>0||d&&(b&d)!==d)return!1}return!0},_t=(t,e)=>{t.has(e)||(t.add(e),t.entered.push(e))},Fs=t=>{for(;t.toRemove.length;)t.remove(t.toRemove.pop())},Ms=t=>{t[Wt].forEach(Fs),t[Wt].clear()},vr=(t,e,r)=>{!e.has(r)||(e.toRemove.push(r),t[Wt].add(e),e.exited.push(r))};var re=Symbol("componentMap"),Ns=[],k=t=>{let e=Is(t,Ds());return t&&Object.keys(t).length&&Ns.push(e),e},Us=t=>{t[ot]*=2,t[ot]>=2**31&&(t[ot]=1,t[ee].push(new Uint32Array(t[Bt])))},Lr=(t,e)=>{if(!e)throw new Error("bitECS - Cannot register null or undefined component");let r=new Set,o=new Set,n=new Set;t[At].forEach(i=>{i.components.includes(e)&&r.add(i)}),t[re].set(e,{generationId:t[ee].length-1,bitflag:t[ot],store:e,queries:r,notQueries:o,changedQueries:n}),e[qe]<t[Bt]&&hs(e,t[Bt]),Us(t)};var rt=(t,e,r)=>{let o=t[re].get(e);if(!o)return;let{generationId:n,bitflag:i}=o;return(t[ee][n][r]&i)===i},X=(t,e,r,o=!0)=>{if(t[re].has(e)||Lr(t,e),rt(t,e,r))return;let n=t[re].get(e),{generationId:i,bitflag:m,queries:u,notQueries:f}=n;t[ee][i][r]|=m,u.forEach(d=>{Pt(t,d,r)?_t(d,r):vr(t,d,r)}),t[Ze].get(r).add(e),o&&tn(e,r)},he=(t,e,r,o=!1)=>{let n=t[re].get(e),{generationId:i,bitflag:m,queries:u,notQueries:f}=n;!(t[ee][i][r]&m)||(t[ee][i][r]&=~m,u.forEach(d=>{Pt(t,d,r)?_t(d,r):vr(t,d,r)}),t[Ze].get(r).delete(e),o&&tn(e,r))},Bt=Symbol("size"),id=Symbol("resizeThreshold"),ot=Symbol("bitflag"),ws=Symbol("archetypes"),Hs=Symbol("localEntities"),js=[],an=()=>{let t={};return ks(t),js.push(t),t},ks=t=>{let e=xs();return t[Bt]=e,t[Je]&&t[Je].forEach(r=>et(t,r)),t[ee]=[new Uint32Array(e)],t[Ze]=new Map,t[ws]=[],t[Oe]=on(),t[Je]=t[Oe].dense,t[ot]=1,t[re]=new Map,t[Ot]=new Map,t[At]=new Set,t[Rr]=new Set,t[Wt]=new Set,t[Hs]=new Map,t};var U=Ir;var a={IS_ROOT:0,DIRTY:1,X:2,Y:3,ROTATION:4,SCALE_X:5,SCALE_Y:6,SKEW_X:7,SKEW_Y:8,AXIS_ALIGNED:9,FRAME_X1:10,FRAME_Y1:11,FRAME_X2:12,FRAME_Y2:13,LOCAL_A:14,LOCAL_B:15,LOCAL_C:16,LOCAL_D:17,LOCAL_TX:18,LOCAL_TY:19,BOUNDS_X1:20,BOUNDS_Y1:21,BOUNDS_X2:22,BOUNDS_Y2:23,ORIGIN_X:24,ORIGIN_Y:25,WORLD_A:26,WORLD_B:27,WORLD_C:28,WORLD_D:29,WORLD_TX:30,WORLD_TY:31,FRAME_WIDTH:32,FRAME_HEIGHT:33,DIRTY_WORLD:34,IN_VIEW:35,UPDATED:36},p=k({data:[U.f32,37]});window.defaultSize?Tr(parseInt(window.defaultSize)):Tr(15e4);var Vs=an(),R=Vs;function Ft(t,e=0,r=0,o=0,n=0){X(R,p,t);let i=p.data[t];i[a.IS_ROOT]=0,i[a.DIRTY]=1,i[a.X]=e,i[a.Y]=r,i[a.SCALE_X]=1,i[a.SCALE_Y]=1,i[a.ORIGIN_X]=o,i[a.ORIGIN_Y]=n,i[a.AXIS_ALIGNED]=1,i[a.IN_VIEW]=1}function Gr(){}var nt=class{data;onChange;constructor(e){let r=new Float32Array(16);this.data=r,this.onChange=Gr,e?Array.isArray(e)?this.fromArray(e):this.fromArray(e.data):(r[0]=1,r[5]=1,r[10]=1,r[15]=1)}set(e,r,o,n,i,m,u,f,d,l,b,h,T,c,W,E){return this.data.set([e,r,o,n,i,m,u,f,d,l,b,h,T,c,W,E]),this.onChange(this),this}toArray(e=[],r=0){let o=this.data;for(let n=0;n<16;n++)e[r+n]=o[n];return e}fromArray(e,r=0){let o=this.data;for(let n=0;n<16;n++)o[n]=e[r+n];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=Gr,this.data=null}};function Mt(t,e,r,o,n){let i=p.data[t];i[a.BOUNDS_X1]=e,i[a.BOUNDS_Y1]=r,i[a.BOUNDS_X2]=o,i[a.BOUNDS_Y2]=n}var Ar=class{id=te(R);type="StaticCamera";name="";isDirty=!0;matrix;constructor(e,r){let o=this.id;Ft(o,0,0,0,0),this.matrix=new nt,this.reset(e,r)}getBoundsX(){return p.data[this.id][a.BOUNDS_X1]}getBoundsY(){return p.data[this.id][a.BOUNDS_Y1]}getBoundsRight(){return p.data[this.id][a.BOUNDS_X2]}getBoundsBottom(){return p.data[this.id][a.BOUNDS_Y2]}getMatrix(){return this.matrix.data}updateBounds(){return this.isDirty=!0,!0}update(){return!1}reset(e,r){Mt(this.id,0,0,e,r)}destroy(){let e=this.id;he(R,p,e),et(R,e)}};function mn(){let t=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),e=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);console.log("MAX GPU",t,"MAX COMBINED",e);let r=Ge();r===0||r>t?lt(t):t=r;let o=[];for(let n=0;n<t;n++){let i=s.createTexture();s.activeTexture(s.TEXTURE0+n),s.bindTexture(s.TEXTURE_2D,i),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o.push([n,i])}return o}var un,Nt={get:()=>un,set:t=>{un=t}};var Or=class{renderPass;textures;tempTextures;textureIndex;maxTextures;constructor(e){this.renderPass=e}bind(e,r=0){let o=e.binding;o.bind(r),s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,o.texture)}unbind(e=0){s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,this.tempTextures[e])}unbindTexture(e){let r=e.binding.textureUnit;e.binding.unbind(),s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,this.tempTextures[r])}setWhite(){return this.set(Nt.get())}set(e){if(!e.binding)return-1;let r=e.binding,o=this.textures;if(!r.isBound){o.size===this.maxTextures&&(K(this.renderPass),this.clear());let n=o.size;s.activeTexture(s.TEXTURE0+n),s.bindTexture(s.TEXTURE_2D,r.texture),o.set(n,e),r.bind(n)}return r.textureUnit}setDefault(){this.textures&&this.reset();let e=mn();this.maxTextures=e.length,this.tempTextures=new Map(e),this.textures=new Map,this.textureIndex=[],this.tempTextures.forEach((r,o)=>{this.textureIndex.push(o)})}clear(){this.textures.forEach(e=>e.binding.unbind()),this.textures.clear()}reset(){this.tempTextures.forEach((e,r)=>{s.activeTexture(s.TEXTURE0+r),s.bindTexture(s.TEXTURE_2D,e)}),this.clear()}};function Wr(t){s.isBuffer(t)&&s.deleteBuffer(t)}var Pr=class{name;batchSize;dataSize;vertexElementSize;vertexByteSize;entryByteSize;bufferByteSize;data;vertexViewF32;vertexBuffer;entryElementSize;indexed=!1;isDynamic=!1;count=0;offset=0;elementsPerEntry;isBound=!1;constructor(e={}){let{name:r="VBO",batchSize:o=1,dataSize:n=4,isDynamic:i=!0,elementsPerEntry:m=3,vertexElementSize:u=9}=e;this.name=r,this.batchSize=o,this.dataSize=n,this.vertexElementSize=u,this.isDynamic=i,this.elementsPerEntry=m,this.vertexByteSize=u*n,this.entryByteSize=this.vertexByteSize*m,this.bufferByteSize=o*this.entryByteSize,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry,this.create()}resize(e){this.batchSize=e,this.bufferByteSize=e*this.entryByteSize,this.vertexBuffer&&Wr(this.vertexBuffer),this.create()}create(){let e=new ArrayBuffer(this.bufferByteSize);this.data=e,this.vertexViewF32=new Float32Array(e),this.vertexBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer);let r=this.isDynamic?s.DYNAMIC_DRAW:s.STATIC_DRAW;s.bufferData(s.ARRAY_BUFFER,e,r),s.bindBuffer(s.ARRAY_BUFFER,null),this.isBound=!1}add(e){this.count+=e,this.offset+=this.vertexElementSize*e}reset(){this.count=0,this.offset=0}canContain(e){return this.count+e<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer)}destroy(){Wr(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexBuffer=null}};var _r=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e){return this.index++,this.index===this.stack.length?this.stack.push(e):this.stack[this.index]=e,e}bindDefault(){this.index=0,this.bind(this.default)}bind(e){if(e||(e=this.current),!e.isBound){let r=e.indexed?e.indexBuffer:null;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),s.bindBuffer(s.ARRAY_BUFFER,e.vertexBuffer),e.isBound=!0,this.active&&this.active!==e&&(this.active.isBound=!1),this.active=e}}pop(){this.index--,this.bind()}set(e){let r=this.add(e);this.bind(r)}setDefault(e){this.stack[0]=e,this.index=0,this.default=e}};function dn(t,e,r){return t.width<=0||t.height<=0?!1:t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r}var Ut=class{x;y;width;height;constructor(e=0,r=0,o=0,n=0){this.set(e,r,o,n)}set(e=0,r=0,o=0,n=0){return this.x=e,this.y=r,this.width=o,this.height=n,this}contains(e,r){return dn(this,e,r)}set right(e){e<=this.x?this.width=0:this.width=e-this.x}get right(){return this.x+this.width}set bottom(e){e<=this.y?this.height=0:this.height=e-this.y}get bottom(){return this.y+this.height}};function fn(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}var Br=class{renderPass;stack;active;default;index;constructor(e){this.renderPass=e,this.stack=[]}get current(){return this.stack[this.index]}add(e=0,r=0,o=0,n=0){let i=new Ut(e,r,o,n);return this.index++,this.index===this.stack.length?this.stack.push(i):this.stack[this.index]=i,i}bindDefault(){this.index=0,this.bind(this.default)}bind(e){e||(e=this.current),(!this.active||!fn(this.active,e))&&(s.viewport(e.x,e.y,e.width,e.height),this.active=e)}pop(){this.index--,this.bind()}set(e=0,r=0,o=0,n=0){let i=this.add(e,r,o,n);this.bind(i)}setDefault(e=0,r=0,o=0,n=0){let i=new Ut(e,r,o,n);this.stack[0]=i,this.index=0,this.default=i}};var Fr=class{renderer;projectionMatrix;cameraMatrix;count=0;prevCount=0;flushTotal=0;framebuffer;vertexbuffer;blendMode;shader;viewport;textures;colorMatrix;quadShader;quadCamera;current2DCamera;constructor(e){this.renderer=e,this.projectionMatrix=new Float32Array(16),this.framebuffer=new lr(this),this.vertexbuffer=new _r(this),this.blendMode=new fr(this),this.shader=new Cr(this),this.viewport=new Br(this),this.textures=new Or(this),this.colorMatrix=new cr(this),this.reset()}getCurrentShader(){return this.shader.current.shader}flush(){this.prevCount=this.count,this.count=0,this.flushTotal++}reset(){let e=this.renderer.gl;this.quadShader=new Ae,this.quadCamera=new Ar(this.renderer.width,this.renderer.height),this.textures.setDefault(),this.framebuffer.setDefault(),this.blendMode.setDefault(!0,e.ONE,e.ONE_MINUS_SRC_ALPHA),this.colorMatrix.setDefault(It,Oo),this.vertexbuffer.setDefault(new Pr({batchSize:Po()})),this.shader.setDefault(Ge()===1?new Ae:new br)}resize(e,r){_o(this.projectionMatrix,0,e,r,0,-1e3,1e3),this.quadCamera.reset(e,r),this.viewport.setDefault(0,0,e,r)}isCameraDirty(){return this.current2DCamera.isDirty}};function cn(t){return t.current2DCamera||(t.current2DCamera=t.quadCamera,t.cameraMatrix=t.quadCamera.getMatrix()),t.count=0,t.flushTotal=0,t.framebuffer.bindDefault(),t.blendMode.bindDefault(),t.viewport.bindDefault(),t.vertexbuffer.bindDefault(),t.shader.bindDefault(),t.colorMatrix.bindDefault(),t}var ln,be={get:()=>ln,set:t=>{ln=t}};var pn,Mr={get:()=>pn,set:t=>{pn=t,be.set(t)}};var Nr=class{canvas;gl;renderPass;clearColor=[0,0,0,1];width;height;resolution;clearBeforeRender=!0;optimizeRedraw=!0;autoResize=!0;contextLost=!1;compression;constructor(){this.width=ct(),this.height=dt(),this.resolution=ft(),this.setBackgroundColor(ho());let e=document.createElement("canvas");e.addEventListener("webglcontextlost",r=>this.onContextLost(r),!1),e.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=e,this.initContext(),Mr.set(this),this.renderPass=new Fr(this),this.resize(this.width,this.height,this.resolution),dr()}initContext(){let e=this.canvas.getContext("webgl",vo());go.set(e),this.gl=e,this.compression=Ro(e),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}resize(e,r,o=1){let n=e*o,i=r*o;this.width=n,this.height=i,this.resolution=o;let m=this.canvas;m.width=n,m.height=i,this.autoResize&&(m.style.width=e.toString()+"px",m.style.height=r.toString()+"px"),this.renderPass.resize(n,i)}onContextLost(e){e.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(e){return Eo(e,this.clearColor),this}reset(){}begin(e){if(this.contextLost)return;let r=this.gl;if(r.getContextAttributes(),dr(),this.optimizeRedraw&&!e,this.clearBeforeRender){let o=this.clearColor;r.clearColor(o[0],o[1],o[2],o[3]),r.clear(r.COLOR_BUFFER_BIT)}return cn(this.renderPass)}end(){To(this.renderPass)}destroy(){Mr.set(void 0)}};function Ur(){return()=>{bo(Nr)}}function hn(t){I.set(C.WEBGL_CONTEXT,t)}function bn(t,e,r,o,n,i,m,u,f,d,l,b,h,T,c,W,E,v,M){return t[e+0]=o,t[e+1]=n,t[e+2]=b,t[e+3]=h,t[e+4]=r,t[e+5]=W,t[e+6]=E,t[e+7]=v,t[e+8]=M,t[e+9]=i,t[e+10]=m,t[e+11]=b,t[e+12]=c,t[e+13]=r,t[e+14]=W,t[e+15]=E,t[e+16]=v,t[e+17]=M,t[e+18]=u,t[e+19]=f,t[e+20]=T,t[e+21]=c,t[e+22]=r,t[e+23]=W,t[e+24]=E,t[e+25]=v,t[e+26]=M,t[e+27]=o,t[e+28]=n,t[e+29]=b,t[e+30]=h,t[e+31]=r,t[e+32]=W,t[e+33]=E,t[e+34]=v,t[e+35]=M,t[e+36]=u,t[e+37]=f,t[e+38]=T,t[e+39]=c,t[e+40]=r,t[e+41]=W,t[e+42]=E,t[e+43]=v,t[e+44]=M,t[e+45]=d,t[e+46]=l,t[e+47]=T,t[e+48]=h,t[e+49]=r,t[e+50]=W,t[e+51]=E,t[e+52]=v,t[e+53]=M,e+54}var wt={buffer:null,F32:null,offset:0};function Cn(t,e=0){let r=t.vertexbuffer.current;return t.count+e>=r.batchSize&&K(t),wt.buffer=r,wt.F32=r.vertexViewF32,wt.offset=t.count*r.entryElementSize,t.count+=e,wt}function In(t,e,r,o,n=1,i=1,m=1){let{F32:u,offset:f}=Cn(t,2),d=e.firstFrame,l=t.textures.set(e),b=d.width*i,h=d.height*m;bn(u,f,l,r,o,r,o+h,r+b,o+h,r+b,o,d.u0,d.v0,d.u1,d.v1,1,1,1,n)}function xn(){let{title:t,version:e,url:r,color:o,background:n}=I.get(C.BANNER);if(t!==""){let i=`${t} ${e}`.trimEnd();console.log(`%c${i}%c ${r}`,`padding: 4px 16px; color: ${o}; background: ${n}`,"")}}function Sn(t){let e=I.get(C.GLOBAL_VAR);e&&window&&(window[e]=t)}function Dn(t,e){return pt(e).appendChild(t),t}function gn(){let t=I.get(C.PARENT),e=be.get().canvas;t&&e&&Dn(e,t)}function yn(){let t=I.get(C.RENDERER);t&&new t}var Tn,Rn=0,En=0,Ce={get:()=>Tn,set:t=>{Tn=t},getFrame:()=>Rn,setFrame:t=>{Rn=t},getElapsed:()=>En,setElapsed:t=>{En=t}};function vn(){return I.get(C.SCENES)}var wr=class{callback;context;once;constructor(e,r,o=!1){this.callback=e,this.context=r,this.once=o}};function Ht(t,e,r,o=t,n=!1){if(typeof r!="function")throw new TypeError("Listener not a function");let i=new wr(r,o,n),m=t.events.get(e);return m?m.add(i):t.events.set(e,new Set([i])),i}function jt(t,e,r,o=t){return Ht(t,e,r,o,!0)}var V={fps:0,delta:0,gameFrame:0,numScenes:0,numWorlds:0,numGameObjects:0,numGameObjectsRendered:0,numDirtyLocalTransforms:0,numDirtyWorldTransforms:0,numDirtyVertices:0,numDirtyWorldLists:0,numDirtyCameras:0};function Ln(t,e){V.gameFrame=t,V.numScenes=e,V.numWorlds=0,V.numGameObjects=0,V.numGameObjectsRendered=0,V.numDirtyWorldLists=0,V.numDirtyVertices=0,V.numDirtyLocalTransforms=0,V.numDirtyWorldTransforms=0,V.numDirtyCameras=0}var Hr,Ee={get:()=>Hr,set:t=>{if(Hr)throw new Error("Cannot instantiate SceneManager more than once");Hr=t}};var Ie=new Map;var jr=class{id=te(R);game;scenes=new Map;sceneIndex=0;flush;constructor(){Ee.set(this),this.game=Ce.get(),jt(this.game,"boot",()=>this.boot())}boot(){let e=vn();e&&e.forEach(r=>new r)}update(){let e=this.game.time,r=e.delta,o=e.lastTick,n=e.frame;Ln(n,this.scenes.size);for(let i of this.scenes.values()){let m=Ie.get(i);for(let u of m)u.beforeUpdate(r,o);i.update&&i.update(r,o);for(let u of m)u.update(r,o);for(let u of m)u.afterUpdate(r,o)}}preRender(){let e=this.game.time.frame;for(let r of this.scenes.values()){let o=Ie.get(r);for(let n of o)n.preRender(e)&&(this.flush=!0)}}render(e){for(let r of this.scenes.values()){let o=Ie.get(r);for(let n of o)n.renderGL(e)}this.flush=!1}};function Gn(){new jr}function kt(t,e){let r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}var kr,Pe={get:()=>kr,set:t=>{if(kr)throw new Error("Cannot instantiate TextureManager more than once");kr=t}};var Vr=class{textures;constructor(){Pe.set(this),this.textures=new Map,this.createDefaultTextures()}createDefaultTextures(){this.add("__BLANK",new fe(kt(2,2).canvas));let e=kt(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new fe(e.canvas));let r=kt(2,2);r.fillStyle="#fff",r.fillRect(0,0,2,2);let o=this.add("__WHITE",new fe(r.canvas));Nt.set(o)}get(e){let r=this.textures;return r.has(e)?r.get(e):r.get("__MISSING")}has(e){return this.textures.has(e)}add(e,r,o){let n;return this.textures.has(e)||(r instanceof fe?n=r:n=new fe(r,0,0,o),n.key=e,this.textures.set(e,n)),n}update(e,r,o){let n=this.textures.get(e);return n&&n.update(r,o),n}};function An(){new Vr}function On(t){let e=document.readyState;if(e==="complete"||e==="interactive"){t();return}let r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}function w(t,e,...r){if(t.events.size===0||!t.events.has(e))return!1;let o=t.events.get(e),n=[...o];for(let i of n)i.callback.apply(i.context,r),i.once&&o.delete(i);return o.size===0&&t.events.delete(e),!0}var Yr=class{events;constructor(){this.events=new Map}};function Wn(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:r}function Pn(t,e={}){let r=Ee.get(),o=r.scenes.size,n=r.sceneIndex,i=o===0;typeof e=="string"?t.key=e:(e||!e&&i)&&(t.key=Wn(e,"key","scene"+n.toString())),r.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(r.scenes.set(t.key,t),r.flush=!0,r.sceneIndex++),Ie.set(t,[])}var zr=class{key;game;events;constructor(e){this.game=Ce.get(),this.events=new Map,Pn(this,e)}};function _n(){ut(0),po(2048),lo("Phaser","4.0.0","https://phaser4.io"),lt(0),Co(.5,.5),Do(800,600,1),hn({antialias:!0,desynchronized:!0,preserveDrawingBuffer:!0})}var Xr=class{lastTick=0;elapsed=0;delta=0;fps=0;fpsCount=0;frame=0;ms=0;prevFrame=0;constructor(){let e=performance.now();this.lastTick=e,this.prevFrame=e}update(e){this.ms=e-this.lastTick}updateDelta(e){let r=performance.now(),o=r-e;return this.fpsCount++,r>=this.prevFrame+1e3&&(this.fps=this.fpsCount*1e3/(r-this.prevFrame),this.prevFrame=r,this.fpsCount=0),this.lastTick=r,this.elapsed+=o,this.delta=o,this.frame++,Ce.setFrame(this.frame),V.fps=this.fps,V.delta=o,this.frame}resetLastTick(){this.lastTick=performance.now()}};var Qr=class extends Yr{id=te(R);time;isBooted=!1;isPaused=!1;willUpdate=!0;willRender=!0;constructor(...e){super();this.time=new Xr,Ce.set(this),_n(),On(()=>this.boot(e))}boot(e){e.forEach(r=>r()),yn(),An(),Gn(),xn(),Sn(this),gn(),this.isBooted=!0,w(this,"boot"),requestAnimationFrame(r=>this.step(r))}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.time.resetLastTick()}update(e,r){}render(e,r,o){}step(e){let r=be.get(),o=Ee.get(),n=this.time;if(n.update(e),!this.isPaused){let i=n.delta;if(this.willUpdate&&(o.update(),this.update(i,e),w(this,"update",i,e)),this.willRender){o.preRender(),r.begin(o.flush);let m=r.renderPass;o.render(m),this.render(m,i,e),w(this,"render",m,i,e),r.end()}}n.updateDelta(e),w(this,"step"),requestAnimationFrame(i=>this.step(i))}destroy(){}};function Bn(t){return Pe.get().get(t)}function Fn(t,e,r=!1){return{key:t,url:e,skipCache:r}}function Mn(t){return/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.test(t)}function Nn(t,e,r,o){return e||(e=`${t}.${r}`),Mn(e)?e:o?`${o.baseURL}${o.path}${e}`:e}async function Un(t,e,r,o){if(!e(t))return Promise.reject(t);try{let n=new Request(t.url,o?.requestInit);return t.response=await fetch(n),t.response.ok&&await r(t)?Promise.resolve(t):Promise.reject(t)}catch(n){return t.error=n,Promise.reject(t)}}function wn(t,e,r={}){return o=>{let n=Fn(t,Nn(t,e,"png",o),r?.skipCache),i=Pe.get();return Un(n,()=>i&&(!i.has(t)||!i.get(t).locked),async f=>{let d=await f.response.blob(),l;return window&&"createImageBitmap"in window&&!r?.getImage?l=await createImageBitmap(d):l=await new Promise((b,h)=>{let T=URL.createObjectURL(d),c=new Image;c.onload=()=>{URL.revokeObjectURL(T),b(c)},c.onerror=()=>{h()},c.src=T,c.complete&&c.width&&c.height&&(c.onload=null,c.onerror=null,b(c))}),l?(r.skipCache?f.data=l:i.has(t)?f.data=i.update(t,l,r?.glConfig):f.data=i.add(t,l,r?.glConfig),!0):!1},r)}}async function Hn(t,e,r={}){return wn(t,e,r)()}var $r="afterupdate";var it="beforeupdate";var st="worldpostrender";var qr="worldrender";var Kr="worldshutdown";var at="update";var B={local:[],set:function(t,e){this.local[t]=e},get:function(t){return this.local[t]},clear:function(){this.local.length=0},remove:function(t){this.local[t]=null}};var D={WORLD:0,PARENT:1,NEXT:2,PREV:3,FIRST:4,LAST:5,NUM_CHILDREN:6,DEPTH:7},g=k({data:[U.ui32,8]});function F(t){return g.data[t][D.FIRST]}function N(t){return g.data[t][D.NEXT]}function Y(t){return g.data[t][D.NUM_CHILDREN]}var y={CHILD:0,CHILD_CACHE:1,CHILD_TRANSFORM:2,CHILD_WORLD_TRANSFORM:3,CHILD_COLOR:4,DISPLAY_LIST:5,COLOR:6},S=k({data:[U.ui8,7]});function jn(t){return Boolean(S.data[t][y.CHILD_CACHE])}var G={VISIBLE:0,VISIBLE_CHILDREN:1,WILL_UPDATE:2,WILL_UPDATE_CHILDREN:3,WILL_RENDER:4,WILL_RENDER_CHILDREN:5,WILL_CACHE_CHILDREN:6,WILL_TRANSFORM_CHILDREN:7,WILL_COLOR_CHILDREN:8},L=k({data:[U.ui8,9]});function ve(t){return Boolean(L.data[t][G.WILL_CACHE_CHILDREN])}function Vt(t){return Boolean(L.data[t][G.VISIBLE_CHILDREN])}function kn(t){return Vt(t)&&Boolean(L.data[t][G.WILL_RENDER_CHILDREN])}function Vn(t,e){let r=Y(t);return r===0||!kn(t)?0:e||!ve(t)||ve(t)&&jn(t)?r:0}function Zr(t){return Boolean(p.data[t][a.IN_VIEW])}function xe(t){return Boolean(L.data[t][G.VISIBLE])&&Boolean(L.data[t][G.WILL_RENDER])}var Yt=0;function Yn(){return Yt}function zn(){Yt=0}function Jr(t,e){let r=Zr(e)||ve(e),o;r&&(o=B.get(e),o.renderGL(t),Yt++);let n=Vn(e,t.isCameraDirty());if(n){let i=F(e);for(let m=0;m<n;m++){if(xe(i)){if(Y(i))Jr(t,i);else if(Zr(i)){let u=B.get(i);u.renderGL(t),u.postRenderGL(t),Yt++}}i=N(i)}}r&&o.postRenderGL(t)}var Ys=k({r:U.ui8c,g:U.ui8c,b:U.ui8c,a:U.f32,colorMatrix:[U.f32,16],colorOffset:[U.f32,4]}),A=Ys;function Xn(t){X(R,A,t),A.r[t]=255,A.g[t]=255,A.b[t]=255,A.a[t]=1,A.colorMatrix[t].set(It)}function _(t){return g.data[t][D.WORLD]}function oe(t){S.data[t][y.COLOR]=1;let e=_(t);e&&(S.data[e][y.CHILD_COLOR]=1)}function Qn(t){X(R,S,t),oe(t)}function $n(t){S.data[t][y.CHILD]=0}function qn(t){S.data[t][y.COLOR]=0}function Kn(t){S.data[t][y.DISPLAY_LIST]=0}function zt(t){p.data[t][a.DIRTY]=0}function Zn(t){return Boolean(S.data[t][y.COLOR])}function Xt(t){return Boolean(S.data[t][y.DISPLAY_LIST])}function Qt(t){return Boolean(p.data[t][a.DIRTY])}function Jn(t){S.data[t][y.CHILD]=1}function ei(t){S.data[t][y.CHILD_CACHE]=1}function _e(t){S.data[t][y.DISPLAY_LIST]=1}function O(t){return g.data[t][D.PARENT]}function ti(t){let e=[],r=O(t);for(;r;)e.push(r),r=O(r);return e}function Be(t){S.data[t][y.CHILD_TRANSFORM]=1}function ne(t){p.data[t][a.DIRTY]=1,z(t)}function Fe(t){return Boolean(L.data[t][G.WILL_TRANSFORM_CHILDREN])}function z(t){let e=_(t),r=ti(t);for(let o=0;o<r.length;o++){let n=r[o];Jn(n),Fe(n)&&ne(n),ve(n)&&ei(n),n===e&&Be(n)}}function ri(t){let e=_(t);e>0&&S.data[e][y.DISPLAY_LIST]}function oi(t,e){L.data[t][G.WILL_COLOR_CHILDREN]=Number(e)}function ni(t){return Boolean(L.data[t][G.WILL_COLOR_CHILDREN])}var eo=class{id;colorMatrixEnabled=!1;constructor(e,r=255,o=255,n=255,i=1){Xn(e),this.id=e,this.set(r,o,n,i)}set(e,r,o,n){this.red=e,this.green=r,this.blue=o,this.alpha=n}set tint(e){this.red=e>>16&255,this.green=e>>8&255,this.blue=e&255}get tint(){return this.red<<16|this.green<<8|this.blue}set willColorChildren(e){oi(this.id,e)}get willColorChildren(){return ni(this.id)}set colorMatrix(e){A.colorMatrix[this.id].set(e),oe(this.id),this.colorMatrixEnabled=!0}get colorMatrix(){return A.colorMatrix[this.id]}set colorOffset(e){A.colorOffset[this.id].set(e),oe(this.id)}get colorOffset(){return A.colorOffset[this.id]}set red(e){A.r[this.id]=e,oe(this.id)}get red(){return A.r[this.id]}set green(e){A.g[this.id]=e,oe(this.id)}get green(){return A.g[this.id]}set blue(e){A.b[this.id]=e,oe(this.id)}get blue(){return A.b[this.id]}set alpha(e){A.a[this.id]=e,oe(this.id)}get alpha(){return A.a[this.id]}};function ii(t){X(R,g,t)}function si(t){X(R,L,t),L.data[t].set([1,1,1,1,1,1,1,1,1])}function $t(t,e=1){let r=g.data[t];r[D.NUM_CHILDREN]-=e,r[D.NUM_CHILDREN]<0&&(r[D.NUM_CHILDREN]=0)}function ai(t){let e=_(t),r=O(t),o=B.get(e);g.data[t][D.WORLD]=0,g.data[t][D.PARENT]=0,o&&rt(R,o.tag,t)&&he(R,o.tag,t),$t(r),z(t)}function mi(t){let e=F(t.id),r=[];for(;e>0;)r.push(e),e=N(e);return r}function Me(t,e){g.data[t][D.NEXT]=e}function Ne(t,e){g.data[t][D.PREV]=e}function Ue(t,e){Me(t,e),Ne(e,t)}function pe(t,e){g.data[t][D.FIRST]=e}function ie(t,e){g.data[t][D.LAST]=e}function Se(t,e){g.data[t][D.NUM_CHILDREN]=e}function ui(t,e){let r=e.length;if(r===0){Se(t,0),pe(t,0),ie(t,0);return}let o=1,n=e[0];if(pe(t,n),r===1){ie(t,n),Se(t,o);return}for(let i=1;i<r;i++){let m=e[i];Ue(n,m),n=m,o++}ie(t,n),Se(t,o)}function qt(t,e=0,r){let o=t.id;r===void 0&&(r=Y(o));let n=r-e;if(n>0&&n<=r){let i=mi(t),m=i.splice(e,n);return m.forEach(u=>{ai(u)}),ui(o,i),m.map(u=>B.get(u))}else return[]}function di(t,e=0,r){qt(t,e,r).forEach(n=>{n.destroy()}),ri(t.id)}var fi="destroy";function ci(t){let e=[],r=F(t);for(;r>0;)e.push(B.get(r)),r=N(r);return e}function li(t){return g.data[t][D.DEPTH]}function pi(t){return B.get(g.data[t][D.PARENT])}function hi(t){return Boolean(L.data[t][G.VISIBLE])}function we(t){return g.data[t][D.LAST]}function bi(t,e){let r=e.id,o=t.id;return!(o===0||r===o||o===O(r))}function Kt(t){return g.data[t][D.PREV]}function Ci(t,e){let r=F(t);if(r>0)return r;{let o=N(t);if(o===0){let n=O(t);return n===e?0:N(n)}else return o}}function Zt(t,e=!0){let r=[t],o=F(t);for(;o>0;)r.push(o),o=Ci(o,t);return e&&r.shift(),r}function Jt(t){let e=_(t);if(e)return B.get(e)}function er(t){let e=_(t);return B.get(e)}function Ii(t,e){g.data[t][D.DEPTH]=e}function tr(t,e){g.data[t][D.PARENT]=e}function He(t,e){g.data[t][D.WORLD]=e}function xi(t){let e=er(t);Zt(t,!1).map(o=>{he(R,e.tag,o),He(o,0)})}function Si(t,e){let r=O(t);if(r){let i=F(r),m=we(r),u=N(t),f=Kt(t);t===i&&pe(r,u),t===m&&ie(r,f),u&&Ne(u,f),f&&Me(f,u),z(t),tr(t,0),Se(r,Y(r)-1)}let o=Jt(t),n=e?Jt(e):null;o&&o!==n&&xi(t)}function Di(t){S.data[t][y.CHILD_COLOR]=1}function gi(t,e){let r=t.id,o=t.tag;Zt(e,!1).map(i=>{X(R,o,i),He(i,r)}),_e(r),Di(r),Be(r)}function yi(t){let e=_(t),r=O(t),o=!0;for(;r&&r!==e;){if(Fe(r)){o=!1;break}r=O(r)}p.data[t][a.IS_ROOT]=Number(o)}function Ti(t,e,r=1){tr(e,t),ne(e),z(e),yi(e),Se(t,Y(t)+r);let o=er(t);o&&gi(o,e)}function Ri(t,e){if(bi(t,e)){let r=e.id,o=t.id,n=Y(o);if(Si(r,o),n===0)pe(o,r);else{let i=we(o);Ue(i,r)}ie(o,r),Ti(o,r)}return e}function Ei(t,e,r=0,o){let n=qt(t,r,o);return n.forEach(i=>{Ri(e,i)}),n}function vi(t,e){L.data[t][G.VISIBLE]=Number(e),z(t),_e(_(t))}function Li(t,e){L.data[t][G.VISIBLE_CHILDREN]=Number(e),z(t),_e(_(t))}var to=class{id=te(R);type="GameObject";name="";events;constructor(){let e=this.id;ii(e),si(e),Qn(e),B.set(e,this),this.events=new Map}isRenderable(){return xe(this.id)}beforeUpdate(e,r){}update(e,r){}afterUpdate(e,r){}preRenderGL(e){}renderGL(e){}renderCanvas(e){}postRenderGL(e){}postRenderCanvas(e){}set visible(e){vi(this.id,e)}get visible(){return hi(this.id)}set visibleChildren(e){Li(this.id,e)}get visibleChildren(){return Vt(this.id)}set depth(e){Ii(this.id,e)}get depth(){return li(this.id)}hasParent(e){let r=O(this.id);return e?r===e:r>0}getParent(){return pi(this.id)}getChildren(){return ci(this.id)}getNumChildren(){return Y(this.id)}toString(){return`${this.type} id="${this.id}" name="${this.name}"`}destroy(e){e?Ei(this,e):di(this),w(this,fi,this),this.events.clear(),this.events=null}};function Gi(t){Me(t,0),Ne(t,0)}function Ai(t){let e=O(t),r=F(e),o=we(e),n=Kt(t),i=N(t);Ue(n,i),r===t&&pe(e,i),o===t&&ie(e,n),Gi(t)}function Oi(t,e){let r=e.id,o=t.id;return e.hasParent(o)&&(Ai(r),$t(o)),e}function Wi(t,...e){return e.forEach(r=>{Oi(t,r)}),e}var Pi="destroy";function rr(t){return Boolean(L.data[t][G.WILL_UPDATE])}var ro=class extends to{type="BaseWorld";tag=k();scene;camera;is3D=!1;color;totalChildren=0;totalChildrenQuery;constructor(e){super();let r=this.id,o=this.tag;this.scene=e,this.totalChildrenQuery=tt([o]),He(r,r),Ie.get(e).push(this),this.color=new eo(r),jt(e,Pi,()=>this.destroy())}getNumChildren(){return Xt(this.id)&&(this.totalChildren=this.totalChildrenQuery(R).length),this.totalChildren}beforeUpdate(e,r){w(this,it,e,r,this)}update(e,r){!rr(this.id)||(w(this,at,e,r,this),super.update(e,r))}afterUpdate(e,r){w(this,$r,e,r,this)}preRender(e){return!0}renderGL(e){}shutdown(){Wi(this),w(this,Kr,this)}destroy(e){super.destroy(e),this.shutdown(),this.camera&&this.camera.destroy(),this.camera=null}};function _i(t,e){t.current2DCamera!==e&&(K(t),t.current2DCamera=e,t.cameraMatrix=e.getMatrix()),e.update()&&t.getCurrentShader().bind(t)}function Bi(t,e){t.shader.bindDefault(),_i(t,e)}function Fi(t){S.data[t][y.CHILD_COLOR]=0}function or(t){S.data[t][y.CHILD_TRANSFORM]=0}function Mi(t){S.data[t][y.CHILD_WORLD_TRANSFORM]=0}function Ni(t){return Boolean(S.data[t][y.CHILD_COLOR])}function nr(t){return Boolean(S.data[t][y.CHILD_TRANSFORM])}function Ui(t){return Boolean(S.data[t][y.CHILD_WORLD_TRANSFORM])}function wi(t){return Boolean(L.data[t][G.WILL_UPDATE_CHILDREN])}function Hi(t){let e=F(t);if(e>0&&wi(t))return e;{let r=N(t);if(r===0){let o=O(t);return o===_(t)?0:N(o)}else return r}}function ji(t,e){e.colorMatrixEnabled&&e.willColorChildren&&t.colorMatrix.pop()}var je=k({values:[U.f32,54]});function ke(t){p.data[t][a.DIRTY_WORLD]=1}function ki(t,e){let r=p.data[e],o=p.data[t];r[a.WORLD_A]=o[a.LOCAL_A],r[a.WORLD_B]=o[a.LOCAL_B],r[a.WORLD_C]=o[a.LOCAL_C],r[a.WORLD_D]=o[a.LOCAL_D],r[a.WORLD_TX]=o[a.LOCAL_TX],r[a.WORLD_TY]=o[a.LOCAL_TY],ke(e)}function Vi(t,e){let r=p.data[e],o=p.data[t];r[a.WORLD_A]=o[a.WORLD_A],r[a.WORLD_B]=o[a.WORLD_B],r[a.WORLD_C]=o[a.WORLD_C],r[a.WORLD_D]=o[a.WORLD_D],r[a.WORLD_TX]=o[a.WORLD_TX],r[a.WORLD_TY]=o[a.WORLD_TY],ke(e)}function Yi(t,e){let r=p.data[t],o=p.data[e],n=r[a.WORLD_A],i=r[a.WORLD_B],m=r[a.WORLD_C],u=r[a.WORLD_D],f=r[a.WORLD_TX],d=r[a.WORLD_TY],l=o[a.LOCAL_A],b=o[a.LOCAL_B],h=o[a.LOCAL_C],T=o[a.LOCAL_D],c=o[a.LOCAL_TX],W=o[a.LOCAL_TY];o[a.WORLD_A]=l*n+b*m,o[a.WORLD_B]=l*i+b*u,o[a.WORLD_C]=h*n+T*m,o[a.WORLD_D]=h*i+T*u,o[a.WORLD_TX]=c*n+W*m+f,o[a.WORLD_TY]=c*i+W*u+d,ke(e)}function zi(t){let e=O(t);rt(R,p,e)?Fe(t)?Yi(e,t):Vi(e,t):ki(t,t)}function Xi(t){let e=0;for(let r=0;r<t.length;r++){let o=t[r],n=O(o);(Qt(o)||nr(n))&&(zi(o),zt(o),e++)}return e}function Qi(t,e){e.colorMatrixEnabled&&e.willColorChildren&&t.colorMatrix.set(e)}function $i(t,e){L.data[t][G.WILL_CACHE_CHILDREN]=Number(e)}function qi(t,e){L.data[t][G.WILL_TRANSFORM_CHILDREN]=Number(e)}function Ki(t,e,r,o,n,i){let m=p.data[t];if(m[a.UPDATED]<e){let u=m[a.BOUNDS_X1],f=m[a.BOUNDS_Y1],d=m[a.BOUNDS_X2],l=m[a.BOUNDS_Y2];m[a.IN_VIEW]=Number(!(n<u||i<f||r>d||o>l)),m[a.UPDATED]=e}}function Zi(t,e,r){let o=e.getBoundsX(),n=e.getBoundsY(),i=e.getBoundsRight(),m=e.getBoundsBottom(),u=0,f=t.length;for(let d=0;d<f;d++){let l=t[d];xe(l)&&(Ki(l,r,o,n,i,m),u++)}return u}function Ji(t){let e=p.data[t];e[a.DIRTY]=0,e[a.DIRTY_WORLD]=0}function es(t){S.data[t][y.CHILD_WORLD_TRANSFORM]=1}function mt(t,e,r,o,n,i,m,u,f){let d=je.values[t];d[0]=e,d[1]=r,d[9]=o,d[10]=n,d[18]=i,d[19]=m,d[27]=e,d[28]=r,d[36]=i,d[37]=m,d[45]=u,d[46]=f}function ts(t,e,r,o){let n=r.getBoundsX(),i=r.getBoundsY(),m=r.getBoundsRight(),u=r.getBoundsBottom(),f=0,d=0,l=!1,b=e.length;for(let h=0;h<b;h++){let T=e[h],c=p.data[T];if(c[a.DIRTY]===0)continue;let W=c[a.IS_ROOT],E=c[a.X],v=c[a.Y],M=c[a.ROTATION],se=c[a.SCALE_X],H=c[a.SCALE_Y],x=c[a.SKEW_X],P=c[a.SKEW_Y],ae=c[a.AXIS_ALIGNED],$=c[a.FRAME_X1],me=c[a.FRAME_Y1],ue=c[a.FRAME_X2],de=c[a.FRAME_Y2],j=se,De=0,ge=0,Q=H;if(ae||(j=Math.cos(M+P)*se,De=Math.sin(M+P)*se,ge=-Math.sin(M-x)*H,Q=Math.cos(M-x)*H),c[a.LOCAL_A]=j,c[a.LOCAL_B]=De,c[a.LOCAL_C]=ge,c[a.LOCAL_D]=Q,c[a.LOCAL_TX]=E,c[a.LOCAL_TY]=v,W){if(c[a.WORLD_A]=j,c[a.WORLD_B]=De,c[a.WORLD_C]=ge,c[a.WORLD_D]=Q,c[a.WORLD_TX]=E,c[a.WORLD_TY]=v,c[a.UPDATED]=o,ae){let q=$*j+E,ye=me*Q+v,Ve=$*j+E,Ye=de*Q+v,Te=ue*j+E,Re=de*Q+v,ze=ue*j+E,Xe=me*Q+v;c[a.BOUNDS_X1]=q,c[a.BOUNDS_Y1]=ye,c[a.BOUNDS_X2]=Te,c[a.BOUNDS_Y2]=Re,c[a.IN_VIEW]=Number(!(m<q||u<ye||n>Te||i>Re)),mt(T,q,ye,Ve,Ye,Te,Re,ze,Xe)}else{let q=$*j+me*ge+E,ye=$*De+me*Q+v,Ve=$*j+de*ge+E,Ye=$*De+de*Q+v,Te=ue*j+de*ge+E,Re=ue*De+de*Q+v,ze=ue*j+me*ge+E,Xe=ue*De+me*Q+v,mo=Math.min(q,Ve,Te,ze),uo=Math.min(ye,Ye,Re,Xe),fo=Math.max(q,Ve,Te,ze),co=Math.max(ye,Ye,Re,Xe);c[a.BOUNDS_X1]=mo,c[a.BOUNDS_Y1]=uo,c[a.BOUNDS_X2]=fo,c[a.BOUNDS_Y2]=co,c[a.IN_VIEW]=Number(!(m<mo||u<uo||n>fo||i>co)),mt(T,q,ye,Ve,Ye,Te,Re,ze,Xe)}Ji(T)}else{let q=O(T);q!==d&&(z(T),d=q),l=!0}Be(T),f++}return l&&es(t),f}function rs(t,e,r,o,n){let i=je.values[t];i[5]=e,i[6]=r,i[7]=o,i[8]=n,i[14]=e,i[15]=r,i[16]=o,i[17]=n,i[23]=e,i[24]=r,i[25]=o,i[26]=n,i[32]=e,i[33]=r,i[34]=o,i[35]=n,i[41]=e,i[42]=r,i[43]=o,i[44]=n,i[50]=e,i[51]=r,i[52]=o,i[53]=n}function os(t){let e=0,r=t.length;for(let o=0;o<r;o++){let n=t[o];if(Zn(n)){let i=A.r[n]/255,m=A.g[n]/255,u=A.b[n]/255,f=A.a[n];rs(n,i,m,u,f),qn(n),e++}}return e}function ns(t){p.data[t][a.DIRTY_WORLD]=0}function is(t){return Boolean(p.data[t][a.DIRTY_WORLD])}function ss(t,e,r,o,n,i){let m=p.data[t],u=m[a.WORLD_A],f=m[a.WORLD_B],d=m[a.WORLD_C],l=m[a.WORLD_D],b=m[a.WORLD_TX],h=m[a.WORLD_TY],T=m[a.FRAME_X1],c=m[a.FRAME_Y1],W=m[a.FRAME_X2],E=m[a.FRAME_Y2],v=T*u+c*d+b,M=T*f+c*l+h,se=T*u+E*d+b,H=T*f+E*l+h,x=W*u+E*d+b,P=W*f+E*l+h,ae=W*u+c*d+b,$=W*f+c*l+h,me=Math.min(v,se,x,ae),ue=Math.min(M,H,P,$),de=Math.max(v,se,x,ae),j=Math.max(M,H,P,$);m[a.BOUNDS_X1]=me,m[a.BOUNDS_Y1]=ue,m[a.BOUNDS_X2]=de,m[a.BOUNDS_Y2]=j,m[a.IN_VIEW]=Number(!(n<me||i<ue||r>de||o>j)),m[a.UPDATED]=e,mt(t,v,M,se,H,x,P,ae,$)}function as(t,e,r){let o=e.getBoundsX(),n=e.getBoundsY(),i=e.getBoundsRight(),m=e.getBoundsBottom(),u=0,f=t.length;for(let d=0;d<f;d++){let l=t[d];is(l)&&(ss(l,r,o,n,i,m),ns(l),or(l),u++)}return u}var oo=class{id;_x;_y;constructor(e,r=0,o=0){this.id=e,this.set(r,o)}set(e,r=e){return this.x=e,this.y=r,this}set x(e){this._x=e;let r=this.id;p.data[r][a.X]=e,ne(r)}get x(){return this._x}set y(e){this._y=e;let r=this.id;p.data[r][a.Y]=e,ne(r)}get y(){return this._y}};function no(t,e,r){let o=p.data[t],n=-o[a.ORIGIN_X]*e,i=-o[a.ORIGIN_Y]*r;o[a.FRAME_X1]=n,o[a.FRAME_Y1]=i,o[a.FRAME_X2]=n+e,o[a.FRAME_Y2]=i+r,o[a.FRAME_WIDTH]=e,o[a.FRAME_HEIGHT]=r,o[a.WORLD_A]=n,o[a.WORLD_B]=i,o[a.WORLD_C]=n+e,o[a.WORLD_D]=i+r,o[a.WORLD_TX]=e,o[a.WORLD_TY]=r,ne(t)}var io=class{id;constructor(e,r=0,o=0){this.id=e,this.set(r,o)}set(e,r=e){return this.width=e,this.height=r,this}set width(e){no(this.id,e,this.height)}get width(){return p.data[this.id][a.FRAME_WIDTH]}set height(e){no(this.id,this.width,e)}get height(){return p.data[this.id][a.FRAME_HEIGHT]}set x(e){this.width=e}get x(){return this.width}set y(e){this.height=e}get y(){return this.height}};var so=class{id=te(R);type="WorldCamera";name="";size;position;isDirty=!0;matrix;constructor(e,r){let o=this.id;Ft(o,0,0,0,0),this.matrix=new nt,this.position=new oo(o,0,0),this.size=new io(o,e,r),this.reset(e,r)}set x(e){this.position.x=e,this.isDirty=!0}get x(){return this.position.x}set y(e){this.position.y=e,this.isDirty=!0}get y(){return this.position.y}setPosition(e,r){return this.position.set(e,r),this.isDirty=!0,this}updateBounds(){let e=this.id;if(Qt(e)){let r=this.x,o=this.y,n=this.size.width,i=this.size.height,m=-r+n/2,u=-o+i/2,f=m-n/2,d=u-i/2;return Mt(e,f,d,f+n,d+i),zt(e),this.isDirty=!0,!0}return!1}update(){if(this.isDirty){let e=this.matrix.data;return e[12]=this.x,e[13]=this.y,!0}return!1}getBoundsX(){return p.data[this.id][a.BOUNDS_X1]}getBoundsY(){return p.data[this.id][a.BOUNDS_Y1]}getBoundsRight(){return p.data[this.id][a.BOUNDS_X2]}getBoundsBottom(){return p.data[this.id][a.BOUNDS_Y2]}getMatrix(){return this.matrix.data}reset(e,r){this.size.set(e,r),this.isDirty=!0}destroy(){let e=this.id;he(R,p,e),et(R,e)}};var ao=class extends ro{type="StaticWorld";colorQuery;transformQuery;renderData;constructor(e){super(e);let r=this.tag;this.colorQuery=tt([r,A,je]),this.transformQuery=tt([r,p]);let o=be.get();this.camera=new so(o.width,o.height),this.renderData={gameFrame:0,dirtyLocal:0,dirtyWorld:0,dirtyQuad:0,dirtyColor:0,dirtyView:0,numChildren:0,rendered:0,renderMs:0,updated:0,updateMs:0,fps:0},qi(this.id,!1),$i(this.id,!1)}preRender(e){let r=this.id,o=this.renderData;o.gameFrame=e,o.rendered=0,$n(r);let n=this.camera,i=n.updateBounds(),m=this.transformQuery(R),u=0,f=0,d=0,l=0,b=0;nr(r)&&(u=ts(r,m,n,e),or(r)),Ui(r)&&(f=Xi(m),d=as(m,n,e),Mi(r)),Ni(r)&&(l=os(this.colorQuery(R)),Fi(r)),Xt(r)&&(this.getNumChildren(),Kn(r));let h=u+d;return i&&h!==m.length&&(b=Zi(m,n,e)),o.dirtyLocal=u,o.dirtyWorld=f,o.dirtyQuad=d,o.dirtyColor=l,o.dirtyView=b,o.rendered=Yn(),!0}update(e,r){w(this,it,this);let o=performance.now(),n=F(this.id),i=0;for(;n>0;)rr(n)&&(B.get(n).update(e,r),i++),n=Hi(n);this.renderData.updated=i,this.renderData.updateMs=performance.now()-o,w(this,at,this)}renderGL(e){Qi(e,this.color),w(this,qr,this);let r=this.camera,o=this.renderData,n=performance.now();Bi(e,r),zn();let i=F(this.id);for(;i>0;)xe(i)&&Jr(e,i),i=N(i);r.isDirty=!1,ji(e,this.color),o.renderMs=performance.now()-n,o.numChildren=this.getNumChildren(),o.fps=this.scene.game.time.fps,window.renderStats=o,w(this,st,e,this)}};var ms=class extends zr{constructor(){super();this.create()}async create(){await Hn("gundam","assets/gundam-ex-maxi-on-half.jpg");let e=Bn("gundam"),r=new ao(this);Ht(r,st,o=>{In(o,e,-80,30)})}};new Qr(Ur(),mr("gameParent"),ar("Phaser4"),ir(657930),ur(ms));})();
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
